<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>反向解析和视图函数 | 独角兕大王</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.ccac5a78.css" as="style"><link rel="preload" href="/assets/js/app.51f2f156.js" as="script"><link rel="preload" href="/assets/js/2.8911ec45.js" as="script"><link rel="preload" href="/assets/js/57.f8eceb45.js" as="script"><link rel="prefetch" href="/assets/js/10.6948c28b.js"><link rel="prefetch" href="/assets/js/100.276864ee.js"><link rel="prefetch" href="/assets/js/101.447ab1c7.js"><link rel="prefetch" href="/assets/js/102.f5b3c71d.js"><link rel="prefetch" href="/assets/js/103.16474d4b.js"><link rel="prefetch" href="/assets/js/104.ed58aef3.js"><link rel="prefetch" href="/assets/js/105.045203cd.js"><link rel="prefetch" href="/assets/js/106.be359e0b.js"><link rel="prefetch" href="/assets/js/107.7331bbca.js"><link rel="prefetch" href="/assets/js/108.76e1c800.js"><link rel="prefetch" href="/assets/js/109.e82166f3.js"><link rel="prefetch" href="/assets/js/11.d4ec37c8.js"><link rel="prefetch" href="/assets/js/110.4144755a.js"><link rel="prefetch" href="/assets/js/111.5864ab53.js"><link rel="prefetch" href="/assets/js/112.ca2aee84.js"><link rel="prefetch" href="/assets/js/113.641e7765.js"><link rel="prefetch" href="/assets/js/114.d69f8545.js"><link rel="prefetch" href="/assets/js/115.1b6a9f89.js"><link rel="prefetch" href="/assets/js/116.dde2c44e.js"><link rel="prefetch" href="/assets/js/117.4e79498c.js"><link rel="prefetch" href="/assets/js/12.7aac9c8d.js"><link rel="prefetch" href="/assets/js/13.abf127cd.js"><link rel="prefetch" href="/assets/js/14.aa4413a7.js"><link rel="prefetch" href="/assets/js/15.11a64e5b.js"><link rel="prefetch" href="/assets/js/16.f2d9a882.js"><link rel="prefetch" href="/assets/js/17.11c5bb7f.js"><link rel="prefetch" href="/assets/js/18.a522877b.js"><link rel="prefetch" href="/assets/js/19.6f31a972.js"><link rel="prefetch" href="/assets/js/20.b546c54e.js"><link rel="prefetch" href="/assets/js/21.6d055b7f.js"><link rel="prefetch" href="/assets/js/22.c48feceb.js"><link rel="prefetch" href="/assets/js/23.69941f78.js"><link rel="prefetch" href="/assets/js/24.6126dfc2.js"><link rel="prefetch" href="/assets/js/25.3475449c.js"><link rel="prefetch" href="/assets/js/26.96bb4643.js"><link rel="prefetch" href="/assets/js/27.da610e5d.js"><link rel="prefetch" href="/assets/js/28.b24ec15c.js"><link rel="prefetch" href="/assets/js/29.ec8af553.js"><link rel="prefetch" href="/assets/js/3.bec5f768.js"><link rel="prefetch" href="/assets/js/30.2e780db1.js"><link rel="prefetch" href="/assets/js/31.464c36ed.js"><link rel="prefetch" href="/assets/js/32.ad7d37c2.js"><link rel="prefetch" href="/assets/js/33.722f1ec5.js"><link rel="prefetch" href="/assets/js/34.8448d0fd.js"><link rel="prefetch" href="/assets/js/35.e5168ac9.js"><link rel="prefetch" href="/assets/js/36.edc404f1.js"><link rel="prefetch" href="/assets/js/37.5807602e.js"><link rel="prefetch" href="/assets/js/38.a519c89a.js"><link rel="prefetch" href="/assets/js/39.89af1b9a.js"><link rel="prefetch" href="/assets/js/4.5ed19beb.js"><link rel="prefetch" href="/assets/js/40.6c653db9.js"><link rel="prefetch" href="/assets/js/41.bc3b8b69.js"><link rel="prefetch" href="/assets/js/42.a0a02d9b.js"><link rel="prefetch" href="/assets/js/43.62f344e3.js"><link rel="prefetch" href="/assets/js/44.a7fd9d68.js"><link rel="prefetch" href="/assets/js/45.729c1c39.js"><link rel="prefetch" href="/assets/js/46.5b924aea.js"><link rel="prefetch" href="/assets/js/47.f3990404.js"><link rel="prefetch" href="/assets/js/48.f591f360.js"><link rel="prefetch" href="/assets/js/49.f7f213ad.js"><link rel="prefetch" href="/assets/js/5.2c5d28b5.js"><link rel="prefetch" href="/assets/js/50.b9ca2762.js"><link rel="prefetch" href="/assets/js/51.93672ee6.js"><link rel="prefetch" href="/assets/js/52.fb21314a.js"><link rel="prefetch" href="/assets/js/53.65343ccc.js"><link rel="prefetch" href="/assets/js/54.8081227d.js"><link rel="prefetch" href="/assets/js/55.e207659e.js"><link rel="prefetch" href="/assets/js/56.bde381df.js"><link rel="prefetch" href="/assets/js/58.bef70bfd.js"><link rel="prefetch" href="/assets/js/59.7ab7562d.js"><link rel="prefetch" href="/assets/js/6.fc65a1ac.js"><link rel="prefetch" href="/assets/js/60.f40ac3ca.js"><link rel="prefetch" href="/assets/js/61.d2b463ab.js"><link rel="prefetch" href="/assets/js/62.cfdf1bcf.js"><link rel="prefetch" href="/assets/js/63.1e45ce59.js"><link rel="prefetch" href="/assets/js/64.a98fe86e.js"><link rel="prefetch" href="/assets/js/65.0234d7c5.js"><link rel="prefetch" href="/assets/js/66.724906f0.js"><link rel="prefetch" href="/assets/js/67.7806fda6.js"><link rel="prefetch" href="/assets/js/68.9f227dae.js"><link rel="prefetch" href="/assets/js/69.fdbc56ac.js"><link rel="prefetch" href="/assets/js/7.284de54e.js"><link rel="prefetch" href="/assets/js/70.04a9cc03.js"><link rel="prefetch" href="/assets/js/71.a6fa1dd9.js"><link rel="prefetch" href="/assets/js/72.2f8e3aa0.js"><link rel="prefetch" href="/assets/js/73.9bbb0cb6.js"><link rel="prefetch" href="/assets/js/74.9f122255.js"><link rel="prefetch" href="/assets/js/75.75e1fbd8.js"><link rel="prefetch" href="/assets/js/76.60ff3c3e.js"><link rel="prefetch" href="/assets/js/77.39a253ae.js"><link rel="prefetch" href="/assets/js/78.0e49712f.js"><link rel="prefetch" href="/assets/js/79.5f9c24a0.js"><link rel="prefetch" href="/assets/js/8.5c21a4cc.js"><link rel="prefetch" href="/assets/js/80.f826f188.js"><link rel="prefetch" href="/assets/js/81.b8995ea7.js"><link rel="prefetch" href="/assets/js/82.e9bf63e0.js"><link rel="prefetch" href="/assets/js/83.e3a00749.js"><link rel="prefetch" href="/assets/js/84.b940927c.js"><link rel="prefetch" href="/assets/js/85.ad46a9b2.js"><link rel="prefetch" href="/assets/js/86.190e0071.js"><link rel="prefetch" href="/assets/js/87.5f9eb9ef.js"><link rel="prefetch" href="/assets/js/88.cfaf7469.js"><link rel="prefetch" href="/assets/js/89.e64cc32c.js"><link rel="prefetch" href="/assets/js/9.0723805d.js"><link rel="prefetch" href="/assets/js/90.805edabe.js"><link rel="prefetch" href="/assets/js/91.6a1ab3f7.js"><link rel="prefetch" href="/assets/js/92.04ecd01e.js"><link rel="prefetch" href="/assets/js/93.e615470a.js"><link rel="prefetch" href="/assets/js/94.0ad7c41c.js"><link rel="prefetch" href="/assets/js/95.0e5ce618.js"><link rel="prefetch" href="/assets/js/96.b59cf9f4.js"><link rel="prefetch" href="/assets/js/97.2a327746.js"><link rel="prefetch" href="/assets/js/98.9c01ec88.js"><link rel="prefetch" href="/assets/js/99.952046bd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ccac5a78.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://github.com/fluidicon.png" alt="独角兕大王" class="logo"> <span class="site-name can-hide">独角兕大王</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/python/" class="nav-link router-link-active">
  Python
</a></div><div class="nav-item"><a href="/rust/" class="nav-link">
  Rust
</a></div><div class="nav-item"><a href="/go/" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/lua/" class="nav-link">
  Lua
</a></div><div class="nav-item"><a href="/C/" class="nav-link">
  C++
</a></div><div class="nav-item"><a href="https://github.com/wuyuz" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.cnblogs.com/double-W/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  cnblogs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/python/" class="nav-link router-link-active">
  Python
</a></div><div class="nav-item"><a href="/rust/" class="nav-link">
  Rust
</a></div><div class="nav-item"><a href="/go/" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/lua/" class="nav-link">
  Lua
</a></div><div class="nav-item"><a href="/C/" class="nav-link">
  C++
</a></div><div class="nav-item"><a href="https://github.com/wuyuz" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.cnblogs.com/double-W/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  cnblogs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python常用模块</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Django框架</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/python/django/Web框架本质.html" class="sidebar-link">Web框架本质</a></li><li><a href="/python/django/resquest、模块层.html" class="sidebar-link">resquest、模块层</a></li><li><a href="/python/django/静态文件和ORM.html" class="sidebar-link">静态文件和ORM</a></li><li><a href="/python/django/标签、自定义标签.html" class="sidebar-link">模块层之标签、自定义标签</a></li><li><a href="/python/django/模版语法.html" class="sidebar-link">模版语法</a></li><li><a href="/python/django/模型层.html" class="sidebar-link">模型层</a></li><li><a href="/python/django/反向解析和视图函数.html" class="active sidebar-link">反向解析和视图函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/django/反向解析和视图函数.html#反向解析和视图函数" class="sidebar-link">反向解析和视图函数</a></li><li class="sidebar-sub-header"><a href="/python/django/反向解析和视图函数.html#反向解析" class="sidebar-link">反向解析</a></li><li class="sidebar-sub-header"><a href="/python/django/反向解析和视图函数.html#命名空间" class="sidebar-link">命名空间</a></li><li class="sidebar-sub-header"><a href="/python/django/反向解析和视图函数.html#视图函数" class="sidebar-link">视图函数</a></li></ul></li><li><a href="/python/django/单表操作.html" class="sidebar-link">单表操作</a></li><li><a href="/python/django/多表操作.html" class="sidebar-link">多表操作</a></li><li><a href="/python/django/中间件.html" class="sidebar-link">中间件</a></li><li><a href="/python/django/模型进阶.html" class="sidebar-link">模型进阶</a></li><li><a href="/python/django/缓存和信号.html" class="sidebar-link">缓存和信号</a></li><li><a href="/python/django/form组件.html" class="sidebar-link">form组件</a></li><li><a href="/python/django/csrf和Ajax.html" class="sidebar-link">csrf和Ajax</a></li><li><a href="/python/django/APIView使用和源码分析.html" class="sidebar-link">APIView使用和源码分析</a></li><li><a href="/python/django/REST framework之版本和解析器.html" class="sidebar-link">REST framework之版本和解析器</a></li><li><a href="/python/django/REST framework之分页和视图组件.html" class="sidebar-link">REST framework之分页和视图组件</a></li><li><a href="/python/django/REST framework之路由和渲染器.html" class="sidebar-link">REST framework之路由和渲染器</a></li><li><a href="/python/django/REST framework之序列化器.html" class="sidebar-link">REST framework之序列化器</a></li><li><a href="/python/django/REST framework版本图书管理系统.html" class="sidebar-link">REST framework版本图书管理系统</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flask 框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python爬虫</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python设计模式</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="反向解析和视图函数"><a href="#反向解析和视图函数" class="header-anchor">#</a> 反向解析和视图函数</h2> <h2 id="反向解析"><a href="#反向解析" class="header-anchor">#</a> 反向解析</h2> <ul><li><p>在使用Django 项目时，一个常见的需求是获得URL 的最终形式，以用于嵌入到生成的内容中（视图中和显示给用户的URL等）或者用于处理服务器端的导航（重定向等）。人们强烈希望不要硬编码这些URL（费力、不可扩展且容易产生错误）或者设计一种与URLconf 毫不相关的专门的URL 生成机制，因为这样容易导致一定程度上产生过期的URL。在需要URL 的地方，对于不同层级，Django 提供不同的工具用于URL 反查：</p> <div class="language- extra-class"><pre class="language-text"><code>两种方式：（其实就是用某种方法：将别名反向解析成URL路径）
1、在模板中：使用url 模板标签。
2、在Python 代码中：使用django.core.urls.reverse 函数。
</code></pre></div><p>也就是说：反向解析就是针对html模块和views函数两两之间的相互查找，的一种映射。之前我们通过在标签中嵌套地址来调用函数，现在我们也可以使用函数来具体的改变标签。</p></li> <li><p><strong>反向解析一</strong>： 使用标签{% url '别名'  参数 %}  （也就是在html中，使用{% url  '别名 ' %}  的别名，在url中通过别名总之找路径）</p> <ul><li><p>url.py中要设置函数的别名，注意：这个设置le别名的URL路径是针对全局（后面我们会使用命名空间限制），也就是说你设置到总路由urls和分发的路由url都是可以的</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#urls中的代码（总路由）</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url<span class="token punctuation">,</span>include
<span class="token keyword">from</span> app <span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    url<span class="token punctuation">(</span><span class="token string">r'^index/$'</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^app/'</span><span class="token punctuation">,</span>include<span class="token punctuation">(</span><span class="token string">'app.url'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    
<span class="token punctuation">]</span>

<span class="token comment">#url中的代码</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url
<span class="token keyword">from</span> app <span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span><span class="token punctuation">[</span>
    url<span class="token punctuation">(</span><span class="token string">r'^views/'</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^([0-9]{4})/([0-9]{2})/([0-9]+)/$'</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>special_case，name <span class="token operator">=</span> <span class="token string">'special'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^test/$'</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>test<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">#设置别名</span>
    url<span class="token punctuation">(</span><span class="token string">r'^blog/(?P&lt;year&gt;[0-9]{4})/$'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>blogs<span class="token punctuation">,</span>name <span class="token operator">=</span> <span class="token string">'blog'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div></li> <li><p>在template包中的html文件中标签的引用方式</p> <div class="language- extra-class"><pre class="language-text"><code>  &lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
      &lt;meta charset=&quot;UTF-8&quot;&gt;
      &lt;title&gt;Title&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;form action=&quot;{% url 'test'%}&quot; method=&quot;post&quot;&gt;   //注意写法
      &lt;input type=&quot;submit&quot; value=&quot;测试&quot;&gt;
  &lt;/form&gt;
      &lt;h4&gt;当前时间:{{ ctime }}&lt;/h4&gt;
  &lt;/bod&gt;
  &lt;/html&gt;
  
  -----------------------------------------------------------------
  //多参数传入 (无名分组 --&gt; 位置参数)
   &lt;form action=&quot;{% url 'special' 2018 12 1 %}&quot; method=&quot;post&quot;&gt;   //注意写法
      &lt;input type=&quot;submit&quot; value=&quot;测试&quot;&gt;
  &lt;/form&gt;
  
  -----------------------------------------------------------------
  //多参数传入（命名参数 --&gt; 关键字参数）
   &lt;form action=&quot;{% url 'blog' year = 2019 %}&quot; method=&quot;post&quot;&gt;   //注意写法
      &lt;input type=&quot;submit&quot; value=&quot;测试&quot;&gt;
  &lt;/form&gt;
</code></pre></div></li> <li><p>对应views.py中的函数</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span>HttpResponse

<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">import</span> datetime
    now <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ctime <span class="token operator">=</span> now<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">&quot;%Y-%m-%d %X&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'index.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;ctime&quot;</span><span class="token punctuation">:</span>ctime<span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment"># 类似于jinja2中的模块渲染，使模块动态起来</span>

<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">b&quot;Test Ok!&quot;</span><span class="token punctuation">)</span>
</code></pre></div></li></ul></li> <li><p><strong>注意</strong>：可以给这种形式的反向解析传递参数：url 会将这个参数和别名对应的路径进行拼接，（然后触发别名对应得函数）</p> <div class="language-python extra-class"><pre class="language-python"><code>\<span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token string">&quot;{% url 'test' book.pk %}&quot;</span> method<span class="token operator">=</span><span class="token string">&quot;post&quot;</span><span class="token operator">&gt;</span>   <span class="token comment">#假如这个test别名对应得函数（无名参数）需要一个参数，这里演示了从个页面携带在这个页面信息book.pk跳转到另一个 'test' 对应路径的函数中（test可接收这个参数）</span>
</code></pre></div></li></ul> <hr> <ul><li><p><strong>反向解析二</strong>：在视图函数中通过reverse('别名')，来查找在url中该别名的路径</p></li> <li><p><strong>在views中使用reverse函数（反向解析）+  redirect函数（重定向）</strong></p> <ul><li><p>views.py文件中（通过函数别名找网址）</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span>HttpResponse<span class="token punctuation">,</span>redirect
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> reverse

<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">:</span>
        user <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span>
        pwd <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
        <span class="token keyword">if</span> user <span class="token operator">==</span> <span class="token string">'wang'</span> <span class="token keyword">and</span> pwd <span class="token operator">==</span> <span class="token string">'123'</span><span class="token punctuation">:</span>
            url <span class="token operator">=</span> reverse<span class="token punctuation">(</span><span class="token string">'test2'</span><span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2019</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 注意这里的参数也必须满足test2的规则，注意这里针对的是无名参数得传参</span>
            
            url1 <span class="token operator">=</span> reverse<span class="token punctuation">(</span><span class="token string">'test1'</span><span class="token punctuation">,</span> kwargs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'year'</span><span class="token punctuation">:</span><span class="token number">2019</span><span class="token punctuation">,</span><span class="token string">'month'</span><span class="token punctuation">:</span><span class="token number">12</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment"># 这里针对得是命名分组，对应的是关键字传参</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>     <span class="token comment">#/app/2019/13/11/</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">b&quot;Test Ok!&quot;</span><span class="token punctuation">)</span>
<span class="token comment">#这主意使用reverse时，如果有参数，必须加参数得到的网址，再使用redirect重定向</span>

<span class="token keyword">def</span> <span class="token function">special_case</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>year<span class="token punctuation">,</span>month<span class="token punctuation">,</span>day<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>year<span class="token operator">+</span>month<span class="token operator">+</span>day<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>index.hmtl中，我们添加用户和密码框</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{% url <span class="token punctuation">'</span>test<span class="token punctuation">'</span>%}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>   //一样的使用最开始的使用别名找函数
    用户名： <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    密码：  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>测试<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">&gt;</span></span>当前时间:{{ ctime }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>url.py中的路径函数对应表</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url
<span class="token keyword">from</span> app <span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span><span class="token punctuation">[</span>
    url<span class="token punctuation">(</span><span class="token string">r'^test/$'</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>test<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^app/(?P&lt;year&gt;[0-9]{4})/(?P&lt;month&gt;[0-9]{4})/$'</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>test<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'test1'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div></li></ul></li> <li><h5 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h5> <div class="language-python extra-class"><pre class="language-python"><code>情况<span class="token number">1</span>：    
    在模板（html文件）： 
         <span class="token punctuation">{</span><span class="token operator">%</span> url <span class="token string">'别名'</span> <span class="token operator">%</span><span class="token punctuation">}</span>  <span class="token comment">#如果这里调用的函数有参数，必须加上参数（最好函数都使用命名参数）</span>
         <span class="token punctuation">{</span><span class="token operator">%</span> url <span class="token string">'app:test4'</span> year<span class="token operator">=</span><span class="token number">2019</span><span class="token operator">%</span><span class="token punctuation">}</span>  <span class="token comment">#命名空间:别名</span>

情况<span class="token number">2</span>：
    视图函数（python文件）中
    <span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> reverse
    <span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> redirect
    url<span class="token operator">=</span>reverse<span class="token punctuation">(</span>别名<span class="token punctuation">)</span>  <span class="token comment">#有参数加参数  如：url = reverse('test2',args=(2019,13,11)) </span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url<span class="token punctuation">)</span>  <span class="token comment">#重定向</span>
    
<span class="token comment">#需要注意的是：在redirect('index/') 此时会像原来路径上拼接index/</span>
情况<span class="token number">3</span>：
  	redirect<span class="token punctuation">(</span><span class="token string">'别名'</span><span class="token punctuation">)</span>  <span class="token comment">#redirct自带reverse，且注意是有命名空间限制，有则app:别名</span>
      
</code></pre></div></li> <li><p><strong>注意</strong>：在模块和视图函数中如果所用的别名函数都要参数必须在后面加参数</p> <div class="language-python extra-class"><pre class="language-python"><code>  <span class="token comment">#url中</span>
 urlpatterns <span class="token operator">=</span><span class="token punctuation">[</span>
      url<span class="token punctuation">(</span><span class="token string">r'^views/'</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span>
      url<span class="token punctuation">(</span><span class="token string">r'^(?P&lt;year&gt;[0-9]{4})/$'</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>special_case1<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
  
  <span class="token comment">#html中</span>
  <span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token string">&quot;{% url 'app:test4' year=2019 %}&quot;</span> method<span class="token operator">=</span><span class="token string">&quot;post&quot;</span><span class="token operator">&gt;</span>
      用户名： <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span><span class="token operator">&gt;</span>
      密码：  <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;password&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;submit&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;测试&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
</code></pre></div></li></ul> <h2 id="命名空间"><a href="#命名空间" class="header-anchor">#</a> 命名空间</h2> <ul><li><p>命名空间（英语：Namespace）是表示标识符的可见范围。在上面的学习中我们知道，取别名是非常方便的，但是如果名字重了，django就不知道找谁了（会找第一个找到的，后面的就废了）。下面我们有两个项目app，app01，如果都有name别名怎么办？</p> <div class="language- extra-class"><pre class="language-text"><code>官方：一个标识符可在多个命名空间中定义，它在不同命名空间中的含义是互不相干的。这样，在一个新的命名空间中可定义任何标识符，它们不会与任何已有的标识符发生冲突，因为已有的定义都处于其它命名空间中。由于name没有作用域，Django在反解URL时，会在项目全局顺序搜索，当查找到第一个name指定URL时，立即返回。其他的就没用了。
</code></pre></div></li> <li><p>修改方式：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#在总路由中定义命名空间，也就是说，不能人人都通过name来区分函数，应用一多，就找不到方向了，需要划分哈区域（命名空间）</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url<span class="token punctuation">,</span>include
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin
<span class="token keyword">from</span> app <span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment"># url(r'^admin/', admin.site.urls),</span>
    url<span class="token punctuation">(</span><span class="token string">r'^index/$'</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^app/'</span><span class="token punctuation">,</span>include<span class="token punctuation">(</span><span class="token string">'app.url'</span><span class="token punctuation">,</span>namespace<span class="token operator">=</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^app01/'</span><span class="token punctuation">,</span>include<span class="token punctuation">(</span><span class="token string">'app01.url'</span><span class="token punctuation">,</span>namespace<span class="token operator">=</span><span class="token string">'app01'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">#取别名</span>
<span class="token punctuation">]</span>
</code></pre></div></li> <li><p>具体的实现（两个test的相互引用）</p> <ul><li><p>总路由就像上面设置的一样，接着时设置app的views.py</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span>HttpResponse<span class="token punctuation">,</span>redirect
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> reverse

<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">:</span>
        user <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span>
        pwd <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
        <span class="token keyword">if</span> user <span class="token operator">==</span> <span class="token string">'wang'</span> <span class="token keyword">and</span> pwd <span class="token operator">==</span> <span class="token string">'123'</span><span class="token punctuation">:</span>
            url <span class="token operator">=</span> reverse<span class="token punctuation">(</span><span class="token string">'app01:test'</span><span class="token punctuation">)</span>  <span class="token comment"># 注意这里的参数也必须满足test的规则,没有就不写</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>     <span class="token comment">#/app/2019/13/11/</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">b&quot;Test Ok!&quot;</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>app中的html基本就是上个例子的html，注册成功后跳转至app01的test中</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
{#先跳转至app中的test#}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span> This is home of app<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{% url <span class="token punctuation">'</span>app:test<span class="token punctuation">'</span>%}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>  //注意写法 {% url  '命名空间:别名' %}
    用户名： <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    密码：  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>测试<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">&gt;</span></span>当前时间:{{ ctime }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

//注意当有多个命名空间时：&quot;app01:app02:xxx:index&quot;
</code></pre></div></li> <li><p>app01的路由和views.py里面的函数</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin
<span class="token keyword">from</span> app01 <span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span><span class="token punctuation">[</span>
    url<span class="token punctuation">(</span><span class="token string">r'^views/'</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^([0-9]{4})/([0-9]{2})/([0-9]+)/$'</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>special_case<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">&quot;test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^test/$'</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>test<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'test'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token comment">#views.py中代码</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span>HttpResponse<span class="token punctuation">,</span>redirect
<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'index2.html'</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>app01使用的html内容</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>This is home of app01<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul></li> <li><h5 id="总结-2"><a href="#总结-2" class="header-anchor">#</a> 总结</h5> <div class="language-python extra-class"><pre class="language-python"><code>我的两个app中 url名称重复了，我反转URL的时候就可以通过命名空间的名称得到我当前的URL。
语法：
<span class="token number">1</span>、模块中使用：
	<span class="token punctuation">{</span><span class="token operator">%</span> url <span class="token string">'app01:detail'</span> pk<span class="token operator">=</span><span class="token number">12</span> pp<span class="token operator">=</span><span class="token number">99</span> <span class="token operator">%</span><span class="token punctuation">}</span>
	
<span class="token number">2</span>、views<span class="token punctuation">.</span>py在函数使用：v <span class="token operator">=</span> reverse<span class="token punctuation">(</span><span class="token string">'app01:detail'</span><span class="token punctuation">,</span> kwargs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'pk'</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  
<span class="token number">3</span>、当有多级路由时，即多个include，我们可以使用：<span class="token string">'app01:datail:xxx:index'</span>
</code></pre></div></li></ul> <hr> <h2 id="视图函数"><a href="#视图函数" class="header-anchor">#</a> 视图函数</h2> <ul><li><p>一个视图函数（类），简称视图，是一个简单的Python函数（类），它接受Web请求并且返回Web响应。响应可以是一张网页的HTML内容，一个重定向，一个404错误，一个XML文档，或者一张图片。无论视图本身包含什么逻辑，都要返回响应。代码写在哪里也无所谓，只要它在你当前项目目录下面。除此之外没有更多的要求了——可以说“没有什么神奇的地方”。为了将代码放在某处，大家约定成俗将视图放置在项目（project）或应用程序（app）目录中的名为<code>views.py</code>的文件中。</p> <ul><li><p>下面是一个简单的视图: 需要注意的是一个视图函数应该具备get、post等触发事件的判断，因为一般的情况是以GET的方式触发，但要考虑特殊性。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse   <span class="token comment">#从django.http模块导入了HttpResponse类，以及Python的datetime库</span>
<span class="token keyword">import</span> datetime

<span class="token keyword">def</span> <span class="token function">current_datetime</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token comment"># 这个request是在每次连接对话时在swgi.py中就是有的，在传入时必须接受他</span>
    <span class="token comment">#接着，我们定义了current_datetime函数。它就是视图函数。每个视图函数都使用HttpRequest对象作为第一个参数，并且通常称之为request。</span>
    now <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
    html <span class="token operator">=</span> <span class="token string">&quot;&lt;html&gt;&lt;body&gt;It is now %s.&lt;/body&gt;&lt;/html&gt;&quot;</span> <span class="token operator">%</span> now
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>html<span class="token punctuation">)</span>
	<span class="token comment">#这个视图会返回一个HttpResponse对象，其中包含生成的响应。每个视图函数都负责返回一个HttpResponse对象。无论时通过render还是其他方法，底层都是继承了HttpResponse来实现消息的回复</span>
</code></pre></div><p><strong>我们不难理解，在视图层我们的每个函数或则类，都是接受一个request（里面包括所有来访者信息），处理加工后返回一个HttpRespone回去（返回信息）</strong></p></li></ul></li></ul> <p>###CBV 和 FBV</p> <ul><li><p><strong>概念</strong>：</p> <div class="language- extra-class"><pre class="language-text"><code>FBV（function base views） ：就是在视图里使用函数处理请求。之前都是FBV模式写的代码，所以就不写例子了。(用函数来写逻辑)

CBV（class base views）    : 就是在视图里使用类处理请求。（用继承View的类来写逻辑）

Python是一个面向对象的编程语言，如果只用函数来开发，有很多面向对象的优点就错失了（继承、封装、多态）。所以Django在后来加入了Class-Based-View。可以让我们用类写View。这样做的优点主要下面两种：
	1、提高了代码的复用性，可以使用面向对象的技术，比如Mixin（多继承）
    2、可以用不同的函数针对不同的HTTP方法处理，而不是通过很多if判断，提高代码可读性
</code></pre></div><p><strong>具体使用</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#写一个处理GET方法的view，用函数写的话是下面这样 （FBV）</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse
<span class="token keyword">def</span> <span class="token function">my_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
     <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'OK'</span><span class="token punctuation">)</span>
      
    
<span class="token comment">#class-based view写的话，就是下面这样 （CBV）</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse
<span class="token keyword">from</span> django<span class="token punctuation">.</span>views <span class="token keyword">import</span> View
<span class="token keyword">class</span> <span class="token class-name">MyView</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token comment">#  注意View中默认是有get方法的，这里我们相当于重写了get方法</span>
            <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'OK'</span><span class="token punctuation">)</span>
</code></pre></div><p>​		Django的<strong>url是将一个请求分配给可调用的函数的方法</strong>，而不是一个class。（源码）针对这个问题，class-based view提供了一个<code>as_view()</code>静态方法（也就是类方法），调用这个方法，会创建一个类的实例，然后通过实例调用<code>dispatch()</code>方法，<code>dispatch()</code>方法会根据request的method的不同调用相应的方法来处理request（如<code>get()</code>,<code>post()</code>等）。到这里，这些方法和function-based view差不多了，要接收request，得到一个response返回。如果方法没有定义，会抛出HttpResponseNotAllowed异常。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#下面是扩展内容，也就是CBV是怎么实现的，也就是说重写的dispatch是get、post等8种请求方式得入口。</span>
<span class="token keyword">class</span> <span class="token class-name">Login</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>
     
    <span class="token keyword">def</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'before'</span><span class="token punctuation">)</span>
        obj <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span>Login<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">.</span>dispatch<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'after'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> obj
 
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'login.html'</span><span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'Login.post'</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>CBV源码分析</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token number">1</span>、项目启动 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> 请求访问加载的url<span class="token punctuation">.</span>py文件的路径 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> 触发views<span class="token punctuation">.</span>py中的 类<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#View类中：</span>
	<span class="token keyword">def</span> <span class="token function">as_view</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">def</span> <span class="token function">view</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self <span class="token operator">=</span> cls<span class="token punctuation">(</span><span class="token operator">**</span>initkwarys<span class="token punctuation">)</span>  <span class="token comment"># 这里就是在实例化类</span>
            self<span class="token punctuation">.</span>request <span class="token operator">=</span> request
            ……
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>dispatch<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span> <span class="token comment"># 这里就是所以请求的入口，我们可以自定义</span>
        <span class="token keyword">return</span> view  <span class="token comment"># 执行as_views方法返回一个view内层函数，其实就和我们之前写一个函数名没调用一样，返回的都是函数名，其实执行这个函数，会触发dispatch函数，dispatch函数会用到反射来获取我们调用的方式。</span>
    
<span class="token number">2</span>、请求到来的时候执行view函数 ：
	<span class="token number">1</span>、实例化类 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> self
    <span class="token number">2</span>、执行seld<span class="token punctuation">.</span>dispatch<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>：
    	<span class="token number">2.1</span>、判断请求方式是否被允许：
        		允许，则通过反射获取到对应请求方式的方法   ——》 获得handler，也就是我们get方法
            	不允许，self<span class="token punctuation">.</span>http_method_not_allowed  ——》handler
        <span class="token number">2.2</span>、 执行handler（request，<span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs）
        
  <span class="token comment">#View类中的dispatch函数：</span>
		http_method_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'post'</span><span class="token punctuation">,</span> <span class="token string">'put'</span><span class="token punctuation">,</span> <span class="token string">'patch'</span><span class="token punctuation">,</span> <span class="token string">'delete'</span><span class="token punctuation">,</span> <span class="token string">'head'</span><span class="token punctuation">,</span> <span class="token string">'options'</span><span class="token punctuation">,</span> <span class="token string">'trace'</span><span class="token punctuation">]</span>
	    <span class="token keyword">def</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> request<span class="token punctuation">.</span>method<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>http_method_names<span class="token punctuation">:</span>
                handler <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">.</span>method<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>http_method_not_allowed<span class="token punctuation">)</span> <span class="token comment">#self为对象，对象里的方法，所以 get(self,request) 就相当于 self.get(request)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                handler <span class="token operator">=</span> self<span class="token punctuation">.</span>http_method_not_allowed
            <span class="token keyword">return</span> handler<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>  <span class="token comment">#需要注意的时这时候时对象.handler就不需要self了</span>
        
 <span class="token comment">#注意：这里需要注意的是，View类中为我们写好了八种请求方式，当我们只想允许get来请求时，我们可以：</span>
<span class="token keyword">class</span> <span class="token class-name">Add_student</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>
    http_method_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">,</span><span class="token punctuation">]</span>  <span class="token comment"># 这里相当于重写了http_method_names</span>
    
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">pass</span>
    
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
梳理整个流程：as_view<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> 返回内层view <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> 执行dispatch <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> 执行请求方法   （每次都有返回值，重点，一层层往上翻）
</code></pre></div><p><strong>注意</strong>：使用CBV时，url.py中也可以做出对应的修改：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># urls.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url
<span class="token keyword">from</span> myapp<span class="token punctuation">.</span>views <span class="token keyword">import</span> MyView <span class="token comment">#引入我们在views.py里面创建的类</span>
  
urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
     url<span class="token punctuation">(</span><span class="token string">r'^index/$'</span><span class="token punctuation">,</span> MyView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div></li> <li><p>CBV传参，和FBV（前一章又讲）类似，有名分组，无名分组：</p> <div class="language-python extra-class"><pre class="language-python"><code>url<span class="token punctuation">(</span><span class="token string">r'^cv/(\d{2})/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>Myd<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'cv'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
url<span class="token punctuation">(</span><span class="token string">r'^cv/(?P&lt;n&gt;\d{2})/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>Myd<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'xxx'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'cv'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment">#如果想给类的name属性赋值xxx，前提你的Myd类里面必须有name属性（类属性，定义init方法来接受属性行不通，但是可以自行研究一下，看看如何行通，意义不大），并且之前类里面的name属性的值会被覆盖掉,后面的name是一个别名，用于反向解析</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token comment">#views中类的写法：</span>
<span class="token keyword">class</span> <span class="token class-name">Myd</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">'sb'</span>
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'get方法执行了'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'&gt;&gt;&gt;'</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'cvpost.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span>self<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'post方法被执行了'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'post'</span><span class="token punctuation">)</span>
    
<span class="token comment">#添加类的属性可以通过两种方法设置，第一种是常见的Python的方法，可以被子类覆盖。</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse
<span class="token keyword">from</span> django<span class="token punctuation">.</span>views <span class="token keyword">import</span> View

<span class="token keyword">class</span> <span class="token class-name">GreetingView</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">&quot;yuan&quot;</span>
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
         <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
  
<span class="token comment"># You can override that in a subclass </span>
<span class="token keyword">class</span> <span class="token class-name">MorningGreetingView</span><span class="token punctuation">(</span>GreetingView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token operator">=</span> <span class="token string">&quot;alex&quot;</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>    
<span class="token comment">#第二种方法，你也可以在url中指定类的属性：在url中设置类的属性Python </span>
urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
   url<span class="token punctuation">(</span><span class="token string">r'^index/$'</span><span class="token punctuation">,</span> GreetingView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;egon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">#类里面必须有name属性，并且会被传进来的这个属性值给覆盖掉</span>
<span class="token punctuation">]</span>
</code></pre></div></li> <li><p><strong>案例补充</strong>：将函数式和类式进行对比</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span>redirect<span class="token punctuation">,</span>HttpResponse
<span class="token keyword">from</span> app <span class="token keyword">import</span>  models
<span class="token keyword">from</span> django<span class="token punctuation">.</span>views <span class="token keyword">import</span> View
<span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">student_list</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    student_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'student_list.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'list'</span><span class="token punctuation">:</span>student_obj<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">timer</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        strat_timer <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        ret <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>  <span class="token comment"># 将要接收到get方法最终的返回值，因为最后执行的相当于inner函数，它得有HttpResponse返回值</span>
        end_timer <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;函数执行时间：</span><span class="token interpolation"><span class="token punctuation">{</span>end_timer<span class="token operator">-</span>strat_timer<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> ret  <span class="token comment"># 这里相当于把最终的结果返回        </span>
    <span class="token keyword">return</span> inner

<span class="token keyword">class</span> <span class="token class-name">Student_list</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@timer</span>
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        student_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'student_list.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'list'</span><span class="token punctuation">:</span> student_obj<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">add_student</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    error_msg <span class="token operator">=</span> <span class="token string">''</span>
    class_obj_list <span class="token operator">=</span> models<span class="token punctuation">.</span>Class<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        student_name <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'student'</span><span class="token punctuation">)</span>
        class_id <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'class_id'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> student_name<span class="token punctuation">:</span>
            models<span class="token punctuation">.</span>Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name <span class="token operator">=</span> student_name<span class="token punctuation">,</span>classes_id<span class="token operator">=</span>class_id<span class="token punctuation">)</span>
            <span class="token keyword">return</span>  redirect<span class="token punctuation">(</span><span class="token string">'/app/student_list/'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            error_msg <span class="token operator">=</span> <span class="token string">'信息不能为空'</span>           
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'add_student.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'error_msg'</span><span class="token punctuation">:</span>error_msg<span class="token punctuation">,</span><span class="token string">'list'</span><span class="token punctuation">:</span>class_obj_list<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Add_student</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        error_msg <span class="token operator">=</span> <span class="token string">''</span>
        class_obj_list <span class="token operator">=</span> models<span class="token punctuation">.</span>Class<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'add_student.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'error_msg'</span><span class="token punctuation">:</span> error_msg<span class="token punctuation">,</span> <span class="token string">'list'</span><span class="token punctuation">:</span> class_obj_list<span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        student_name <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'student'</span><span class="token punctuation">)</span>
        class_id <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'class_id'</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 保存图片：注意这里有一个上传图片的实例</span>
        f1 <span class="token operator">=</span> request<span class="token punctuation">.</span>FILES<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'f1'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>f1<span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>f1<span class="token punctuation">.</span>name<span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> f1<span class="token punctuation">.</span>chunks<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#chunks：块的意思</span>
                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
      
        <span class="token keyword">if</span> student_name<span class="token punctuation">:</span>
            models<span class="token punctuation">.</span>Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span>student_name<span class="token punctuation">,</span> classes_id<span class="token operator">=</span>class_id<span class="token punctuation">)</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/app/student_list/'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            error_msg <span class="token operator">=</span> <span class="token string">'信息不能为空'</span>
            class_obj_list <span class="token operator">=</span> models<span class="token punctuation">.</span>Class<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'add_student.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'error_msg'</span><span class="token punctuation">:</span> error_msg<span class="token punctuation">,</span> <span class="token string">'list'</span><span class="token punctuation">:</span> class_obj_list<span class="token punctuation">}</span><span class="token punctuation">)</span>
    
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
 <span class="token comment">#对应得html文件：需要注意得是，上传文件得form表单需要调整编码方式 enctype=&quot;multipart/form-data&quot;</span>
<span class="token operator">&lt;</span>form <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-horizontal&quot;</span> action<span class="token operator">=</span><span class="token string">&quot;&quot;</span> method<span class="token operator">=</span><span class="token string">&quot;post&quot;</span> enctype<span class="token operator">=</span><span class="token string">&quot;multipart/form-data&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-group&quot;</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>label <span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;1&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;col-sm-2 control-label&quot;</span><span class="token operator">&gt;</span>姓名<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;col-sm-10&quot;</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;text&quot;</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'1'</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-control&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;student&quot;</span> placeholder<span class="token operator">=</span><span class="token string">&quot;{{ student_obj.name }}&quot;</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>label <span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;class&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;col-sm-2 control-label&quot;</span><span class="token operator">&gt;</span>班级<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;col-sm-10&quot;</span> style<span class="token operator">=</span><span class="token string">&quot;margin-top:10px;&quot;</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>select name<span class="token operator">=</span><span class="token string">&quot;class_id&quot;</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;class&quot;</span><span class="token operator">&gt;</span>
                        <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">for</span> <span class="token keyword">class</span> <span class="token class-name">in</span> <span class="token builtin">list</span> <span class="token operator">%</span><span class="token punctuation">}</span>
                            <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">&quot;{{ class.id }}&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">&gt;</span>
                        <span class="token punctuation">{</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">}</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>label <span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;f1&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;col-sm-2 control-label&quot;</span><span class="token operator">&gt;</span>头像<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;col-sm-5&quot;</span> style<span class="token operator">=</span><span class="token string">&quot;margin-top:10px;&quot;</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;file&quot;</span> name <span class="token operator">=</span> <span class="token string">'f1'</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;danger&quot;</span> style<span class="token operator">=</span><span class="token string">&quot;display: inline-block&quot;</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

            <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-group&quot;</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;col-sm-offset-2 col-sm-10 text-danger&quot;</span><span class="token operator">&gt;</span>
                    <span class="token punctuation">{</span><span class="token punctuation">{</span> error_msg <span class="token punctuation">}</span><span class="token punctuation">}</span>
                    <span class="token operator">&lt;</span>button <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;submit&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn btn-primary center-block&quot;</span><span class="token operator">&gt;</span>提交<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token comment">#url文件</span>
urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    url<span class="token punctuation">(</span><span class="token string">r'^student_list/$'</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>Student_list<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^add_student/$'</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>Add_student<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div></li></ul> <p>###视图加装饰器</p> <ul><li><p><strong>使用装饰器装饰FBV</strong>：FBV本身就是一个函数，所以和普通函数加装饰器无异</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        ret <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;used:&quot;</span><span class="token punctuation">,</span> end_time<span class="token operator">-</span>start_time<span class="token punctuation">)</span>
        <span class="token keyword">return</span> ret
    <span class="token keyword">return</span> inner


<span class="token comment"># FBV版添加班级</span>
<span class="token decorator annotation punctuation">@wrapper</span>
<span class="token keyword">def</span> <span class="token function">add_class</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">:</span>
        class_name <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;class_name&quot;</span><span class="token punctuation">)</span>
        models<span class="token punctuation">.</span>Classes<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span>class_name<span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&quot;/class_list/&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;add_class.html&quot;</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>使用装饰器装饰CBV</strong>：类中的方法与独立函数不完全相同，因此不能直接将函数装饰器应用于类中的方法 ，我们需要先将其转换为方法装饰器。Django中提供了method_decorator装饰器用于将函数装饰器转换为方法装饰器。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>views <span class="token keyword">import</span> View
<span class="token keyword">from</span> django<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> method_decorator

<span class="token keyword">class</span> <span class="token class-name">AddClass</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token decorator annotation punctuation">@method_decorator</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;add_class.html&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        class_name <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;class_name&quot;</span><span class="token punctuation">)</span>
        models<span class="token punctuation">.</span>Classes<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span>class_name<span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&quot;/class_list/&quot;</span><span class="token punctuation">)</span>
    
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token comment">#另外给cbv添加装饰器的有以下三种方式：</span>

<span class="token comment">#1、直接添加在dispatch里面，这样每个函数都会执行，即每个请求都会进入前执行一次，执行完执行一次</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> method_decorator

<span class="token decorator annotation punctuation">@method_decorator</span><span class="token punctuation">(</span>login_test<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
	res <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span>IndexView<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>dispatch<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
	<span class="token keyword">return</span> res  <span class="token comment">#一定要有这个返回值，因为这是get、post返回值得最后一道关口</span>

<span class="token comment">#2、添加在每一个函数中，只作用于当前请求方式</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> method_decorator

	<span class="token decorator annotation punctuation">@method_decorator</span><span class="token punctuation">(</span>login_test<span class="token punctuation">)</span>
	<span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">)</span>

<span class="token comment">#3、直接添加在类上，后面的name表示只给get添加装饰器</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> method_decorator

<span class="token comment">#@method_decorator(login_test, name='get')  get是给get方法加（以这种方式如果想给多个方法加装饰器，需要写多层装饰器，因为name这个参数的值必须是个字符串，并且不能同时写两个方法），login_test表示要加得装饰器，不写name参数则会给所有的请求方式加上装饰器</span>
<span class="token decorator annotation punctuation">@method_decorator</span><span class="token punctuation">(</span>login_test<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'post'</span><span class="token punctuation">)</span> <span class="token comment"># post是给post方法加，可单独使用name来约束</span>
<span class="token keyword">class</span> <span class="token class-name">IndexView</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>
   	 <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span>：
    	<span class="token keyword">pass</span>
        <span class="token keyword">return</span> <span class="token string">'xxx'</span>
        
<span class="token comment">#4、重叠加在类上：</span>
<span class="token decorator annotation punctuation">@method_decorator</span><span class="token punctuation">(</span>timer<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'post'</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@method_decorator</span><span class="token punctuation">(</span>timer<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'get'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">AddPublisher</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token comment"># 其实不使用method_decorator方法也可以给我们要作用得请求方式添加装饰器，他们得区别是：</span>
不适用method_decorator：
    func   ——》 <span class="token operator">&lt;</span>function AddPublisher<span class="token punctuation">.</span>get at <span class="token number">0x000001FC8C358598</span><span class="token operator">&gt;</span>
    args  ——》 <span class="token punctuation">(</span><span class="token operator">&lt;</span>app01<span class="token punctuation">.</span>views<span class="token punctuation">.</span>AddPublisher <span class="token builtin">object</span> at <span class="token number">0x000001FC8C432C50</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>WSGIRequest<span class="token punctuation">:</span> GET <span class="token string">'/add_publisher/'</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>

使用method_decorator之后：
    func ——》 <span class="token operator">&lt;</span>function method_decorator<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token builtin">locals</span><span class="token operator">&gt;</span><span class="token punctuation">.</span>_dec<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token builtin">locals</span><span class="token operator">&gt;</span><span class="token punctuation">.</span>_wrapper<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token builtin">locals</span><span class="token operator">&gt;</span><span class="token punctuation">.</span>bound_func at <span class="token number">0x0000015185F7C0D0</span><span class="token operator">&gt;</span>
    args ——》 <span class="token punctuation">(</span><span class="token operator">&lt;</span>WSGIRequest<span class="token punctuation">:</span> GET <span class="token string">'/add_publisher/'</span><span class="token operator">&gt;</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>关于装饰器的综合案例</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#views.py里面的内容：</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span>redirect<span class="token punctuation">,</span>HttpResponse
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> reverse
<span class="token keyword">from</span> django<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> method_decorator
<span class="token keyword">from</span> django<span class="token punctuation">.</span>views <span class="token keyword">import</span> View
<span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'xxxxx'</span><span class="token punctuation">)</span>
        ret <span class="token operator">=</span> fn<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'xsssss'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> ret
    <span class="token keyword">return</span> inner

<span class="token comment"># @method_decorator(wrapper,name='get')#CBV版装饰器方式一</span>
<span class="token keyword">class</span> <span class="token class-name">BookList</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@method_decorator</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span> <span class="token comment">#CBV版装饰器方式二</span>
    <span class="token keyword">def</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'请求内容处理开始'</span><span class="token punctuation">)</span>
        res <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dispatch<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'处理结束'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> res
    
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'get内容'</span><span class="token punctuation">)</span>
        <span class="token comment"># all_books = models.Book.objects.all()</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'login.html'</span><span class="token punctuation">)</span>
    
    <span class="token decorator annotation punctuation">@method_decorator</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span> <span class="token comment">#CBV版装饰器方式三</span>
    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'post内容'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'book_list'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># @wrapper</span>
<span class="token keyword">def</span> <span class="token function">book_list</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'aaa'</span><span class="token punctuation">)</span>
    
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token comment">#urls.py文件中</span>
url<span class="token punctuation">(</span><span class="token string">r'^book_list/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>book_list<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'book_list'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
url<span class="token punctuation">(</span><span class="token string">r'^booklist/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>BookList<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'booklist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token comment">#login.html文件内容</span>
<span class="token operator">&lt;</span>!DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Title<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token string">&quot;/booklist/&quot;</span> method<span class="token operator">=</span><span class="token string">&quot;post&quot;</span><span class="token operator">&gt;</span>
    <span class="token punctuation">{</span><span class="token operator">%</span> csrf_token <span class="token operator">%</span><span class="token punctuation">}</span>
    用户名：<span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;submit&quot;</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>

<span class="token comment">#注意事项:</span>
<span class="token number">1</span>、添加装饰器前必须导入<span class="token keyword">from</span> django<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> method_decorator
<span class="token number">2</span>、添加装饰器的格式必须为@method_decorator<span class="token punctuation">(</span><span class="token punctuation">)</span>，括号里面为装饰器的函数名
给类添加是必须声明name
<span class="token number">3</span>、注意csrf<span class="token operator">-</span>token装饰器的特殊性，在CBV模式下它只能加在dispatch上面<span class="token punctuation">(</span>后面再说<span class="token punctuation">)</span>

　　下面这是csrf_token的装饰器：
　　<span class="token decorator annotation punctuation">@csrf_protect</span>，为当前函数强制设置防跨站请求伪造功能，即便settings中没有设置csrfToken全局中间件。
　　<span class="token decorator annotation punctuation">@csrf_exempt</span>，取消当前函数防跨站请求伪造功能，即便settings中设置了全局中间件。

注意导入的语法：
<span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>csrf <span class="token keyword">import</span> csrf_exempt<span class="token punctuation">,</span>csrf_protect
　　
</code></pre></div></li> <li><h5 id="案例演示"><a href="#案例演示" class="header-anchor">#</a> 案例演示：</h5> <ul><li><p>在视图函数中我们可以结合路由传参和反射来整合代码，比如在学生、教师以及班级模型中，删除函数单一，我们就可以进行整合，（需要注意的时：在使用CBV、和FBV进行传参时，有些需要注意的地方）如下：</p> <div class="language-python extra-class"><pre class="language-python"><code> <span class="token comment"># url.py文件中：</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url
<span class="token keyword">from</span> app <span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    url<span class="token punctuation">(</span><span class="token string">r'^(student|class|teacher)_list/$'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>list_func<span class="token punctuation">)</span><span class="token punctuation">,</span> 
    url<span class="token punctuation">(</span><span class="token string">r'^del_(student|class|teacher)/(\d+)/$'</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>del_func<span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^add_(?P&lt;name&gt;student|class|teacher)/$'</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>Add_Func<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 接受的无名参数将触发get、post函数的一个参数，必须相应的接收参数。</span>
    <span class="token comment"># url(r'^add_(?P&lt;targe&gt;student|class|teacher)/$', views.Add_Func.as_view()),  # 接受的无名参数将触发get、post函数的一个参数,名字必须时targe    </span>
<span class="token punctuation">]</span> 

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>对应的视图函数views<span class="token punctuation">.</span>py<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span>redirect<span class="token punctuation">,</span>HttpResponse
<span class="token keyword">from</span> app <span class="token keyword">import</span>  models
<span class="token keyword">from</span> django<span class="token punctuation">.</span>views <span class="token keyword">import</span> View

<span class="token comment"># 原本的FBV，要写三个del_xxx</span>
<span class="token keyword">def</span> <span class="token function">del_student</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    student_id <span class="token operator">=</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span>
    del_list <span class="token operator">=</span> models<span class="token punctuation">.</span>Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>student_id<span class="token punctuation">)</span>
    <span class="token keyword">if</span> del_list<span class="token punctuation">:</span>
        del_list<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/app/student_list/'</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'删除错误'</span><span class="token punctuation">)</span>
    
<span class="token comment">#整合删除方法 （反射）</span>
<span class="token keyword">def</span> <span class="token function">del_func</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> table<span class="token punctuation">,</span> get_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span>capitalize<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>get_id<span class="token punctuation">)</span>
    table_name <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>models<span class="token punctuation">,</span>table<span class="token punctuation">.</span>capitalize<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    del_list <span class="token operator">=</span> table_name<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span> <span class="token operator">=</span> get_id<span class="token punctuation">)</span>
    <span class="token keyword">if</span> del_list<span class="token punctuation">:</span>
        del_list<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/app/student_list/'</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token keyword">return</span>  HttpResponse<span class="token punctuation">(</span><span class="token string">'删除错误'</span><span class="token punctuation">)</span>

<span class="token comment">#整合首页方法</span>
<span class="token keyword">def</span> <span class="token function">list_func</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    table_name <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>models<span class="token punctuation">,</span> name<span class="token punctuation">.</span>capitalize<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    obj <span class="token operator">=</span> table_name<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">_list.html&quot;</span></span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'list'</span><span class="token punctuation">:</span>obj<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">#整合所有的添加方法</span>
<span class="token keyword">class</span> <span class="token class-name">Add_Func</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>
    error_msg <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token decorator annotation punctuation">@timer</span>
    <span class="token keyword">def</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 注意如果这里你不写name，将会被arg没收</span>
        ret <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dispatch<span class="token punctuation">(</span>request<span class="token punctuation">,</span>name<span class="token punctuation">)</span>  <span class="token comment"># 注意要还给每个参数中都传入这个name</span>
        <span class="token keyword">return</span> ret  <span class="token comment"># 每个方法都要有return</span>
    
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        class_obj_list <span class="token operator">=</span> models<span class="token punctuation">.</span>Class<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'add_</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">.html'</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'error_msg'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>error_msg<span class="token punctuation">,</span> <span class="token string">'list'</span><span class="token punctuation">:</span> class_obj_list<span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        obj_name <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
        class_id <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'class_id'</span><span class="token punctuation">)</span>
        cls <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>models<span class="token punctuation">,</span> name<span class="token punctuation">.</span>capitalize<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 保存图片</span>
        <span class="token keyword">if</span> name <span class="token operator">==</span> <span class="token string">'student'</span><span class="token punctuation">:</span>
            f1 <span class="token operator">=</span> request<span class="token punctuation">.</span>FILES<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'f1'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> obj_name <span class="token keyword">and</span> <span class="token keyword">not</span> f1<span class="token punctuation">:</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>f1<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    <span class="token keyword">for</span> i <span class="token keyword">in</span> f1<span class="token punctuation">.</span>chunks<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># chunks：块的意思</span>
                        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
                        
                cls<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span>obj_name<span class="token punctuation">,</span> classes_id<span class="token operator">=</span>class_id<span class="token punctuation">)</span>
                <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'/app/</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">_list/'</span></span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>error_msg <span class="token operator">=</span> <span class="token string">'信息和头像不能为空'</span>
                class_obj_list <span class="token operator">=</span> cls<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'add_</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">.html'</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'error_msg'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>error_msg<span class="token punctuation">,</span> <span class="token string">'list'</span><span class="token punctuation">:</span> class_obj_list<span class="token punctuation">}</span><span class="token punctuation">)</span>
        
        <span class="token keyword">elif</span> name <span class="token operator">==</span> <span class="token string">'class'</span><span class="token punctuation">:</span>
            class_name <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> class_name<span class="token punctuation">:</span>
                <span class="token keyword">if</span> models<span class="token punctuation">.</span>Class<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span>class_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>error_msg <span class="token operator">=</span> <span class="token string">'班级信息已经存在'</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    models<span class="token punctuation">.</span>Class<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span>class_name<span class="token punctuation">)</span>
                    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/app/class_list/'</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>error_msg <span class="token operator">=</span> <span class="token string">'信息不能为空'</span>
            <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'add_class.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'error'</span><span class="token punctuation">:</span>self<span class="token punctuation">.</span>error_msg<span class="token punctuation">}</span><span class="token punctuation">)</span>
        
        <span class="token keyword">elif</span> name <span class="token operator">==</span> <span class="token string">'teacher'</span><span class="token punctuation">:</span>
            class_obj_list <span class="token operator">=</span> models<span class="token punctuation">.</span>Class<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
                teacher_name <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'teacher'</span><span class="token punctuation">)</span>
                class_ids <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>getlist<span class="token punctuation">(</span><span class="token string">'class_id'</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> teacher_name<span class="token punctuation">:</span>
                    new_teacher_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Teacher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span>teacher_name<span class="token punctuation">)</span>
                    new_teacher_obj<span class="token punctuation">.</span>classes<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>class_ids<span class="token punctuation">)</span>  <span class="token comment"># set加列表，给这个关系管理表重新赋值</span>
                    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/app/teacher_list/'</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>      
                    self<span class="token punctuation">.</span>error_msg <span class="token operator">=</span> <span class="token string">'老师姓名不能为空'</span>
            <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'add_teacher.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'list'</span><span class="token punctuation">:</span> class_obj_list<span class="token punctuation">,</span> <span class="token string">'error'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>error_msg<span class="token punctuation">}</span><span class="token punctuation">)</span>
            
</code></pre></div></li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/python/django/模型层.html" class="prev">
        模型层
      </a></span> <span class="next"><a href="/python/django/单表操作.html">
        单表操作
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.51f2f156.js" defer></script><script src="/assets/js/2.8911ec45.js" defer></script><script src="/assets/js/57.f8eceb45.js" defer></script>
  </body>
</html>
