<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>单表操作 | 独角兕大王</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.ccac5a78.css" as="style"><link rel="preload" href="/assets/js/app.51f2f156.js" as="script"><link rel="preload" href="/assets/js/2.8911ec45.js" as="script"><link rel="preload" href="/assets/js/56.bde381df.js" as="script"><link rel="prefetch" href="/assets/js/10.6948c28b.js"><link rel="prefetch" href="/assets/js/100.276864ee.js"><link rel="prefetch" href="/assets/js/101.447ab1c7.js"><link rel="prefetch" href="/assets/js/102.f5b3c71d.js"><link rel="prefetch" href="/assets/js/103.16474d4b.js"><link rel="prefetch" href="/assets/js/104.ed58aef3.js"><link rel="prefetch" href="/assets/js/105.045203cd.js"><link rel="prefetch" href="/assets/js/106.be359e0b.js"><link rel="prefetch" href="/assets/js/107.7331bbca.js"><link rel="prefetch" href="/assets/js/108.76e1c800.js"><link rel="prefetch" href="/assets/js/109.e82166f3.js"><link rel="prefetch" href="/assets/js/11.d4ec37c8.js"><link rel="prefetch" href="/assets/js/110.4144755a.js"><link rel="prefetch" href="/assets/js/111.5864ab53.js"><link rel="prefetch" href="/assets/js/112.ca2aee84.js"><link rel="prefetch" href="/assets/js/113.641e7765.js"><link rel="prefetch" href="/assets/js/114.d69f8545.js"><link rel="prefetch" href="/assets/js/115.1b6a9f89.js"><link rel="prefetch" href="/assets/js/116.dde2c44e.js"><link rel="prefetch" href="/assets/js/117.4e79498c.js"><link rel="prefetch" href="/assets/js/12.7aac9c8d.js"><link rel="prefetch" href="/assets/js/13.abf127cd.js"><link rel="prefetch" href="/assets/js/14.aa4413a7.js"><link rel="prefetch" href="/assets/js/15.11a64e5b.js"><link rel="prefetch" href="/assets/js/16.f2d9a882.js"><link rel="prefetch" href="/assets/js/17.11c5bb7f.js"><link rel="prefetch" href="/assets/js/18.a522877b.js"><link rel="prefetch" href="/assets/js/19.6f31a972.js"><link rel="prefetch" href="/assets/js/20.b546c54e.js"><link rel="prefetch" href="/assets/js/21.6d055b7f.js"><link rel="prefetch" href="/assets/js/22.c48feceb.js"><link rel="prefetch" href="/assets/js/23.69941f78.js"><link rel="prefetch" href="/assets/js/24.6126dfc2.js"><link rel="prefetch" href="/assets/js/25.3475449c.js"><link rel="prefetch" href="/assets/js/26.96bb4643.js"><link rel="prefetch" href="/assets/js/27.da610e5d.js"><link rel="prefetch" href="/assets/js/28.b24ec15c.js"><link rel="prefetch" href="/assets/js/29.ec8af553.js"><link rel="prefetch" href="/assets/js/3.bec5f768.js"><link rel="prefetch" href="/assets/js/30.2e780db1.js"><link rel="prefetch" href="/assets/js/31.464c36ed.js"><link rel="prefetch" href="/assets/js/32.ad7d37c2.js"><link rel="prefetch" href="/assets/js/33.722f1ec5.js"><link rel="prefetch" href="/assets/js/34.8448d0fd.js"><link rel="prefetch" href="/assets/js/35.e5168ac9.js"><link rel="prefetch" href="/assets/js/36.edc404f1.js"><link rel="prefetch" href="/assets/js/37.5807602e.js"><link rel="prefetch" href="/assets/js/38.a519c89a.js"><link rel="prefetch" href="/assets/js/39.89af1b9a.js"><link rel="prefetch" href="/assets/js/4.5ed19beb.js"><link rel="prefetch" href="/assets/js/40.6c653db9.js"><link rel="prefetch" href="/assets/js/41.bc3b8b69.js"><link rel="prefetch" href="/assets/js/42.a0a02d9b.js"><link rel="prefetch" href="/assets/js/43.62f344e3.js"><link rel="prefetch" href="/assets/js/44.a7fd9d68.js"><link rel="prefetch" href="/assets/js/45.729c1c39.js"><link rel="prefetch" href="/assets/js/46.5b924aea.js"><link rel="prefetch" href="/assets/js/47.f3990404.js"><link rel="prefetch" href="/assets/js/48.f591f360.js"><link rel="prefetch" href="/assets/js/49.f7f213ad.js"><link rel="prefetch" href="/assets/js/5.2c5d28b5.js"><link rel="prefetch" href="/assets/js/50.b9ca2762.js"><link rel="prefetch" href="/assets/js/51.93672ee6.js"><link rel="prefetch" href="/assets/js/52.fb21314a.js"><link rel="prefetch" href="/assets/js/53.65343ccc.js"><link rel="prefetch" href="/assets/js/54.8081227d.js"><link rel="prefetch" href="/assets/js/55.e207659e.js"><link rel="prefetch" href="/assets/js/57.f8eceb45.js"><link rel="prefetch" href="/assets/js/58.bef70bfd.js"><link rel="prefetch" href="/assets/js/59.7ab7562d.js"><link rel="prefetch" href="/assets/js/6.fc65a1ac.js"><link rel="prefetch" href="/assets/js/60.f40ac3ca.js"><link rel="prefetch" href="/assets/js/61.d2b463ab.js"><link rel="prefetch" href="/assets/js/62.cfdf1bcf.js"><link rel="prefetch" href="/assets/js/63.1e45ce59.js"><link rel="prefetch" href="/assets/js/64.a98fe86e.js"><link rel="prefetch" href="/assets/js/65.0234d7c5.js"><link rel="prefetch" href="/assets/js/66.724906f0.js"><link rel="prefetch" href="/assets/js/67.7806fda6.js"><link rel="prefetch" href="/assets/js/68.9f227dae.js"><link rel="prefetch" href="/assets/js/69.fdbc56ac.js"><link rel="prefetch" href="/assets/js/7.284de54e.js"><link rel="prefetch" href="/assets/js/70.04a9cc03.js"><link rel="prefetch" href="/assets/js/71.a6fa1dd9.js"><link rel="prefetch" href="/assets/js/72.2f8e3aa0.js"><link rel="prefetch" href="/assets/js/73.9bbb0cb6.js"><link rel="prefetch" href="/assets/js/74.9f122255.js"><link rel="prefetch" href="/assets/js/75.75e1fbd8.js"><link rel="prefetch" href="/assets/js/76.60ff3c3e.js"><link rel="prefetch" href="/assets/js/77.39a253ae.js"><link rel="prefetch" href="/assets/js/78.0e49712f.js"><link rel="prefetch" href="/assets/js/79.5f9c24a0.js"><link rel="prefetch" href="/assets/js/8.5c21a4cc.js"><link rel="prefetch" href="/assets/js/80.f826f188.js"><link rel="prefetch" href="/assets/js/81.b8995ea7.js"><link rel="prefetch" href="/assets/js/82.e9bf63e0.js"><link rel="prefetch" href="/assets/js/83.e3a00749.js"><link rel="prefetch" href="/assets/js/84.b940927c.js"><link rel="prefetch" href="/assets/js/85.ad46a9b2.js"><link rel="prefetch" href="/assets/js/86.190e0071.js"><link rel="prefetch" href="/assets/js/87.5f9eb9ef.js"><link rel="prefetch" href="/assets/js/88.cfaf7469.js"><link rel="prefetch" href="/assets/js/89.e64cc32c.js"><link rel="prefetch" href="/assets/js/9.0723805d.js"><link rel="prefetch" href="/assets/js/90.805edabe.js"><link rel="prefetch" href="/assets/js/91.6a1ab3f7.js"><link rel="prefetch" href="/assets/js/92.04ecd01e.js"><link rel="prefetch" href="/assets/js/93.e615470a.js"><link rel="prefetch" href="/assets/js/94.0ad7c41c.js"><link rel="prefetch" href="/assets/js/95.0e5ce618.js"><link rel="prefetch" href="/assets/js/96.b59cf9f4.js"><link rel="prefetch" href="/assets/js/97.2a327746.js"><link rel="prefetch" href="/assets/js/98.9c01ec88.js"><link rel="prefetch" href="/assets/js/99.952046bd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ccac5a78.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://github.com/fluidicon.png" alt="独角兕大王" class="logo"> <span class="site-name can-hide">独角兕大王</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/python/" class="nav-link router-link-active">
  Python
</a></div><div class="nav-item"><a href="/rust/" class="nav-link">
  Rust
</a></div><div class="nav-item"><a href="/go/" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/lua/" class="nav-link">
  Lua
</a></div><div class="nav-item"><a href="/C/" class="nav-link">
  C++
</a></div><div class="nav-item"><a href="https://github.com/wuyuz" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.cnblogs.com/double-W/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  cnblogs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/python/" class="nav-link router-link-active">
  Python
</a></div><div class="nav-item"><a href="/rust/" class="nav-link">
  Rust
</a></div><div class="nav-item"><a href="/go/" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/lua/" class="nav-link">
  Lua
</a></div><div class="nav-item"><a href="/C/" class="nav-link">
  C++
</a></div><div class="nav-item"><a href="https://github.com/wuyuz" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.cnblogs.com/double-W/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  cnblogs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python常用模块</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Django框架</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/python/django/Web框架本质.html" class="sidebar-link">Web框架本质</a></li><li><a href="/python/django/resquest、模块层.html" class="sidebar-link">resquest、模块层</a></li><li><a href="/python/django/静态文件和ORM.html" class="sidebar-link">静态文件和ORM</a></li><li><a href="/python/django/标签、自定义标签.html" class="sidebar-link">模块层之标签、自定义标签</a></li><li><a href="/python/django/模版语法.html" class="sidebar-link">模版语法</a></li><li><a href="/python/django/模型层.html" class="sidebar-link">模型层</a></li><li><a href="/python/django/反向解析和视图函数.html" class="sidebar-link">反向解析和视图函数</a></li><li><a href="/python/django/单表操作.html" class="active sidebar-link">单表操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/django/单表操作.html#单表操作" class="sidebar-link">单表操作</a></li><li class="sidebar-sub-header"><a href="/python/django/单表操作.html#查询表记录" class="sidebar-link">查询表记录</a></li><li class="sidebar-sub-header"><a href="/python/django/单表操作.html#基于双下划线的模糊查询" class="sidebar-link">基于双下划线的模糊查询</a></li></ul></li><li><a href="/python/django/多表操作.html" class="sidebar-link">多表操作</a></li><li><a href="/python/django/中间件.html" class="sidebar-link">中间件</a></li><li><a href="/python/django/模型进阶.html" class="sidebar-link">模型进阶</a></li><li><a href="/python/django/缓存和信号.html" class="sidebar-link">缓存和信号</a></li><li><a href="/python/django/form组件.html" class="sidebar-link">form组件</a></li><li><a href="/python/django/csrf和Ajax.html" class="sidebar-link">csrf和Ajax</a></li><li><a href="/python/django/APIView使用和源码分析.html" class="sidebar-link">APIView使用和源码分析</a></li><li><a href="/python/django/REST framework之版本和解析器.html" class="sidebar-link">REST framework之版本和解析器</a></li><li><a href="/python/django/REST framework之分页和视图组件.html" class="sidebar-link">REST framework之分页和视图组件</a></li><li><a href="/python/django/REST framework之路由和渲染器.html" class="sidebar-link">REST framework之路由和渲染器</a></li><li><a href="/python/django/REST framework之序列化器.html" class="sidebar-link">REST framework之序列化器</a></li><li><a href="/python/django/REST framework版本图书管理系统.html" class="sidebar-link">REST framework版本图书管理系统</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flask 框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python爬虫</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python设计模式</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="单表操作"><a href="#单表操作" class="header-anchor">#</a> 单表操作</h2> <h4 id="前期准备"><a href="#前期准备" class="header-anchor">#</a> 前期准备</h4> <ul><li><p>models.py 编写对应生成的数据库的表，创建后makemigration ---&gt; migrate生成表在数据库中</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 注释这个类后，makemigrations再migrate就会在库中删除这个类对应的表</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> models<span class="token punctuation">.</span>AutoField<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    book <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span>unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    price <span class="token operator">=</span> models<span class="token punctuation">.</span>DecimalField<span class="token punctuation">(</span>max_digits<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span>decimal_places<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment"># 后面一个参数是小数位数</span>
    pub_date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    publish <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>在视图函数中添加一个用于存储数据的函数（前期通过这种方式来演示过程）</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span>HttpResponse
<span class="token keyword">from</span> app<span class="token punctuation">.</span>models <span class="token keyword">import</span> Book  <span class="token comment"># 导入Book类（表）</span>

<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'执行成功'</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>中心思想</strong></p> <div class="language- extra-class"><pre class="language-text"><code>在python中ORM的对应关系有三种：
　　　　类(Book)             ----------&gt; 表 (table)

　　　　类对象(obj_book)      ----------&gt; 行(记录)

　　　　类属性(obj_book.book) ----------&gt; 表的字段（重点）
</code></pre></div></li></ul> <h4 id="添加表记录"><a href="#添加表记录" class="header-anchor">#</a> 添加表记录</h4> <ul><li><p>在views.py文件中的添加数据方式</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span>HttpResponse
<span class="token keyword">from</span> app<span class="token punctuation">.</span>models <span class="token keyword">import</span> Book
<span class="token keyword">import</span>  datetime

<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#方式一：通过save()来保存，这里的obj_book是Book的一个实例化，也就是一条记录</span>
    time <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">#这里使用datetime结构插入时间，还可以使用引号的字符串插入</span>
    obj_book <span class="token operator">=</span> Book<span class="token punctuation">(</span>book<span class="token operator">=</span><span class="token string">'Python'</span><span class="token punctuation">,</span>price <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">,</span>pub_date<span class="token operator">=</span>time<span class="token punctuation">,</span>publish<span class="token operator">=</span><span class="token string">'人民出版社'</span><span class="token punctuation">)</span>
    obj_book<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment">#方式二：通过create方法  （Book继承的父类Model中的有create方法，其返回值book_obj就是插入book表中的对象（记录）</span>
    obj_book <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>book<span class="token operator">=</span><span class="token string">'葵花宝典'</span><span class="token punctuation">,</span>price<span class="token operator">=</span><span class="token number">123.4</span><span class="token punctuation">,</span>pub_date<span class="token operator">=</span><span class="token string">&quot;2013-12-12&quot;</span><span class="token punctuation">,</span>publish<span class="token operator">=</span><span class="token string">&quot;中国人民音乐出版社&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>obj_book<span class="token punctuation">.</span>book<span class="token punctuation">)</span>  <span class="token comment">#这里create已经存储好我们的对象了，并且返回这个对象(记录）给我们，我们来打印下名字（对象的属性等于表的字段）</span>
  
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
    <span class="token comment">#我们甚至可以使用打散的字典来输入,相应的字段属性要使用引号</span>
    dic2<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'book'</span><span class="token punctuation">:</span><span class="token string">'linux'</span><span class="token punctuation">,</span><span class="token string">'price'</span><span class="token punctuation">:</span><span class="token number">125</span><span class="token punctuation">,</span><span class="token string">'pub_date'</span><span class="token punctuation">:</span><span class="token string">'2012-12-14'</span><span class="token punctuation">,</span><span class="token string">'publish'</span><span class="token punctuation">:</span><span class="token string">'老男孩出版社'</span><span class="token punctuation">}</span>
    obj_book1 <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token operator">**</span>dic2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>obj_book1<span class="token punctuation">.</span>book<span class="token punctuation">)</span>  
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'执行成功'</span><span class="token punctuation">)</span>

<span class="token comment"># 这个Book.objects就像是一个Book表的管理器一样，提供了增删改查所有的方法（其实是继承的Model）</span>
    <span class="token comment">#objects：表示管理器。</span>
    <span class="token comment">#Book.objects：表示管理book表。</span>
    <span class="token comment">#book.objects.create：表示增加操作。</span>
 
<span class="token comment">#如果最终在创建新对象的时候比较麻烦，因为你的每条记录都要给他传参：</span>
    <span class="token number">1</span>、先使用name <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>……
    <span class="token number">2</span>、然后将每个name、属性赋值到Book类中实例化，属性一多就很难麻烦
    <span class="token number">3</span>、所以我们可以使用字典的打散传参：dic<span class="token operator">=</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       需要注意的是里面有一个crsf的键值对，需要删除：<span class="token keyword">del</span> dic<span class="token punctuation">[</span><span class="token string">'crf……'</span><span class="token punctuation">]</span> <span class="token punctuation">,</span>然后Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token operator">**</span>dic<span class="token punctuation">)</span>
</code></pre></div></li> <li><h5 id="批量插入-bulk-create"><a href="#批量插入-bulk-create" class="header-anchor">#</a> 批量插入（bulk_create)</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 使用 bulk_create() 来批量插入</span>
    book_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        bk_obj <span class="token operator">=</span> Book<span class="token punctuation">(</span>
            book<span class="token operator">=</span><span class="token string">'Python%s'</span> <span class="token operator">%</span> i<span class="token punctuation">,</span>
            price<span class="token operator">=</span><span class="token number">123</span> <span class="token operator">+</span> i<span class="token punctuation">,</span>
            pub_date<span class="token operator">=</span><span class="token string">&quot;2013-12-12&quot;</span><span class="token punctuation">,</span>
            publish<span class="token operator">=</span><span class="token string">&quot;人民出版社&quot;</span>
        <span class="token punctuation">)</span>
        book_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>bk_obj<span class="token punctuation">)</span>
    Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>bulk_create<span class="token punctuation">(</span>book_list<span class="token punctuation">)</span>  <span class="token comment"># bulk_create() 对一个列表中的对象执行save()</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'执行完成'</span><span class="token punctuation">)</span>

<span class="token comment">#上面的方法太麻烦了，我们可以使用打散的方式，来传参（下面有讲）</span>
</code></pre></div></li> <li><h5 id="有则更新-无则添加-update-or-create"><a href="#有则更新-无则添加-update-or-create" class="header-anchor">#</a> 有则更新，无则添加(update_or_create)</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 需要中注意的是，update_or_create使用get方法，只不过在没有找到时做了异常处理（get不允许找不到）</span>
    <span class="token comment"># 且在筛选条件能筛选出多条时，也会报错（没有作异常处理：get() returned more than one Book -- it returned 3 重复3次）</span>
    <span class="token comment"># 所以要尽量筛选唯一的主键</span>
    obj<span class="token punctuation">,</span>created <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>update_or_create<span class="token punctuation">(</span>
        book <span class="token operator">=</span> <span class="token string">'python15'</span><span class="token punctuation">,</span> <span class="token comment"># 筛选条件，有没有，没有执行下面的，有就更新, 这里筛选price=123，会筛选多条而出错</span>
        defaults<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">'book'</span><span class="token punctuation">:</span><span class="token string">'Python15'</span><span class="token punctuation">,</span>
            <span class="token string">'price'</span><span class="token punctuation">:</span><span class="token number">123</span><span class="token punctuation">,</span>
            <span class="token string">'pub_date'</span><span class="token punctuation">:</span><span class="token string">'2014-12-14'</span><span class="token punctuation">,</span>
            <span class="token string">'publish'</span><span class="token punctuation">:</span><span class="token string">'北京出版社'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>created<span class="token punctuation">)</span>  <span class="token comment"># Book object    True  True表示没有查询到，重新创建的</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'执行完成'</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><h5 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#当我们忘了给一个默认不能为空的字段，插入数据时，可能会报错：&quot;Column 'price' cannot be null&quot;,我们能可以在models.py中重新修改Book类，比如：price设置为默认可为空，且添加一个新字段：</span>

<span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 注释这个类后，makemigrations再migrate就会在库中删除这个类对应的表</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> models<span class="token punctuation">.</span>AutoField<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    book <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span>unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    price <span class="token operator">=</span> models<span class="token punctuation">.</span>DecimalField<span class="token punctuation">(</span>max_digits<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span>decimal_places<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment"># 后面一个参数是小数位数</span>
    pub_date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    publish <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
    is_pub <span class="token operator">=</span> models<span class="token punctuation">.</span>BooleanField<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>会出现下面情况：(因为在类中is_pub中没有设置初始值。)</p></li> <li><p><strong>实例</strong>：实现表单登陆，登陆成功跳转到一个网址</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#views.py文件中</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span>HttpResponse<span class="token punctuation">,</span>redirect
<span class="token keyword">from</span> app1<span class="token punctuation">.</span>models <span class="token keyword">import</span> User

<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'index2.html'</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        ret <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>password<span class="token operator">=</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> ret<span class="token punctuation">:</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'Failed'</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token comment">#models.py文件</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> models<span class="token punctuation">.</span>AutoField<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
    password <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="查询表记录"><a href="#查询表记录" class="header-anchor">#</a> 查询表记录</h2> <ul><li><p>还记得表类.objects像是一个管理器，提供了增删改查的方法，Book.objects.all()获取所有的书籍，查询这里大家就掌握谁调用的下面的方法。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span> <span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                  查询所有结果，结果是queryset类型
  
<span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">&gt;</span> <span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>       它包含了与所给筛选条件相匹配的对象，结果也是queryset类型 	   	  	   
  							Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span>price<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token comment">#里面的多个条件用逗号分开，并且这几个条件必须都成  							立，是and的关系，or关系的我们后面再学，直接在这里写是搞不定or的</span>
  
<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;</span> get<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>          返回与所给筛选条件相匹配的对象，不是queryset类型，是行记录对象，返回结果有且只有一个，
                            如果符合筛选条件的对象超过一个或者没有都会抛出错误。捕获异常<span class="token keyword">try</span>。  Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
  
<span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">&gt;</span> exclude<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>      排除的意思，它包含了与所给筛选条件不匹配的对象，没有不等于的操作昂，用这个exclude，返回值是queryset							 类型 Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>exclude<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>，返回<span class="token builtin">id</span>不等于<span class="token number">6</span>的所有的对象，或者在queryset基础上调用，      		                     Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exclude<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>
 　　　　　　　　　　　　　　　　
<span class="token operator">&lt;</span><span class="token number">5</span><span class="token operator">&gt;</span> order_by<span class="token punctuation">(</span><span class="token operator">*</span>field<span class="token punctuation">)</span><span class="token punctuation">:</span>       queryset类型的数据来调用，对查询结果排序<span class="token punctuation">,</span>默认是按照<span class="token builtin">id</span>来升序排列的，返回值还是queryset类型
　　　　　　　　　　　　　　　　  models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'price'</span><span class="token punctuation">,</span><span class="token string">'id'</span><span class="token punctuation">)</span> <span class="token comment">#直接写price，默认是按照price升序排列，按							 照字段降序排列，就写个负号就行了order_by('-price'),order_by('price','id')是多条件排序，按照     						  price进行升序，price相同的数据，按照id进行升序</span>
        
<span class="token operator">&lt;</span><span class="token number">6</span><span class="token operator">&gt;</span> reverse<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>              queryset类型的数据来调用，对查询结果反向排序，返回值还是queryset类型
  
<span class="token operator">&lt;</span><span class="token number">7</span><span class="token operator">&gt;</span> count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                queryset类型的数据来调用，返回数据库中匹配查询<span class="token punctuation">(</span>QuerySet<span class="token punctuation">)</span>的对象数量。
  
<span class="token operator">&lt;</span><span class="token number">8</span><span class="token operator">&gt;</span> first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>         	   queryset类型的数据来调用，返回第一条记录 Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> 
						   Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>，得到的都是model对象，不是queryset 
  
<span class="token operator">&lt;</span><span class="token number">9</span><span class="token operator">&gt;</span> last<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                queryset类型的数据来调用，返回最后一条记录
  
<span class="token operator">&lt;</span><span class="token number">10</span><span class="token operator">&gt;</span> exists<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>               queryset类型的数据来调用，如果QuerySet包含数据，就返回<span class="token boolean">True</span>，否则返回<span class="token boolean">False</span>
　　　　　　　　　　　　　　      空的queryset类型数据也有布尔值<span class="token boolean">True</span>和<span class="token boolean">False</span>，但是一般不用它来判断数据库里面是不是有数据，如果有大量的							   数据，你用它来判断，那么就需要查询出所有的数据，效率太差了，用count或者exits
　　　　　　　　　　　　　　　　 例：all_books <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#翻译成的sql是SELECT (1) AS `a` FROM 								`app01_book` LIMIT 1，就是通过limit 1，取一条来看看是不是有数据</span>

<span class="token operator">&lt;</span><span class="token number">11</span><span class="token operator">&gt;</span> values<span class="token punctuation">(</span><span class="token operator">*</span>field<span class="token punctuation">)</span><span class="token punctuation">:</span>        用的比较多，queryset类型的数据来调用，返回一个ValueQuerySet——一个特殊的QuerySet，运行后得到的并不							是一系列
                            model的实例化对象，而是一个可迭代的字典序列<span class="token punctuation">,</span>只要是返回的queryset类型，就可以继续链式调用queryset类							型的其他的查找方法，其他方法也是一样的。
<span class="token operator">&lt;</span><span class="token number">12</span><span class="token operator">&gt;</span> values_list<span class="token punctuation">(</span><span class="token operator">*</span>field<span class="token punctuation">)</span><span class="token punctuation">:</span>   它与values<span class="token punctuation">(</span><span class="token punctuation">)</span>非常相似，它返回的是一个元组序列，values返回的是一个字典序列
 
<span class="token operator">&lt;</span><span class="token number">13</span><span class="token operator">&gt;</span> distinct<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            values和values_list得到的queryset类型的数据来调用，从返回结果中剔除重复纪
</code></pre></div></li> <li><h5 id="all-查询所有结果"><a href="#all-查询所有结果" class="header-anchor">#</a> all() 查询所有结果</h5> <div class="language-python extra-class"><pre class="language-python"><code>它返回的是QuerySet数据类型对象，它是django ROM特有的数据类型。
	数据格式为：<span class="token punctuation">[</span>model对象<span class="token number">1</span>，model对象<span class="token number">2</span>，model对象<span class="token number">3</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> ；它和下面的 animal_list类似。先是一个列表，列表的元素是一个对象。
	一个对象，就是一条记录。有多少条记录，就有多少个对象。那么Queryset就是对象<span class="token punctuation">(</span>记录<span class="token punctuation">)</span>的集合体，我们可以通过下标访问每个对象（记录）
	
</code></pre></div></li> <li><p><strong>实例</strong></p> <div class="language-python extra-class"><pre class="language-python"><code> <span class="token comment">#查询环节的配置，url.py中新添加一个路径</span>

urlpatterns<span class="token operator">=</span><span class="token punctuation">[</span>
      url<span class="token punctuation">(</span><span class="token string">'^$'</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span>
      url<span class="token punctuation">(</span><span class="token string">'^query/$'</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>query<span class="token punctuation">)</span>

<span class="token punctuation">]</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
修改views<span class="token punctuation">.</span>py文件
  <span class="token keyword">def</span> <span class="token function">query</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
      ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#可进行切片</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>      <span class="token comment">#&lt;QuerySet [&lt;Book: Book object&gt;, &lt;Book: Book object&gt;, &lt;Book: Book object&gt;,……]</span>
      <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>book<span class="token punctuation">)</span>  <span class="token comment"># Python0</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'执行完成'</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <p><strong>格式化输出</strong>：上面的放回的QuerySet太长了，因为对象没有设置__str__函数，当对象被打印时显示的是自己的名字（没人会叫你身份证的号码）</p> <div class="language-python extra-class"><pre class="language-python"><code>   <span class="token keyword">class</span> <span class="token class-name">Animal</span><span class="token punctuation">:</span>
      <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>
          self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
          self<span class="token punctuation">.</span>age <span class="token operator">=</span> age
      <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>  
          <span class="token keyword">return</span> self<span class="token punctuation">.</span>name
          
  dog <span class="token operator">=</span> Animal<span class="token punctuation">(</span><span class="token string">&quot;旺财&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span>  <span class="token comment">#旺财</span>
  
  <span class="token comment">#修改models.py</span>
  <span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 注释这个类后，makemigrations再migrate就会在库中删除这个类对应的表</span>
      <span class="token builtin">id</span> <span class="token operator">=</span> models<span class="token punctuation">.</span>AutoField<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
      book <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span>unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
      price <span class="token operator">=</span> models<span class="token punctuation">.</span>DecimalField<span class="token punctuation">(</span>max_digits<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span>decimal_places<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment"># 后面一个参数是小数位数</span>
      pub_date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span><span class="token punctuation">)</span>
      publish <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
      is_pub <span class="token operator">=</span> models<span class="token punctuation">.</span>BooleanField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
         
      <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
          <span class="token keyword">return</span> self<span class="token punctuation">.</span>book
        
<span class="token comment">#再次执行query函数</span>
 <span class="token keyword">def</span> <span class="token function">query</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
      ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>   <span class="token comment">#&lt;QuerySet [&lt;Book: Python0&gt;, &lt;Book: Python1&gt;, &lt;Book: Python2&gt;,……]</span>
      <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>book<span class="token punctuation">)</span>  <span class="token comment">#Python0</span>
      <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'执行完成'</span><span class="token punctuation">)</span> 
  
   <span class="token comment">#需要注意的是：QuerySet其实就是ORM对表对象的一个存储的数据类型，里面装得就是model对象，只有model对象才能调用属性，QuerySet只能对model对象进行筛选，组织等,也就是说QuerySet通过索引可以讲里面的元素转化为model对象。QuerySet不能直接调用属性，即使它只有一个对象。</span>
</code></pre></div><hr> <ul><li><h5 id="filter-kwargs-它包含了与所给筛选条件相匹配的对象-可多条件筛选"><a href="#filter-kwargs-它包含了与所给筛选条件相匹配的对象-可多条件筛选" class="header-anchor">#</a> filter(**kwargs):  它包含了与所给筛选条件相匹配的对象（可多条件筛选）</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">query</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># ret = Book.objects.filter(publish=&quot;北京出版社&quot;).filter(book='python15') #等价下面的</span>
    ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>publish<span class="token operator">=</span><span class="token string">&quot;北京出版社&quot;</span><span class="token punctuation">,</span>book<span class="token operator">=</span><span class="token string">'python15'</span><span class="token punctuation">)</span>  <span class="token comment">#多条件是and关系，全对才对</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>    <span class="token comment">#&lt;QuerySet [&lt;Book: Python15&gt;]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>book<span class="token punctuation">)</span>   
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'执行完成'</span><span class="token punctuation">)</span>

<span class="token comment">#fliter 之前本身只能实现and条件判断，即全对才行，下面我们能将然他实现or条件判断：需要导入</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Q

<span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>msg<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 实现搜索出版社或则书名的其中一种</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">:</span>
        flag <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>Q<span class="token punctuation">(</span>title__contains<span class="token operator">=</span>msg<span class="token punctuation">)</span><span class="token operator">|</span>Q<span class="token punctuation">(</span>publish<span class="token operator">=</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> flag<span class="token punctuation">:</span>
            ret <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>Q<span class="token punctuation">(</span>title__contains<span class="token operator">=</span>msg<span class="token punctuation">)</span><span class="token operator">|</span>Q<span class="token punctuation">(</span>publish<span class="token operator">=</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'index.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'book_list'</span><span class="token punctuation">:</span>ret<span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            hint <span class="token operator">=</span> <span class="token string">'&lt;script&gt; alert(&quot;没有相应结果，请输入书名搜索&quot;);window.location.href=&quot;/app/&quot;&lt;/script&gt;'</span>
            <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>hint<span class="token punctuation">)</span>
</code></pre></div></li> <li><h5 id="first-返回第一条记录"><a href="#first-返回第一条记录" class="header-anchor">#</a> first(): 返回第一条记录</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#first用来取一条记录，如果返回结果有多条，只会取第一条。它的返回结果是model对象。</span>
<span class="token comment">#last同样用法：用来取最后一条记录，如果返回结果有多条，只会取最后一条。它的返回结果是model对象</span>
<span class="token keyword">def</span> <span class="token function">query</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>publish<span class="token operator">=</span><span class="token string">&quot;北京出版社&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>  <span class="token comment">#Python%s15</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'执行完成'</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><h5 id="get-kwargs-返回与所给筛选条件相匹配的对象"><a href="#get-kwargs-返回与所给筛选条件相匹配的对象" class="header-anchor">#</a> get(**kwargs): 返回与所给筛选条件相匹配的对象</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#返回结果有且只有一个，如果符合筛选条件的对象超过一个或者没有都会抛出错误。（get取值只能是唯一的）</span>
<span class="token comment">#多了会报错： get() return more than one book; 没有：book matching query does not exist</span>
<span class="token keyword">def</span> <span class="token function">query</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>  <span class="token comment">#Python2</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'执行完成'</span><span class="token punctuation">)</span>

<span class="token comment">#使用get有且只有一个结果时才有意义。推荐使用get时，利用主键查询，因为主键是唯一的</span>
</code></pre></div></li> <li><h5 id="exclude-kwargs-它包含了与所给筛选条件不匹配的对象-排除"><a href="#exclude-kwargs-它包含了与所给筛选条件不匹配的对象-排除" class="header-anchor">#</a> exclude(**kwargs):  它包含了与所给筛选条件不匹配的对象(排除)</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">query</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>exclude<span class="token punctuation">(</span>publish<span class="token operator">=</span><span class="token string">'人民出版社'</span><span class="token punctuation">)</span>  <span class="token comment">#排除在这个出版社的其他</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>  <span class="token comment">#&lt;QuerySet [&lt;Book: Python%s15&gt;, &lt;Book: Python15&gt;]&gt;</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'执行完成'</span>
</code></pre></div></li> <li><h5 id="order-by-field-对查询结果排序"><a href="#order-by-field-对查询结果排序" class="header-anchor">#</a> order_by(*field): 对查询结果排序</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">query</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-id&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-pub_date&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>  <span class="token comment"># 先按照price升序，再按照id、时间降序</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'执行完成'</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><h5 id="reverse-对查询结果反向排序"><a href="#reverse-对查询结果反向排序" class="header-anchor">#</a> reverse():  对查询结果反向排序</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">query</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    obj <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reverse<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#先升序，再反序</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&quot;查询成功&quot;</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><h5 id="count-返回数据库中匹配查询的对象数量。"><a href="#count-返回数据库中匹配查询的对象数量。" class="header-anchor">#</a> count(): 返回数据库中匹配查询的对象数量。</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#它的返回结果数据类型是int，也就是说他返回的不再是一个QuerySet类型的结果，所以不能继续链式操作</span>

<span class="token keyword">def</span> <span class="token function">query</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-id&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-pub_date&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>  <span class="token comment"># 12</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'执行完成'</span><span class="token punctuation">)</span>

<span class="token comment">#链式操作：因为queryset可以调用API接口（各种函数），只要前一个接口的返回值是queryset，它可以可以一直调用API接口，除非遇到返回值不是queryset的情况下，链式操作，才可以终止。因为count的返回值是int，所以到这里，就结束了！不能再调用API接口了！</span>
</code></pre></div></li> <li><h5 id="exists-如果queryset包含数据-就返回true-否则返回false"><a href="#exists-如果queryset包含数据-就返回true-否则返回false" class="header-anchor">#</a> exists(): 如果QuerySet包含数据，就返回True，否则返回False</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">query</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#这样之判断有无，也就避免了大数据被传入打印</span>
    <span class="token keyword">if</span> ret<span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&quot;查询成功&quot;</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><h5 id="values-field-返回一个valuequeryset"><a href="#values-field-返回一个valuequeryset" class="header-anchor">#</a> values(*field): 返回一个ValueQuerySet</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#它是一个特殊的QuerySet，运行后得到的并不是一系列model的实例化对象，而是一个可迭代的字典序列。它的返回结果是一个特殊的QuerySet，列表每一个元素都是字典。也就是循环QuerySet中的每一个model对象，将values中的值为键，去每个对象中取值，最后做成一个字典添加到QuerySet列表中</span>

<span class="token keyword">def</span> <span class="token function">query</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;book&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>  <span class="token comment">#&lt;QuerySet [{'book': 'Python0', 'price': Decimal('123.00')}, {'book': 'Python1', 'price': Decimal('124.00')},……]</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'执行完成'</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><h5 id="values-list-field-values返回的是一个元组序列"><a href="#values-list-field-values返回的是一个元组序列" class="header-anchor">#</a> values_list(*field):   values返回的是一个元组序列</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#通过组织等的值，在每个对象中找，返回一个元组</span>
<span class="token keyword">def</span> <span class="token function">query</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token string">&quot;book&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>  <span class="token comment">#&lt;QuerySet [('Python0', Decimal('123.00')), ('Python1', Decimal('124.00')), ……]</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'执行完成'</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><h5 id="distinct-从返回结果中剔除重复纪录-针对values、values-list的返回对象queryset类型"><a href="#distinct-从返回结果中剔除重复纪录-针对values、values-list的返回对象queryset类型" class="header-anchor">#</a> distinct(): 从返回结果中剔除重复纪录（针对values、values_list的返回对象QuerySet类型）</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#它的返回结果是QuerySet，注意：是一个常规的QuerySet。如果使用distinct对主键做去重，是没有意义的。因为主键是唯一的！</span>

<span class="token keyword">def</span> <span class="token function">query</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
   	<span class="token comment"># 对价格进行去重</span>
    ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>  <span class="token comment">#&lt;QuerySet [{'price': Decimal('123.00')}, {'price': Decimal('124.00')}, {'price': Decimal('126.00')}, ……]</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'执行完成'</span><span class="token punctuation">)</span>

<span class="token comment">#查看所有书籍的价格以及出版社，价格和出版社同时不能重复</span>
<span class="token keyword">def</span> <span class="token function">query</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;publish&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&quot;查询成功&quot;</span><span class="token punctuation">)</span>

<span class="token comment">#总结</span>
    <span class="token comment"># all_books = models.Book.objects.all().distinct() #这样写是表示记录中所有的字段重复才叫重复，但是我们知道有主键的存在，所以不可能所有字段数据都重复（无意义，不可能所有有重复）</span>
    <span class="token comment"># all_books = models.Book.objects.all().distinct('price') #报错，不能在distinct里面加字段名称</span>
    <span class="token comment"># all_books = models.Book.objects.all().values('price').distinct()#&lt;QuerySet [(Decimal('11.00'),), (Decimal('111.00'),), (Decimal('120.00'),), (Decimal('11111.00'),)]&gt;</span>
    all_books <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#&lt;QuerySet [{'price': Decimal('11.00')}, {'price': Decimal('111.00')}, {'price': Decimal('120.00')}, {'price': Decimal('11111.00')}]&gt; 只能用于valuse和values_list进行去重</span>
　　all_books <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span><span class="token string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#title和price两个同时重复才算一条重复的记录</span>
</code></pre></div></li></ul> <h2 id="基于双下划线的模糊查询"><a href="#基于双下划线的模糊查询" class="header-anchor">#</a> 基于双下划线的模糊查询</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#其实在底层转换为like的sql语句</span>

Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>price__in<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment">#price值等于这三个里面的任意一个的对象</span>
Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>price__gt<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>                  <span class="token comment">#大于，大于等于是price__gte=100，别写price&gt;100，这种参数不支持</span>
Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>price__lt<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>price__range<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">)</span>          <span class="token comment">#sql的between and，大于等于100，小于等于200</span>
Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title__contains<span class="token operator">=</span><span class="token string">&quot;python&quot;</span><span class="token punctuation">)</span>        <span class="token comment">#title值中包含python的</span>
Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title__icontains<span class="token operator">=</span><span class="token string">&quot;python&quot;</span><span class="token punctuation">)</span>       <span class="token comment">#不区分大小写</span>
Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title__startswith<span class="token operator">=</span><span class="token string">&quot;py&quot;</span><span class="token punctuation">)</span>          <span class="token comment">#以什么开头，istartswith  不区分大小写</span>
Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pub_date__year<span class="token operator">=</span><span class="token number">2012</span><span class="token punctuation">)</span>             <span class="token comment">#查询某一年的</span>

<span class="token keyword">def</span> <span class="token function">query</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>book__contains<span class="token operator">=</span><span class="token string">'Py'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#含有py的</span>
    ret1 <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>price__gte<span class="token operator">=</span><span class="token number">130</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#大于130的个数</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span>ret1<span class="token punctuation">)</span>  <span class="token comment">#12  3</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'执行完成'</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><h5 id="字段名-startswith-以什么开头的"><a href="#字段名-startswith-以什么开头的" class="header-anchor">#</a> 字段名__startswith(以什么开头的)</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">query</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title__startswith<span class="token operator">=</span><span class="token string">&quot;北京&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&quot;查询成功&quot;</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><h5 id="字段名-gte-大于等于-同样适用于小于等于"><a href="#字段名-gte-大于等于-同样适用于小于等于" class="header-anchor">#</a> 字段名__gte(大于等于)（同样适用于小于等于）</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">query</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>price__lte<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&quot;查询成功&quot;</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h4 id="删除表记录"><a href="#删除表记录" class="header-anchor">#</a> 删除表记录</h4> <ul><li><p>删除方法就是 delete()。它运行时立即删除对象而不返回任何值。例如：</p> <div class="language-python extra-class"><pre class="language-python"><code>model_obj<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#delete()方法的调用者可以是一个model对象，也可以是一个queryset集合。</span>

<span class="token comment">#你也可以一次性删除多个对象。每个 QuerySet 都有一个 delete() 方法，它一次性删除 QuerySet 中所有的对象。</span>
<span class="token comment">#例如，下面的代码将删除 pub_date 是2005年的 Entry 对象：</span>
Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pub_date__year<span class="token operator">=</span><span class="token number">2005</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#等学到外键的时候再说，在 Django 删除对象时，会模仿 SQL 约束 ON DELETE CASCADE 的行为，换句话说，删除一个对象时也会删除与它相关联的外键对象。例如:</span>
b <span class="token operator">=</span> Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">#pk就是主键 primary key</span>
b<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#要注意的是： delete() 方法是 QuerySet 上的方法，但并不适用于 Manager 本身。这是一种保护机制，是为了避免意外地调用 Book.objects.delete() 方法导致 所有的记录被误删除。如果你确认要删除所有的对象，那么你必须显式地调用：</span>
Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#修改是基于查询的结果来修改的，所以先查询再修改</span>
<span class="token comment">#举例：删除价格等于100的</span>
<span class="token keyword">def</span> <span class="token function">delbook</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>price<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&quot;删除成功&quot;</span><span class="token punctuation">)</span>

<span class="token comment">#如果不想级联删除，可以设置为:</span>
pubHouse <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'Publisher'</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>SET_NULL<span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>还可以结合视图函数的参数来进行操作：</p> <div class="language-python extra-class"><pre class="language-python"><code>url<span class="token punctuation">.</span>py文件中
  urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
      url<span class="token punctuation">(</span><span class="token string">'delbook/(?P&lt;id&gt;\d+)'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>delbook<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>

    <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
views<span class="token punctuation">.</span>py文件中
<span class="token keyword">def</span> <span class="token function">delbook</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
      ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>nid<span class="token operator">=</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
      <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span><span class="token builtin">type</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> ret<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
          <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&quot;删除成功&quot;</span><span class="token punctuation">)</span>
      <span class="token keyword">else</span><span class="token punctuation">:</span>
          <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&quot;删除失败&quot;</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h4 id="修改表记录"><a href="#修改表记录" class="header-anchor">#</a> 修改表记录</h4> <ul><li><p>修改表记录都是基于查询之上</p> <div class="language-python extra-class"><pre class="language-python"><code>ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>book__startswith<span class="token operator">=</span><span class="token string">&quot;py&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>price<span class="token operator">=</span><span class="token number">120</span><span class="token punctuation">)</span>  <span class="token comment">#update只能是querset类型才能调用，model对象不能直接调用更新方法，所以使用get方法获取对象的时候是不能update的，ret为一个数字，表示受影响的记录数</span>

<span class="token keyword">def</span> <span class="token function">query</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>book__contains<span class="token operator">=</span><span class="token string">'Py'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>price<span class="token operator">=</span><span class="token number">1222</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>  <span class="token comment">#12</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'执行完成'</span><span class="token punctuation">)</span>
  <span class="token comment">#此外，update()方法对于任何结果集（QuerySet）均有效，这意味着你可以同时更新多条记录update()方法会返回一个整型数值，表示受影响的记录条数。</span>
  <span class="token comment">#注意：&lt;input type=&quot;date&quot; class=&quot;form-control&quot; id=&quot;book_pub_date&quot; placeholder=&quot;出版日期&quot; name=&quot;book_pub_date&quot; value=&quot;{{ edit_obj.pub_date|date:'Y-m-d' }}&quot;&gt;，type='date'的input标签，value的值必须是'Y-m-d'的格式，这个标签才能认识并被赋值，所以，要通过date过滤给它改变格式。   </span>

</code></pre></div></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/python/django/反向解析和视图函数.html" class="prev">
        反向解析和视图函数
      </a></span> <span class="next"><a href="/python/django/多表操作.html">
        多表操作
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.51f2f156.js" defer></script><script src="/assets/js/2.8911ec45.js" defer></script><script src="/assets/js/56.bde381df.js" defer></script>
  </body>
</html>
