<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>form组件 | 独角兕大王</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.ccac5a78.css" as="style"><link rel="preload" href="/assets/js/app.51f2f156.js" as="script"><link rel="preload" href="/assets/js/2.8911ec45.js" as="script"><link rel="preload" href="/assets/js/53.65343ccc.js" as="script"><link rel="prefetch" href="/assets/js/10.6948c28b.js"><link rel="prefetch" href="/assets/js/100.276864ee.js"><link rel="prefetch" href="/assets/js/101.447ab1c7.js"><link rel="prefetch" href="/assets/js/102.f5b3c71d.js"><link rel="prefetch" href="/assets/js/103.16474d4b.js"><link rel="prefetch" href="/assets/js/104.ed58aef3.js"><link rel="prefetch" href="/assets/js/105.045203cd.js"><link rel="prefetch" href="/assets/js/106.be359e0b.js"><link rel="prefetch" href="/assets/js/107.7331bbca.js"><link rel="prefetch" href="/assets/js/108.76e1c800.js"><link rel="prefetch" href="/assets/js/109.e82166f3.js"><link rel="prefetch" href="/assets/js/11.d4ec37c8.js"><link rel="prefetch" href="/assets/js/110.4144755a.js"><link rel="prefetch" href="/assets/js/111.5864ab53.js"><link rel="prefetch" href="/assets/js/112.ca2aee84.js"><link rel="prefetch" href="/assets/js/113.641e7765.js"><link rel="prefetch" href="/assets/js/114.d69f8545.js"><link rel="prefetch" href="/assets/js/115.1b6a9f89.js"><link rel="prefetch" href="/assets/js/116.dde2c44e.js"><link rel="prefetch" href="/assets/js/117.4e79498c.js"><link rel="prefetch" href="/assets/js/12.7aac9c8d.js"><link rel="prefetch" href="/assets/js/13.abf127cd.js"><link rel="prefetch" href="/assets/js/14.aa4413a7.js"><link rel="prefetch" href="/assets/js/15.11a64e5b.js"><link rel="prefetch" href="/assets/js/16.f2d9a882.js"><link rel="prefetch" href="/assets/js/17.11c5bb7f.js"><link rel="prefetch" href="/assets/js/18.a522877b.js"><link rel="prefetch" href="/assets/js/19.6f31a972.js"><link rel="prefetch" href="/assets/js/20.b546c54e.js"><link rel="prefetch" href="/assets/js/21.6d055b7f.js"><link rel="prefetch" href="/assets/js/22.c48feceb.js"><link rel="prefetch" href="/assets/js/23.69941f78.js"><link rel="prefetch" href="/assets/js/24.6126dfc2.js"><link rel="prefetch" href="/assets/js/25.3475449c.js"><link rel="prefetch" href="/assets/js/26.96bb4643.js"><link rel="prefetch" href="/assets/js/27.da610e5d.js"><link rel="prefetch" href="/assets/js/28.b24ec15c.js"><link rel="prefetch" href="/assets/js/29.ec8af553.js"><link rel="prefetch" href="/assets/js/3.bec5f768.js"><link rel="prefetch" href="/assets/js/30.2e780db1.js"><link rel="prefetch" href="/assets/js/31.464c36ed.js"><link rel="prefetch" href="/assets/js/32.ad7d37c2.js"><link rel="prefetch" href="/assets/js/33.722f1ec5.js"><link rel="prefetch" href="/assets/js/34.8448d0fd.js"><link rel="prefetch" href="/assets/js/35.e5168ac9.js"><link rel="prefetch" href="/assets/js/36.edc404f1.js"><link rel="prefetch" href="/assets/js/37.5807602e.js"><link rel="prefetch" href="/assets/js/38.a519c89a.js"><link rel="prefetch" href="/assets/js/39.89af1b9a.js"><link rel="prefetch" href="/assets/js/4.5ed19beb.js"><link rel="prefetch" href="/assets/js/40.6c653db9.js"><link rel="prefetch" href="/assets/js/41.bc3b8b69.js"><link rel="prefetch" href="/assets/js/42.a0a02d9b.js"><link rel="prefetch" href="/assets/js/43.62f344e3.js"><link rel="prefetch" href="/assets/js/44.a7fd9d68.js"><link rel="prefetch" href="/assets/js/45.729c1c39.js"><link rel="prefetch" href="/assets/js/46.5b924aea.js"><link rel="prefetch" href="/assets/js/47.f3990404.js"><link rel="prefetch" href="/assets/js/48.f591f360.js"><link rel="prefetch" href="/assets/js/49.f7f213ad.js"><link rel="prefetch" href="/assets/js/5.2c5d28b5.js"><link rel="prefetch" href="/assets/js/50.b9ca2762.js"><link rel="prefetch" href="/assets/js/51.93672ee6.js"><link rel="prefetch" href="/assets/js/52.fb21314a.js"><link rel="prefetch" href="/assets/js/54.8081227d.js"><link rel="prefetch" href="/assets/js/55.e207659e.js"><link rel="prefetch" href="/assets/js/56.bde381df.js"><link rel="prefetch" href="/assets/js/57.f8eceb45.js"><link rel="prefetch" href="/assets/js/58.bef70bfd.js"><link rel="prefetch" href="/assets/js/59.7ab7562d.js"><link rel="prefetch" href="/assets/js/6.fc65a1ac.js"><link rel="prefetch" href="/assets/js/60.f40ac3ca.js"><link rel="prefetch" href="/assets/js/61.d2b463ab.js"><link rel="prefetch" href="/assets/js/62.cfdf1bcf.js"><link rel="prefetch" href="/assets/js/63.1e45ce59.js"><link rel="prefetch" href="/assets/js/64.a98fe86e.js"><link rel="prefetch" href="/assets/js/65.0234d7c5.js"><link rel="prefetch" href="/assets/js/66.724906f0.js"><link rel="prefetch" href="/assets/js/67.7806fda6.js"><link rel="prefetch" href="/assets/js/68.9f227dae.js"><link rel="prefetch" href="/assets/js/69.fdbc56ac.js"><link rel="prefetch" href="/assets/js/7.284de54e.js"><link rel="prefetch" href="/assets/js/70.04a9cc03.js"><link rel="prefetch" href="/assets/js/71.a6fa1dd9.js"><link rel="prefetch" href="/assets/js/72.2f8e3aa0.js"><link rel="prefetch" href="/assets/js/73.9bbb0cb6.js"><link rel="prefetch" href="/assets/js/74.9f122255.js"><link rel="prefetch" href="/assets/js/75.75e1fbd8.js"><link rel="prefetch" href="/assets/js/76.60ff3c3e.js"><link rel="prefetch" href="/assets/js/77.39a253ae.js"><link rel="prefetch" href="/assets/js/78.0e49712f.js"><link rel="prefetch" href="/assets/js/79.5f9c24a0.js"><link rel="prefetch" href="/assets/js/8.5c21a4cc.js"><link rel="prefetch" href="/assets/js/80.f826f188.js"><link rel="prefetch" href="/assets/js/81.b8995ea7.js"><link rel="prefetch" href="/assets/js/82.e9bf63e0.js"><link rel="prefetch" href="/assets/js/83.e3a00749.js"><link rel="prefetch" href="/assets/js/84.b940927c.js"><link rel="prefetch" href="/assets/js/85.ad46a9b2.js"><link rel="prefetch" href="/assets/js/86.190e0071.js"><link rel="prefetch" href="/assets/js/87.5f9eb9ef.js"><link rel="prefetch" href="/assets/js/88.cfaf7469.js"><link rel="prefetch" href="/assets/js/89.e64cc32c.js"><link rel="prefetch" href="/assets/js/9.0723805d.js"><link rel="prefetch" href="/assets/js/90.805edabe.js"><link rel="prefetch" href="/assets/js/91.6a1ab3f7.js"><link rel="prefetch" href="/assets/js/92.04ecd01e.js"><link rel="prefetch" href="/assets/js/93.e615470a.js"><link rel="prefetch" href="/assets/js/94.0ad7c41c.js"><link rel="prefetch" href="/assets/js/95.0e5ce618.js"><link rel="prefetch" href="/assets/js/96.b59cf9f4.js"><link rel="prefetch" href="/assets/js/97.2a327746.js"><link rel="prefetch" href="/assets/js/98.9c01ec88.js"><link rel="prefetch" href="/assets/js/99.952046bd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ccac5a78.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://github.com/fluidicon.png" alt="独角兕大王" class="logo"> <span class="site-name can-hide">独角兕大王</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/python/" class="nav-link router-link-active">
  Python
</a></div><div class="nav-item"><a href="/rust/" class="nav-link">
  Rust
</a></div><div class="nav-item"><a href="/go/" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/lua/" class="nav-link">
  Lua
</a></div><div class="nav-item"><a href="/C/" class="nav-link">
  C++
</a></div><div class="nav-item"><a href="https://github.com/wuyuz" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.cnblogs.com/double-W/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  cnblogs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/python/" class="nav-link router-link-active">
  Python
</a></div><div class="nav-item"><a href="/rust/" class="nav-link">
  Rust
</a></div><div class="nav-item"><a href="/go/" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/lua/" class="nav-link">
  Lua
</a></div><div class="nav-item"><a href="/C/" class="nav-link">
  C++
</a></div><div class="nav-item"><a href="https://github.com/wuyuz" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.cnblogs.com/double-W/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  cnblogs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python常用模块</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Django框架</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/python/django/Web框架本质.html" class="sidebar-link">Web框架本质</a></li><li><a href="/python/django/resquest、模块层.html" class="sidebar-link">resquest、模块层</a></li><li><a href="/python/django/静态文件和ORM.html" class="sidebar-link">静态文件和ORM</a></li><li><a href="/python/django/标签、自定义标签.html" class="sidebar-link">模块层之标签、自定义标签</a></li><li><a href="/python/django/模版语法.html" class="sidebar-link">模版语法</a></li><li><a href="/python/django/模型层.html" class="sidebar-link">模型层</a></li><li><a href="/python/django/反向解析和视图函数.html" class="sidebar-link">反向解析和视图函数</a></li><li><a href="/python/django/单表操作.html" class="sidebar-link">单表操作</a></li><li><a href="/python/django/多表操作.html" class="sidebar-link">多表操作</a></li><li><a href="/python/django/中间件.html" class="sidebar-link">中间件</a></li><li><a href="/python/django/模型进阶.html" class="sidebar-link">模型进阶</a></li><li><a href="/python/django/缓存和信号.html" class="sidebar-link">缓存和信号</a></li><li><a href="/python/django/form组件.html" class="active sidebar-link">form组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/django/form组件.html#form组件" class="sidebar-link">form组件</a></li><li class="sidebar-sub-header"><a href="/python/django/form组件.html#字段校验" class="sidebar-link">字段校验</a></li><li class="sidebar-sub-header"><a href="/python/django/form组件.html#钩子函数-hook" class="sidebar-link">钩子函数（Hook）：</a></li><li class="sidebar-sub-header"><a href="/python/django/form组件.html#modelform" class="sidebar-link">ModelForm</a></li></ul></li><li><a href="/python/django/csrf和Ajax.html" class="sidebar-link">csrf和Ajax</a></li><li><a href="/python/django/APIView使用和源码分析.html" class="sidebar-link">APIView使用和源码分析</a></li><li><a href="/python/django/REST framework之版本和解析器.html" class="sidebar-link">REST framework之版本和解析器</a></li><li><a href="/python/django/REST framework之分页和视图组件.html" class="sidebar-link">REST framework之分页和视图组件</a></li><li><a href="/python/django/REST framework之路由和渲染器.html" class="sidebar-link">REST framework之路由和渲染器</a></li><li><a href="/python/django/REST framework之序列化器.html" class="sidebar-link">REST framework之序列化器</a></li><li><a href="/python/django/REST framework版本图书管理系统.html" class="sidebar-link">REST framework版本图书管理系统</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flask 框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python爬虫</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python设计模式</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="form组件"><a href="#form组件" class="header-anchor">#</a> form组件</h2> <h4 id="forms组件的功能"><a href="#forms组件的功能" class="header-anchor">#</a> forms组件的功能：</h4> <div class="language- extra-class"><pre class="language-text"><code>1、生成HTML标签
2、验证用户数据（显示错误信息）
3、HTML Form提交保留上次提交数据
4、初始化页面显示内容
</code></pre></div><ul><li><p><strong>校验字段功能</strong>：之前写的视图函数，提交的数据，没有做校验，就添加到数据库里面了。这样是不对的！比如：用户名，必须要符合一定的长度，密码复杂度，等等。forms组件最大的作用就是做<strong>数据校验</strong>。普通做法，一个一个写校验规则，没有解耦。校验规则，都在视图函数里面。（普通的数据验证也是可以的但是视图函数中会有很多的逻辑判断，所以要使用forms组件）</p></li> <li><p><strong>与Ajax相比</strong>：</p> <div class="language- extra-class"><pre class="language-text"><code>1、forms组件只适用于form表单中，且只在提交后从后端得到后端的数据处理再返回前端，换句话说forms组件会刷新页面。
2、Ajax也能去后端获取验证，(注意Ajax只是给后端发请求，并接收后端的消息)且只是局部刷新，但是校验量有局限性，适用于单跳数据验证，当涉及到多条数据需要验证的时候，还是要使用forms组件
</code></pre></div></li> <li><p>普通视图函数实现验证：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    error_msg <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">:</span>
        username <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span>
        pwd <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;pwd&quot;</span><span class="token punctuation">)</span>
        <span class="token comment"># 对注册信息做校验</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">6</span><span class="token punctuation">:</span>
            <span class="token comment"># 用户长度小于6位</span>
            error_msg <span class="token operator">=</span> <span class="token string">&quot;用户名长度不能小于6位&quot;</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 将用户名和密码存到数据库</span>
            <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&quot;注册成功&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;register.html&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;error_msg&quot;</span><span class="token punctuation">:</span> error_msg<span class="token punctuation">}</span><span class="token punctuation">)</span>
    
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
 <span class="token comment">#login.html文件</span>
<span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token string">&quot;/reg/&quot;</span> method<span class="token operator">=</span><span class="token string">&quot;post&quot;</span><span class="token operator">&gt;</span>
    <span class="token punctuation">{</span><span class="token operator">%</span> csrf_token <span class="token operator">%</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
        用户名<span class="token punctuation">:</span><span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;name&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
        密码：<span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;password&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;pwd&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;submit&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;注册&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p style<span class="token operator">=</span><span class="token string">&quot;color: red&quot;</span><span class="token operator">&gt;</span>\<span class="token punctuation">{</span>\<span class="token punctuation">{</span> error_msg <span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span> 
</code></pre></div></li> <li><p>**使用form组件实现注册功能：**首先需要导入一个forms模块，创建一个自己的继承form.Form的校验类，然后再视图函数中写一个视图函数。</p> <div class="language-python extra-class"><pre class="language-python"><code> <span class="token comment">#views.py文件中,以后可以将form类分为一个py文件</span>
<span class="token keyword">from</span> django <span class="token keyword">import</span> forms
<span class="token comment"># 按照Django form组件的要求自己写一个类</span>
<span class="token keyword">class</span> <span class="token class-name">RegForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
     username <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'用户名'</span><span class="token punctuation">,</span>min_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span>widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>TextInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'class'</span><span class="token punctuation">:</span><span class="token string">'form-control'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#form字段的名称写的是什么，那么前端生成input标签的时候，input标签的name属性的值就是什么</span>
     pwd <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'密码'</span><span class="token punctuation">,</span>min_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span>widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>PasswordInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'class'</span><span class="token punctuation">:</span><span class="token string">'form-control'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>render_value<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># label是相应的标签名，min_length是最小长度，widget是引入的组件其中，可以是用attr添加该标签的样式，render_value是否保存密码</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
 <span class="token comment"># views.py</span>
 <span class="token comment"># 使用form组件实现注册方式</span>
<span class="token keyword">def</span> <span class="token function">register2</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    form_obj <span class="token operator">=</span> RegForm<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">:</span>
        <span class="token comment"># 实例化form对象的时候，把post提交过来的数据直接传进去</span>
        form_obj <span class="token operator">=</span> RegForm<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span>  <span class="token comment">#既然传过来的input标签的name属性值和form类对应的字段名是一样的，所以接过来后，form就取出对应的form字段名相同的数据进行form校验</span>
        <span class="token comment"># 调用form_obj校验数据的方法</span>
        <span class="token keyword">if</span> form_obj<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&quot;注册成功&quot;</span><span class="token punctuation">)</span> 
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;register2.html&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;form_obj&quot;</span><span class="token punctuation">:</span> form_obj<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
 <span class="token comment">#register2.html文件中</span>
 <span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token string">&quot;&quot;</span> method<span class="token operator">=</span><span class="token string">&quot;post&quot;</span> novalidate <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-horizontal&quot;</span><span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token operator">%</span> csrf_token <span class="token operator">%</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-group&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>label name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;col-md-2 col-md-offset-2&quot;</span><span class="token operator">&gt;</span>用户名<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;col-md-6  &quot;</span> name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span><span class="token operator">&gt;</span>
                \<span class="token punctuation">{</span>\<span class="token punctuation">{</span> form_obj<span class="token punctuation">.</span>username <span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">}</span>
                <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;text-danger&quot;</span><span class="token operator">&gt;</span>\<span class="token punctuation">{</span>\<span class="token punctuation">{</span> form_obj<span class="token punctuation">.</span>username<span class="token punctuation">.</span>errors<span class="token punctuation">.</span><span class="token number">0</span> <span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-group&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>label name<span class="token operator">=</span><span class="token string">&quot;pwd&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;col-md-2 col-md-offset-2&quot;</span><span class="token operator">&gt;</span>密码<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;col-md-6  &quot;</span> name<span class="token operator">=</span><span class="token string">&quot;pwd&quot;</span> style<span class="token operator">=</span><span class="token string">&quot;padding-left:0px;&quot;</span><span class="token operator">&gt;</span>
                \<span class="token punctuation">{</span>\<span class="token punctuation">{</span> form_obj<span class="token punctuation">.</span>pwd <span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">}</span>
                <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;text-danger&quot;</span><span class="token operator">&gt;</span>\<span class="token punctuation">{</span>\<span class="token punctuation">{</span> form_obj<span class="token punctuation">.</span>pwd<span class="token punctuation">.</span>errors<span class="token punctuation">.</span><span class="token number">0</span> <span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span>注册<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
</code></pre></div></li> <li><p><strong>form组件的使用总结</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token number">1</span>、在views<span class="token punctuation">.</span>py文件中导入form模块
<span class="token keyword">from</span> django <span class="token keyword">import</span> forms
<span class="token keyword">class</span> <span class="token class-name">RegForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    pwd <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
<span class="token number">2</span>、在视图函数中使用： 
<span class="token keyword">def</span> <span class="token function">register2</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    form_obj <span class="token operator">=</span> RegForm<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># get方式时返回一个form</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">:</span>  <span class="token comment">#post时，带着数据再进入form实例化</span>
        form_obj <span class="token operator">=</span> RegForm<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span> 
        <span class="token keyword">if</span> form_obj<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#数据请求后，判断</span>
            <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&quot;注册成功&quot;</span><span class="token punctuation">)</span> 
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;register2.html&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;form_obj&quot;</span><span class="token punctuation">:</span> form_obj<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>在模块中使用的方法：</p> <div class="language-python extra-class"><pre class="language-python"><code>\<span class="token punctuation">{</span>\<span class="token punctuation">{</span> form<span class="token punctuation">.</span>as_table <span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">}</span>   ——》  以表格的形式将它们渲染在<span class="token operator">&lt;</span>tr<span class="token operator">&gt;</span> 标签中
\<span class="token punctuation">{</span>\<span class="token punctuation">{</span> form<span class="token punctuation">.</span>as_p <span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">}</span>   ——》  将它们渲染在<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span> 标签中
\<span class="token punctuation">{</span>\<span class="token punctuation">{</span> form<span class="token punctuation">.</span>as_ul <span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">}</span>    ——》 将它们渲染在<span class="token operator">&lt;</span>li<span class="token operator">&gt;</span> 标签中
\<span class="token punctuation">{</span>\<span class="token punctuation">{</span> form_obj<span class="token punctuation">.</span>as_p <span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">}</span>    <span class="token operator">-</span><span class="token operator">-</span>》   生产一个个P标签  <span class="token builtin">input</span>  label<span class="token punctuation">,</span>用于展示
\<span class="token punctuation">{</span>\<span class="token punctuation">{</span> form_obj<span class="token punctuation">.</span>errors <span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">}</span>    ——》   form表单中所有字段的错误
\<span class="token punctuation">{</span>\<span class="token punctuation">{</span> form_obj<span class="token punctuation">.</span>username <span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">}</span>     ——》 一个字段对应的<span class="token builtin">input</span>框
\<span class="token punctuation">{</span>\<span class="token punctuation">{</span> form_obj<span class="token punctuation">.</span>username<span class="token punctuation">.</span>label <span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">}</span>    ——》  该字段的中午提示
\<span class="token punctuation">{</span>\<span class="token punctuation">{</span> form_obj<span class="token punctuation">.</span>username<span class="token punctuation">.</span>id_for_label <span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">}</span>    ——》 该字段<span class="token builtin">input</span>框的<span class="token builtin">id</span>
\<span class="token punctuation">{</span>\<span class="token punctuation">{</span> form_obj<span class="token punctuation">.</span>username<span class="token punctuation">.</span>errors <span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">}</span>   ——》 该字段的所有的错误
\<span class="token punctuation">{</span>\<span class="token punctuation">{</span> form_obj<span class="token punctuation">.</span>username<span class="token punctuation">.</span>errors<span class="token punctuation">.</span><span class="token number">0</span> <span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">}</span>   ——》 该字段的第一个错误的错误


\<span class="token punctuation">{</span>\<span class="token punctuation">{</span> form_obj<span class="token punctuation">.</span>non_filed_errors <span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">}</span>     ——》  __all__的错误
</code></pre></div></li></ul> <h4 id="form常见字段属性以及插件-widget-讲解"><a href="#form常见字段属性以及插件-widget-讲解" class="header-anchor">#</a> form常见字段属性以及插件(widget)讲解：</h4> <ul><li><p><strong>initial</strong>：初始值，input框里面的初始值。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">LoginForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>  
    	max_length<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token comment"># 只能为8位</span>
        min_length<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> 
        label<span class="token operator">=</span><span class="token string">&quot;用户名&quot;</span><span class="token punctuation">,</span>
        initial<span class="token operator">=</span><span class="token string">&quot;张三&quot;</span>  <span class="token comment"># 设置默认值，输入框的初始值</span>
    <span class="token punctuation">)</span>
    pwd <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>min_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">&quot;密码&quot;</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>error_messages</strong>: 重写错误信息。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">LoginForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>
        min_length<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">&quot;用户名&quot;</span><span class="token punctuation">,</span>
        initial<span class="token operator">=</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span>
        required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>  <span class="token comment"># 默认都是True，表示必填</span>
        error_messages<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">&quot;required&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;不能为空&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;invalid&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;格式错误&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;min_length&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;用户名最短8位&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
    pwd <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>min_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">&quot;密码&quot;</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>radioSelect(插件）</strong>：单radio值为字符串</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">LoginForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>  <span class="token comment">#其他选择框或者输入框，基本都是在这个CharField的基础上通过插件来搞的</span>
        min_length<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">&quot;用户名&quot;</span><span class="token punctuation">,</span>
        initial<span class="token operator">=</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span>
        error_messages<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">&quot;required&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;不能为空&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;invalid&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;格式错误&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;min_length&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;用户名最短8位&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
    pwd <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>min_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">&quot;密码&quot;</span><span class="token punctuation">)</span>
    gender <span class="token operator">=</span> forms<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>ChoiceField<span class="token punctuation">(</span>
        choices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;男&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;女&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;保密&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">#选择栏</span>
        label<span class="token operator">=</span><span class="token string">&quot;性别&quot;</span><span class="token punctuation">,</span>
        initial<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>  <span class="token comment"># 初始值</span>
        widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>RadioSelect<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>单选select</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">LoginForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    hobby <span class="token operator">=</span> forms<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>ChoiceField<span class="token punctuation">(</span>  <span class="token comment">#注意，单选框用的是ChoiceField，并且里面的插件是Select，不然验证的时候会报错， Select a valid choice的错误。</span>
        choices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;篮球&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;足球&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;双色球&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">&quot;爱好&quot;</span><span class="token punctuation">,</span>
        initial<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>
        widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>Select<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>多选select:</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">LoginForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    hobby <span class="token operator">=</span> forms<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>MultipleChoiceField<span class="token punctuation">(</span> <span class="token comment">#多选框的时候用MultipleChoiceField，并且里面的插件用的是SelectMultiple，不然验证的时候会报错。</span>
        choices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;篮球&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;足球&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;双色球&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">&quot;爱好&quot;</span><span class="token punctuation">,</span>
        initial<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>SelectMultiple<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>单选框checkbox</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#单选的checkbox</span>
    <span class="token keyword">class</span> <span class="token class-name">TestForm2</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
        keep <span class="token operator">=</span> forms<span class="token punctuation">.</span>ChoiceField<span class="token punctuation">(</span>
            choices<span class="token operator">=</span><span class="token punctuation">(</span>
                <span class="token punctuation">(</span><span class="token string">'True'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token string">'False'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>

            label<span class="token operator">=</span><span class="token string">&quot;是否7天内自动登录&quot;</span><span class="token punctuation">,</span>
            initial<span class="token operator">=</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
            widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>CheckboxInput<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
        <span class="token punctuation">)</span>
        
    选中<span class="token punctuation">:</span><span class="token string">'True'</span>   <span class="token comment">#form只是帮我们做校验,校验选择内容的时候,就是看在没在我们的choices里面,里面有这个值,表示合法,没有就不合法</span>
    没选中<span class="token punctuation">:</span><span class="token string">'False'</span>
    <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>保存到数据库里面  keep<span class="token punctuation">:</span><span class="token string">'True'</span>
    <span class="token keyword">if</span> keep <span class="token operator">==</span> <span class="token string">'True'</span><span class="token punctuation">:</span>
        session 设置有效期<span class="token number">7</span>天
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
</code></pre></div></li> <li><p><strong>多选框checkbox</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">LoginForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    hobby <span class="token operator">=</span> forms<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>MultipleChoiceField<span class="token punctuation">(</span>
        choices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;篮球&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;足球&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;双色球&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">&quot;爱好&quot;</span><span class="token punctuation">,</span>
        initial<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>CheckboxSelectMultiple<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>date类型</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django <span class="token keyword">import</span> forms
<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> widgets
<span class="token keyword">class</span> <span class="token class-name">BookForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    date <span class="token operator">=</span> forms<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span>widget<span class="token operator">=</span>widgets<span class="token punctuation">.</span>TextInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'type'</span><span class="token punctuation">:</span><span class="token string">'date'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#必须指定type，不然不能渲染成选择时间的input框</span>
</code></pre></div></li> <li><p><strong>choice字段注意事项</strong>： 如果这个配置的choice的选项是从数据库中获得的，印美初始化Form再视图函数之前，所以无法自动实时更新数据库中的数据，如果想使数据库总的数据能自动更新，我们需要重写构造方法使choice实时更新。</p> <div class="language-python extra-class"><pre class="language-python"><code> <span class="token comment"># 方式一：</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> Form
<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> widgets
<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> fields

<span class="token keyword">class</span> <span class="token class-name">MyForm</span><span class="token punctuation">(</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> fields<span class="token punctuation">.</span>ChoiceField<span class="token punctuation">(</span>
        <span class="token comment"># choices=((1, '上海'), (2, '北京'),), #没有初始化的饿时候会自动添加</span>
        initial<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
        widget<span class="token operator">=</span>widgets<span class="token punctuation">.</span>Select<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>MyForm<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span> <span class="token comment">#注意重写init方法的时候，*args和**kwargs一定要给人家写上，不然会出问题，并且验证总是不能通过，还不显示报错信息</span>
        self<span class="token punctuation">.</span>fields<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>choices <span class="token operator">=</span> models<span class="token punctuation">.</span>Classes<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span><span class="token string">'caption'</span><span class="token punctuation">)</span>  <span class="token comment"># 每次带着数据回啦都要去数据库获得一次数据，需要注意的是choices接受的是一对列表</span>
        
 <span class="token comment"># 方式二：</span>
<span class="token keyword">from</span> django <span class="token keyword">import</span> forms
<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> fields
<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> models <span class="token keyword">as</span> form_model
 
<span class="token keyword">class</span> <span class="token class-name">FInfo</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    authors <span class="token operator">=</span> forms<span class="token punctuation">.</span>ModelMultipleChoiceField<span class="token punctuation">(</span>queryset<span class="token operator">=</span>models<span class="token punctuation">.</span>NNewType<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 多选</span>
    <span class="token comment">#或者下面这种方式，通过forms里面的models中提供的方法也是一样的。</span>
    authors <span class="token operator">=</span> form_model<span class="token punctuation">.</span>ModelMultipleChoiceField<span class="token punctuation">(</span>queryset<span class="token operator">=</span>models<span class="token punctuation">.</span>NNewType<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 多选</span>
    
    <span class="token comment">#authors = form_model.ModelChoiceField(queryset=models.NNewType.objects.all())  # 单选</span>
    <span class="token comment">#或者</span>
   <span class="token comment">#authors= forms.ModelChoiceField(queryset=models.Publisth.objects.all(),widget=forms.widgets.Select()) 单选</span>
  	
    
   authors <span class="token operator">=</span> forms<span class="token punctuation">.</span>ModelMultipleChoiceField<span class="token punctuation">(</span>
    queryset<span class="token operator">=</span>models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    widget <span class="token operator">=</span> forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>Select<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'form-control'</span><span class="token punctuation">}</span>
   <span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token comment">#如果用这种方式，别忘了model表中，NNEWType的__str__方法要写上，不然选择框里面是一个个的object对象</span>
</code></pre></div></li></ul> <p><strong>常见form内置字段参数</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code>Field
    required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>               是否允许为空
    widget<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                 HTML插件
    label<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                  用于生成Label标签或显示内容
    initial<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                初始值
    help_text<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>                帮助信息<span class="token punctuation">(</span>在标签旁边显示<span class="token punctuation">)</span>
    error_messages<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>         错误信息 <span class="token punctuation">{</span><span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token string">'不能为空'</span><span class="token punctuation">,</span> <span class="token string">'invalid'</span><span class="token punctuation">:</span> <span class="token string">'格式错误'</span><span class="token punctuation">}</span>
    validators<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>               自定义验证规则
    localize<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>              是否支持本地化
    disabled<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>              是否可以编辑
    label_suffix<span class="token operator">=</span><span class="token boolean">None</span>            Label内容后缀
  
CharField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
    max_length<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>             最大长度
    min_length<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>             最小长度
    strip<span class="token operator">=</span><span class="token boolean">True</span>                   是否移除用户输入空白
 
IntegerField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
    max_value<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>              最大值
    min_value<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>              最小值
 
FloatField<span class="token punctuation">(</span>IntegerField<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 
DecimalField<span class="token punctuation">(</span>IntegerField<span class="token punctuation">)</span>
    max_value<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>              最大值
    min_value<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>              最小值
    max_digits<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>             总长度
    decimal_places<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>         小数位长度
 
BaseTemporalField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
    input_formats<span class="token operator">=</span><span class="token boolean">None</span>          时间格式化   
 
DateField<span class="token punctuation">(</span>BaseTemporalField<span class="token punctuation">)</span>    格式：<span class="token number">2015</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">01</span>
TimeField<span class="token punctuation">(</span>BaseTemporalField<span class="token punctuation">)</span>    格式：<span class="token number">11</span><span class="token punctuation">:</span><span class="token number">12</span>
DateTimeField<span class="token punctuation">(</span>BaseTemporalField<span class="token punctuation">)</span>格式：<span class="token number">2015</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">11</span><span class="token punctuation">:</span><span class="token number">12</span>
 
DurationField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>            时间间隔：<span class="token operator">%</span>d <span class="token operator">%</span>H<span class="token punctuation">:</span><span class="token operator">%</span>M<span class="token punctuation">:</span><span class="token operator">%</span>S<span class="token punctuation">.</span><span class="token operator">%</span>f
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 
RegexField<span class="token punctuation">(</span>CharField<span class="token punctuation">)</span>
    regex<span class="token punctuation">,</span>                      自定制正则表达式
    max_length<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>            最大长度
    min_length<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>            最小长度
    error_message<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>         忽略，错误信息使用 error_messages<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'invalid'</span><span class="token punctuation">:</span> <span class="token string">'...'</span><span class="token punctuation">}</span>
</code></pre></div><h2 id="字段校验"><a href="#字段校验" class="header-anchor">#</a> 字段校验</h2> <ul><li><p><strong>内置校验</strong>：</p> <div class="language- extra-class"><pre class="language-text"><code>required=True
min_length
max_length
</code></pre></div></li> <li><p><strong>自定义校验器</strong>：都是针对字段属性validationError=[]</p> <ul><li><p>1、自定义函数校验器：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ValidationError
<span class="token keyword">from</span> django <span class="token keyword">import</span> forms
<span class="token keyword">def</span> <span class="token function">checkname</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 这是填入validators列表中的自定义规则，value是浏览器传回来的该字段对应的值</span>
    <span class="token comment"># 通过校验规则 不做任何操作</span>
    <span class="token comment"># 不通过校验规则   抛出异常</span>
    <span class="token keyword">if</span> <span class="token string">'alex'</span> <span class="token keyword">in</span> value<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValidationError<span class="token punctuation">(</span><span class="token string">'不符合社会主义核心价值观'</span><span class="token punctuation">)</span>
        
 <span class="token comment"># 视图函数中使用</span>
 <span class="token keyword">class</span> <span class="token class-name">RegForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'用户名'</span><span class="token punctuation">,</span>min_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span>
                               widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>TextInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'class'</span><span class="token punctuation">:</span><span class="token string">'form-control'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                               initial<span class="token operator">=</span><span class="token string">'李四'</span><span class="token punctuation">,</span>
                               required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                               validators<span class="token operator">=</span><span class="token punctuation">[</span>checkname<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">#将函数名填入</span>
                               error_messages<span class="token operator">=</span><span class="token punctuation">{</span>
                                   <span class="token string">'required'</span><span class="token punctuation">:</span><span class="token string">'用户名必填'</span><span class="token punctuation">,</span>
                                   <span class="token string">'min_length'</span><span class="token punctuation">:</span><span class="token string">'长度大于6'</span><span class="token punctuation">,</span>
                               <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>使用内置的校验器：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>validators <span class="token keyword">import</span> RegexValidator
<span class="token keyword">from</span> django <span class="token keyword">import</span> forms

<span class="token keyword">class</span> <span class="token class-name">MyForm</span><span class="token punctuation">(</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
     phone <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>
        validators<span class="token operator">=</span><span class="token punctuation">[</span>RegexValidator<span class="token punctuation">(</span><span class="token string">r'^1[1-9]\d{9}$'</span><span class="token punctuation">,</span><span class="token string">'手机号格式不正确'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>    
</code></pre></div></li></ul></li></ul> <h2 id="钩子函数-hook"><a href="#钩子函数-hook" class="header-anchor">#</a> 钩子函数（Hook）：</h2> <p>​	再之前我们学到的字段校验的两种方式，下面我们将使用钩子函数定制自己的校验规则。有个很大的坑，就是执行<strong>顺序的优先级</strong>。</p> <ul><li><p><strong>局部钩子</strong>：对一个字段进行校验（局部），为什么叫钩子？因为在源码中使用：if hasattr(self,'clean_%s'%name): 去触发后面的函数，只有我们在类中谢了这个函数才能触发（就像鱼钩一样，只有你咬了，才会触发相应的事件）。局部钩子，正常需要返回该字段的值，异常则要主动抛异常</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">ReForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>
        <span class="token comment"># min_length=6,  # 注意要是有内置校验字段，最先执行这，如果满足了直接不会再执行自定义函数、钩子函数、全局函数</span>
        widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>TextInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;form-control&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">clean_username</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        value <span class="token operator">=</span> self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 从cleaned_data中取出值，正确则返会</span>
        <span class="token keyword">if</span> <span class="token string">&quot;666&quot;</span> <span class="token keyword">in</span> value<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValidationError<span class="token punctuation">(</span><span class="token string">&quot;光喊666是不行的&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 不抛错，报错信息无法加入，但是可以自己添加到self.add_error中</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> value
</code></pre></div></li> <li><p><strong>全局钩子</strong>：一般用户所有字段验证都通过了，最后一步的校验。全局钩子通过的验证要return self.cleaned_data,没通过的要主动抛异常</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django <span class="token keyword">import</span> forms
<span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ValidationError
<span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>validators <span class="token keyword">import</span> RegexValidator
<span class="token keyword">class</span> <span class="token class-name">RegForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'用户名'</span><span class="token punctuation">,</span>min_length<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
                               widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>TextInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'class'</span><span class="token punctuation">:</span><span class="token string">'form-control'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                               initial<span class="token operator">=</span><span class="token string">'李四'</span><span class="token punctuation">,</span>
                               required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                               validators<span class="token operator">=</span><span class="token punctuation">[</span>checkname<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                               error_messages<span class="token operator">=</span><span class="token punctuation">{</span>
                                   <span class="token string">'required'</span><span class="token punctuation">:</span><span class="token string">'用户名必填'</span><span class="token punctuation">,</span>
                                   <span class="token string">'min_length'</span><span class="token punctuation">:</span><span class="token string">'长度大于6'</span><span class="token punctuation">,</span>
                               <span class="token punctuation">}</span><span class="token punctuation">)</span>
    pwd <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'密码'</span><span class="token punctuation">,</span>min_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span>widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>PasswordInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'class'</span><span class="token punctuation">:</span><span class="token string">'form-control'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    gender <span class="token operator">=</span> forms<span class="token punctuation">.</span>ChoiceField<span class="token punctuation">(</span>
        choices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">&quot;性别&quot;</span><span class="token punctuation">,</span>
        initial<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
    re_pwd <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'确认密码'</span><span class="token punctuation">,</span> min_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>PasswordInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'form-control'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
    hobby <span class="token operator">=</span> forms<span class="token punctuation">.</span>MultipleChoiceField<span class="token punctuation">(</span>
        <span class="token comment"># choices=models.Class.objects.values_list('id','name'),</span>
        label<span class="token operator">=</span><span class="token string">&quot;班级&quot;</span><span class="token punctuation">,</span>
        initial<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>CheckboxSelectMultiple<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    phone <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>
        validators<span class="token operator">=</span><span class="token punctuation">[</span>RegexValidator<span class="token punctuation">(</span><span class="token string">r'^1[1-9]\d{9}$'</span><span class="token punctuation">,</span><span class="token string">'手机号格式不正确'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fields<span class="token punctuation">[</span><span class="token string">'hobby'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>choices <span class="token operator">=</span> models<span class="token punctuation">.</span>Class<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">clean_username</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>
        v <span class="token operator">=</span> self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">'wang'</span> <span class="token keyword">in</span> v<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValidationError<span class="token punctuation">(</span><span class="token string">'太多了'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> v
        
    <span class="token keyword">def</span> <span class="token function">clean</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 全局钩子校验密码</span>
        pwd <span class="token operator">=</span> self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'pwd'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span>
        re_pwd <span class="token operator">=</span> self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'re_pwd'</span><span class="token punctuation">)</span>  <span class="token comment"># 可能两个都为空</span>
        <span class="token keyword">if</span> pwd <span class="token operator">==</span> re_pwd<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>cleaned_data   <span class="token comment"># 正常通过必须返回cleaned_data</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>add_error<span class="token punctuation">(</span><span class="token string">'re_pwd'</span><span class="token punctuation">,</span><span class="token string">'两次密码不一致'</span><span class="token punctuation">)</span>  <span class="token comment"># 自己添加进一般错误</span>
            <span class="token keyword">raise</span> ValidationError<span class="token punctuation">(</span><span class="token string">'两次密码不一致'</span><span class="token punctuation">)</span>  <span class="token comment"># 默认添加到__all__中</span>
                      
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
 <span class="token comment"># 视图函数</span>
<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    form_obj <span class="token operator">=</span> RegForm<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method<span class="token operator">==</span><span class="token string">'POST'</span><span class="token punctuation">:</span>
        form_obj <span class="token operator">=</span> RegForm<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span> <span class="token comment"># 前端回来的数据</span>
        <span class="token keyword">if</span> form_obj<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'注册成功'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'adds_student.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'form_obj'</span><span class="token punctuation">:</span>form_obj<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h4 id="is-valid-的流程"><a href="#is-valid-的流程" class="header-anchor">#</a> is_valid() 的流程：</h4> <ul><li><p>总的来说，就是对前端返回的数据进行验证等顺序： 1内置校验规则  -&gt; 2自定义校验器 -&gt;  3局部钩子  -&gt; 4全局钩子   ( 内置校验规则和自定义校验能第一时间打印，其他的钩子函数是再其后面的，如果前面通过了才有他们出现，且全局钩子的错误出现再__all__中，可以去[0], 或则自己添加进一般错误队列： self.add_error('re_pwd','两次密码不一致') )</p> <div class="language- extra-class"><pre class="language-text"><code>1、执行full_clean()的方法：
	定义错误字典
	定义存放清洗数据的字典
2、执行_clean_fields方法：
	2.1、循环所有的字段
	2.2、获取当前的值
	2.3、对字段进行校验 （ 1内置校验规则   2自定义校验器）
		2.3.1、通过校验：
        	self.cleaned_data[name] = value 如果有3局部钩子，执行进行校验：
			通过校验——》 self.cleaned_data[name] = value 不通过校验——》     			 self._errors 添加当前字段的错误 并且 self.cleaned_data中当前字段			 的值删除掉。
	     2.3.2、没有通过校验：self._errors  添加当前字段的错误
3、执行全局钩子 clean方法  
   注意：每个字段进行校验，一个字段校验不成功，就将错误信息添加到错误信息表，并不会返回错误值（如果取，则为空，取不到），等全部字段都校验成功后，才走全局钩子。
</code></pre></div></li></ul> <h4 id="form组件使用技巧"><a href="#form组件使用技巧" class="header-anchor">#</a> form组件使用技巧：</h4> <ul><li><p><strong>HTML方面：使用for循环渲染html文件</strong>：配合bootstrap，注意在form标签后面增加novalidate，表示关闭bootstrap表单验证（关闭前端校验）</p> <div class="language-html extra-class"><pre class="language-html"><code></code></pre></div></li></ul> <html lang="en"><head><meta charset="UTF-8"> <title>Title</title> <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css"></head> <body><div class="container"><div class="row"><div class="col-md-6 col-md-offset-2"><h3>添加用户</h3><br> <form action="" method="post" novalidate="novalidate">
                  {% csrf_token %}
                  {% for field in form %}
                      <div class="form-group"><label for="">\{\{ field.label /}/}</label>
                          \{\{ field /}/}<span class="text-danger">\{\{ field.errors.0 /}/}</span></div>
                  {% endfor %}
                  <br> <input type="submit" class="btn btn-success btn-sm"></form></div></div></div></body></html>
  ```
<ul><li><p><strong>视图函数方面： Widgets</strong>：Widget 是Django 对HTML 输入元素的表示。Widget 负责渲染HTML和提取GET/POST 字典中的数据。如果你想让某个Widget 实例与其它Widget 看上去不一样，你需要在Widget 对象实例化并赋值给一个表单字段时指定额外的属性（以及可能需要在你的CSS 文件中添加一些规则）</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span>HttpResponse
<span class="token keyword">from</span> django <span class="token keyword">import</span> forms  <span class="token comment"># 必须导入模块</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> widgets

<span class="token keyword">class</span> <span class="token class-name">UserForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 必须继承Form</span>
    <span class="token comment">#定义变量，专门给text类型的输入框添加class</span>
    wid <span class="token operator">=</span> widgets<span class="token punctuation">.</span>TextInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;form-control&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">#限制数据为字符串，最小长度4,最大长度12</span>
    name <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>min_length<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>max_length<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span>label<span class="token operator">=</span><span class="token string">&quot;姓名&quot;</span><span class="token punctuation">,</span>widget<span class="token operator">=</span>wid<span class="token punctuation">)</span>
    age <span class="token operator">=</span> forms<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">&quot;年龄&quot;</span><span class="token punctuation">,</span>widget<span class="token operator">=</span>wid<span class="token punctuation">)</span>  <span class="token comment"># 限制为数字</span>
    <span class="token comment"># 限制为邮箱格式</span>
    email <span class="token operator">=</span> forms<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">&quot;邮箱&quot;</span><span class="token punctuation">,</span>widget<span class="token operator">=</span>widgets<span class="token punctuation">.</span>EmailInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;form-control&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">#限制长度为11位</span>
    tel <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>min_length<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">,</span>max_length<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">,</span>label<span class="token operator">=</span><span class="token string">&quot;手机号码&quot;</span><span class="token punctuation">,</span>widget<span class="token operator">=</span>wid<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">&quot;index.html&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">adduser</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">:</span>    
        form <span class="token operator">=</span> UserForm<span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span> <span class="token comment"># 将post数据传给UserForm,每次都验证</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span>
        <span class="token keyword">if</span> form<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 验证数据</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;###success###&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>form<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">)</span>  <span class="token comment"># 所有干净的字段以及对应的值</span>
            <span class="token comment"># ErrorDict : {&quot;校验错误的字段&quot;:[&quot;错误信息&quot;,]}</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>form<span class="token punctuation">.</span>errors<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>form<span class="token punctuation">.</span>errors<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 打印</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;###fail###&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>form<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>form<span class="token punctuation">.</span>errors<span class="token punctuation">)</span>
            <span class="token comment"># 获取email错误信息,返回一个错误列表,可以切片</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>form<span class="token punctuation">.</span>errors<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment"># 获取第一个错误信息</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>form<span class="token punctuation">.</span>errors<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;adduser.html&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;form&quot;</span><span class="token punctuation">:</span>form<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        form <span class="token operator">=</span> UserForm<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#get是初始化from</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">&quot;adduser.html&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;form&quot;</span><span class="token punctuation">:</span>form<span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token comment"># attrs 表示设置css样式，它接收一个字典，可以写多个css样式！    </span>
</code></pre></div></li></ul> <h2 id="modelform"><a href="#modelform" class="header-anchor">#</a> ModelForm</h2> <p>​		通常在Django项目中，我们编写的大部分都是与Django 的模型紧密映射的表单。 举个例子，你也许会有个Book 模型，并且你还想创建一个form表单用来添加和编辑书籍信息到这个模型中。 在这种情况下，在form表单中定义字段将是冗余的，因为我们已经在模型中定义了那些字段。基于这个原因，Django 提供一个辅助类来让我们可以从Django 的模型创建Form，这就是ModelForm。（将基于Model来创建form）</p> <ul><li><p>**modelForm定义：**form与model的终极结合，会根据你model中的字段转换成对应的form字段，并且并你生成标签等操作。</p> <div class="language-python extra-class"><pre class="language-python"><code> <span class="token comment"># 比如此时你的models.py文件中有如下模型</span>
<span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    nid <span class="token operator">=</span> models<span class="token punctuation">.</span>AutoField<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span> max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
    publishDate<span class="token operator">=</span>models<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    price<span class="token operator">=</span>models<span class="token punctuation">.</span>DecimalField<span class="token punctuation">(</span>max_digits<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>decimal_places<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
    publish<span class="token operator">=</span>models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&quot;Publish&quot;</span><span class="token punctuation">,</span>to_field<span class="token operator">=</span><span class="token string">&quot;nid&quot;</span><span class="token punctuation">)</span>
    authors<span class="token operator">=</span>models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'Author'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>title 
    
  <span class="token comment"># 在views.py文件中写如下代码，当然后面我们将这个生成form的代码，单独写进一个模块中</span>
<span class="token keyword">class</span> <span class="token class-name">BookForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>ModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> models<span class="token punctuation">.</span>Book
        fields <span class="token operator">=</span> <span class="token string">&quot;__all__&quot;</span>  <span class="token comment"># 这将导入所有字段，当然我们可以使用['nid','title',...] 来单独提取想要的字段</span>
        labels <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;title&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;书名&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;price&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;价格&quot;</span>
        <span class="token punctuation">}</span>
        widgets <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment"># 给相应的字段添加属性</span>
            <span class="token string">&quot;password&quot;</span><span class="token punctuation">:</span> forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>PasswordInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;c1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">&quot;publishDate&quot;</span><span class="token punctuation">:</span> forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>DateInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;date&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        
        
  <span class="token comment"># class Meta常用参数：</span>
model <span class="token operator">=</span> models<span class="token punctuation">.</span>Book  <span class="token comment"># 对应的Model中的类</span>
fields <span class="token operator">=</span> <span class="token string">&quot;__all__&quot;</span>  <span class="token comment"># 字段，如果是__all__,就是表示列出所有的字段</span>
exclude <span class="token operator">=</span> <span class="token boolean">None</span>  <span class="token comment"># 排除的字段，排除的字段</span>
labels <span class="token operator">=</span> <span class="token boolean">None</span>  <span class="token comment"># 提示信息</span>
help_texts <span class="token operator">=</span> <span class="token boolean">None</span>  <span class="token comment"># 帮助提示信息</span>
widgets <span class="token operator">=</span> <span class="token boolean">None</span>  <span class="token comment"># 自定义插件</span>
error_messages <span class="token operator">=</span> <span class="token boolean">None</span>  <span class="token comment"># 自定义错误信息</span>
error_messages <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'title'</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">'required'</span><span class="token punctuation">:</span><span class="token string">'不能为空'</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span> <span class="token comment">#每个字段的所有的错误都可以写，...是省略的意思，复制黏贴我代码的时候别忘了删了...</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><strong>批量添加样式：</strong> 和form的一样</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>ModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    r_password <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#想多验证一些字段可以单独拿出来写，按照form的写法，写在Meta的上面或者下面都可以，原本模型中没有，就自己创建，如果原有字段想重写，就直接写就是了，默认会使用当前字段的，相当于重写</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> models<span class="token punctuation">.</span>Book
        <span class="token comment"># fields = ['title','price']</span>
        fields <span class="token operator">=</span> <span class="token string">&quot;__all__&quot;</span> <span class="token comment">#['title,'price'] 指定字段生成form</span>
        <span class="token comment"># exclude=['title',] #排除字段</span>
        labels <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;title&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;书名&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;price&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;价格&quot;</span>
        <span class="token punctuation">}</span>
        error_messages <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'title'</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">'required'</span><span class="token punctuation">:</span><span class="token string">'不能为空'</span><span class="token punctuation">,</span><span class="token punctuation">}</span> <span class="token comment">#每个字段的错误都可以写</span>
        <span class="token punctuation">}</span>
    <span class="token comment">#如果models中的字段和咱们需要验证的字段对不齐的是，比如注册时，咱们需要验证密码和确认密码两个字段数据，但是后端数据库就保存一个数据就行，那么验证是两个，数据保存是一个，就可以再接着写form字段</span>
    r_password <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>。
    <span class="token comment">#同样的，如果想做一些特殊的验证定制，那么和form一昂，也是那两个钩子（全局和局部），写法也是form那个的写法，直接在咱们的类里面写：</span>
    <span class="token comment">#局部钩子：</span>
    <span class="token keyword">def</span> <span class="token function">clean_title</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
　　<span class="token comment">#全局钩子</span>
    <span class="token keyword">def</span> <span class="token function">clean</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#批量操作</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        <span class="token keyword">for</span> field <span class="token keyword">in</span> self<span class="token punctuation">.</span>fields<span class="token punctuation">:</span>
            <span class="token comment">#field.error_messages = {'required':'不能为空'} #批量添加错误信息,这是都一样的错误，不一样的还是要单独写。</span>
            self<span class="token punctuation">.</span>fields<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span>widget<span class="token punctuation">.</span>attrs<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'class'</span><span class="token punctuation">:</span><span class="token string">'form-control'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>**ModelForm的验证：**与普通的Form表单验证类型类似，ModelForm表单的验证在调用is_valid() 或访问errors 属性时隐式调用。我们可以像使用Form类一样自定义局部钩子方法和全局钩子方法来实现自定义的校验规则。如果我们不重写具体字段并设置validators属性的话，ModelForm是按照模型中字段的validators来校验的。</p></li> <li><p><strong>save() 方法</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code>	<span class="token comment"># 每个ModelForm还具有一个save()方法。 这个方法根据表单绑定的数据创建并保存数据库对象。 ModelForm的子类可以接受现有的模型实例作为关键字参数instance；如果提供此功能，则save()将更新该实例。 如果没有提供，save() 将创建模型的一个新实例： （传统的create(**dic)方式也是可以的，但是比较麻烦，当一组数据经过校验了，我们可以通过在is_vaild()函数后，取出清除的数据form_obj.cleaned_data(),所以使用models.user.object.create(**form_obj.cleaned_data)也是可以的）</span>
    
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> myapp<span class="token punctuation">.</span>models <span class="token keyword">import</span> Book
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> myapp<span class="token punctuation">.</span>forms <span class="token keyword">import</span> BookForm

<span class="token comment"># 根据POST数据创建一个新的form对象</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> form_obj <span class="token operator">=</span> BookForm<span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span>

<span class="token comment"># 创建书籍对象</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> new_ book <span class="token operator">=</span> form_obj<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 基于一个书籍对象创建form对象</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> edit_obj <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># 使用POST提交的数据更新书籍对象</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> form_obj <span class="token operator">=</span> BookForm<span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">,</span> instance<span class="token operator">=</span>edit_obj<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> form_obj<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>   

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
 <span class="token comment"># 之前我们通过form组件来保存书籍数据的时候的写法</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
        form_obj <span class="token operator">=</span> BookForm<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'index.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'form_obj'</span><span class="token punctuation">:</span>form_obj<span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">else</span><span class="token punctuation">:</span>
        form_obj <span class="token operator">=</span> BookForm<span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span>
        <span class="token keyword">if</span> form_obj<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># authors_obj = form_obj.cleaned_data.pop('authors')</span>
            <span class="token comment"># new_book_obj = models.Book.objects.create(**form_obj.cleaned_data)</span>
            <span class="token comment"># new_book_obj.authors.add(*authors_obj)</span>
            form_obj<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#因为我们再Meta中指定了是哪张表，所以它会自动识别，不管是外键还是多对多等，都会自行处理保存，它完成的就是上面三句话做的事情，并且还有就是如果你验证的数据比你后端数据表中的字段多，那么他自会自动剔除多余的不需要保存的字段，比如那个重复确认密码就不要保存</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'show'</span><span class="token punctuation">)</span>

        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>form_obj<span class="token punctuation">.</span>errors<span class="token punctuation">)</span>
            <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'index.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'form_obj'</span><span class="token punctuation">:</span>form_obj<span class="token punctuation">}</span><span class="token punctuation">)</span>    
</code></pre></div></li> <li><p><strong>实列</strong>:使用modelForm来创建一个页面</p> <div class="language-python extra-class"><pre class="language-python"><code>  <span class="token comment"># html文件中</span>
<span class="token punctuation">{</span><span class="token operator">%</span> load static <span class="token operator">%</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span>!DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Title<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">&quot;stylesheet&quot;</span> href<span class="token operator">=</span><span class="token string">&quot;{% static 'bootstrap-3.3.0-dist/dist/css/bootstrap.min.css' %}&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>编辑页面<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;container-fluid&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;row&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;col-md-6 col-md-offset-3&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token string">&quot;{% url 'edit_book' n %}&quot;</span> novalidate method<span class="token operator">=</span><span class="token string">&quot;post&quot;</span><span class="token operator">&gt;</span>
                <span class="token punctuation">{</span><span class="token operator">%</span> csrf_token <span class="token operator">%</span><span class="token punctuation">}</span>
                <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">for</span> field <span class="token keyword">in</span> form <span class="token operator">%</span><span class="token punctuation">}</span>
                    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-group&quot;</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>label <span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;\{\{ field.id_for_label /}/}&quot;</span><span class="token operator">&gt;</span>\<span class="token punctuation">{</span>\<span class="token punctuation">{</span> field<span class="token punctuation">.</span>label <span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span>
                        \<span class="token punctuation">{</span>\<span class="token punctuation">{</span> field <span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">}</span>
                        <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;text-danger&quot;</span><span class="token operator">&gt;</span>\<span class="token punctuation">{</span>\<span class="token punctuation">{</span> field<span class="token punctuation">.</span>errors<span class="token punctuation">.</span><span class="token number">0</span> <span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                <span class="token punctuation">{</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">}</span>

                <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-group&quot;</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;submit&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn btn-primary pull-right&quot;</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

            <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;{% static 'bootstrap-3.3.0-dist/dist/jQuery/jquery-3.1.1.js' %}&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;{% static 'bootstrap-3.3.0-dist/dist/js/bootstrap.min.js' %}&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
 
    <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
  <span class="token comment"># 相应的views.py文件中</span>
<span class="token keyword">def</span> <span class="token function">edit_book</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>

    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
        <span class="token comment"># all_authors = models.Author.objects.all() #</span>
        <span class="token comment"># all_publish = models.Publish.objects.all()</span>

        form <span class="token operator">=</span> BookForm<span class="token punctuation">(</span>instance<span class="token operator">=</span>book_obj<span class="token punctuation">)</span>

        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'edit_book.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'form'</span><span class="token punctuation">:</span>form<span class="token punctuation">,</span><span class="token string">'n'</span><span class="token punctuation">:</span>n<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">#传递的这个n参数是给form表单提交数据的是的action的url用的，因为它需要一个参数来识别是更新的哪条记录</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        form <span class="token operator">=</span> BookForm<span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">,</span>instance<span class="token operator">=</span>book_obj<span class="token punctuation">)</span> <span class="token comment">#必须指定instance，不然我们调用save方法的是又变成了添加操作</span>
        <span class="token keyword">if</span> form<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            form<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'show'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'edit_book.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'form'</span><span class="token punctuation">:</span>form<span class="token punctuation">,</span><span class="token string">'n'</span><span class="token punctuation">:</span>n<span class="token punctuation">}</span><span class="token punctuation">)</span>  
  
</code></pre></div></li> <li><p>**总结加补充：**这是一个神奇的组件，通过名字我们可以看出来，这个组件的功能就是把model和form组合起来，先来一个简单的例子来看一下这个东西怎么用：比如我们的数据库中有这样一张学生表，字段有姓名，年龄，爱好，邮箱，电话，住址，注册时间等等一大堆信息，现在让你写一个创建学生的页面，你的后台应该怎么写呢？首先我们会在前端一个一个罗列出这些字段，让用户去填写，然后我们从后天一个一个接收用户的输入，创建一个新的学生对象，保存其实，重点不是这些，而是合法性验证，我们需要在前端判断用户输入是否合法，比如姓名必须在多少字符以内，电话号码必须是多少位的数字，邮箱必须是邮箱的格式这些当然可以一点一点手动写限制，各种判断，这毫无问题，除了麻烦我们现在有个更优雅（以后在Python相关的内容里，要多用“优雅”这个词，并且养成习惯）的方法：ModelForm先来简单的，生硬的把它用上，再来加验证条件。</p> <ul><li><p><strong>创建modleform</strong>：</p> <div class="language-python extra-class"><pre class="language-python"><code> <span class="token comment">#首先导入ModelForm</span>

<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> ModelForm
<span class="token comment">#在视图函数中，定义一个类，比如就叫StudentList，这个类要继承ModelForm，在这个类中再写一个原类Meta（规定写法，并注意首字母是大写的）</span>
 <span class="token comment">#在这个原类中，有以下属性（部分）：</span>

<span class="token keyword">class</span> <span class="token class-name">StudentList</span><span class="token punctuation">(</span>ModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span>Student <span class="token comment">#对应的Model中的类</span>
        fields <span class="token operator">=</span> <span class="token string">&quot;__all__&quot;</span> <span class="token comment">#字段，如果是__all__,就是表示列出所有的字段</span>
        exclude <span class="token operator">=</span> <span class="token boolean">None</span> <span class="token comment">#排除的字段</span>
        <span class="token comment">#error_messages用法：</span>
        error_messages <span class="token operator">=</span> <span class="token punctuation">{</span>
        	<span class="token string">'name'</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">'required'</span><span class="token punctuation">:</span><span class="token string">&quot;用户名不能为空&quot;</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        	<span class="token string">'age'</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">'required'</span><span class="token punctuation">:</span><span class="token string">&quot;年龄不能为空&quot;</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token comment">#widgets用法,比如把输入用户名的input框给为Textarea</span>
        
        <span class="token comment">#首先得导入模块</span>
        <span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> widgets <span class="token keyword">as</span> wid <span class="token comment">#因为重名，所以起个别名</span>
        widgets <span class="token operator">=</span> <span class="token punctuation">{</span>
        	<span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span>wid<span class="token punctuation">.</span>Textarea<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;c1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">#还可以自定义属性</span>
        <span class="token punctuation">}</span>
        <span class="token comment">#labels，自定义在前端显示的名字</span>
        labels<span class="token operator">=</span> <span class="token punctuation">{</span>
        	<span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;用户名&quot;</span>
        <span class="token punctuation">}</span>
        
  <span class="token comment"># 　然后在url对应的视图函数中实例化这个类，把这个对象传给前端</span>
<span class="token keyword">def</span> <span class="token function">student</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
        student_list <span class="token operator">=</span> StudentList<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'student.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'student_list'</span><span class="token punctuation">:</span>student_list<span class="token punctuation">}</span><span class="token punctuation">)</span>
 
</code></pre></div><p>​    然后前端只需要 {{ student_list.as_p /}/} 一下，所有的字段就都出来了，可以用as_p显示全部，也可以通过for循环这student_list，拿到的是一个个input框，现在我们就不用as_p，手动把这些input框搞出来，as_p拿到的页面太丑。首先 for循环这个student_list，拿到student对象，直接在前端打印这个student，是个input框student.label ，拿到数据库中每个字段的verbose_name ,如果没有设置这个属性，拿到的默认就是字段名，还可以通过student.errors.0 拿到错误信息有了这些，我们就可以通过bootstrap，自己拼出来想要的样式了，比如：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>student<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span> <span class="token attr-name">novalidate</span><span class="token punctuation">&gt;</span></span>
        {% csrf_token %}
        {# \{\{ student_list.as_p /}/}#}
        {% for student in student_list %}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-group col-md-6<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                {# 拿到数据字段的verbose_name,没有就默认显示字段名 #}
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col-md-3 control-label<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\{\{ student.label /}/}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col-md-9<span class="token punctuation">&quot;</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\{\{ student /}/}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        {% endfor %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col-md-2 col-md-offset-10<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>提交<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn-primary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p><strong>添加记录</strong>：保存数据的时候，不用挨个取数据了，只需要save一下</p></li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">student</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
         student_list <span class="token operator">=</span> StudentList<span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'student.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'student_list'</span><span class="token punctuation">:</span>student_list<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
         student_list <span class="token operator">=</span> StudentList<span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span>
         <span class="token keyword">if</span> student_list<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
         student_list<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'student_list.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'student_list'</span><span class="token punctuation">:</span>student_list<span class="token punctuation">}</span><span class="token punctuation">)</span>  
</code></pre></div><ul><li><p><strong>编辑数据：</strong>　如果不用ModelForm，编辑的时候得显示之前的数据吧，还得挨个取一遍值，如果ModelForm，只需要加一个instance=obj（obj是要修改的数据库的一条数据的对象）就可以得到同样的效果，保存的时候要注意，一定要注意有这个对象（instance=obj），否则不知道更新哪一个数据，代码示例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span>HttpResponse<span class="token punctuation">,</span>redirect
<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> ModelForm

<span class="token keyword">from</span> app01 <span class="token keyword">import</span> models
<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model_form <span class="token operator">=</span> models<span class="token punctuation">.</span>Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'test.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'model_form'</span><span class="token punctuation">:</span>model_form<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">StudentList</span><span class="token punctuation">(</span>ModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> models<span class="token punctuation">.</span>Student <span class="token comment">#对应的Model中的类</span>
        fields <span class="token operator">=</span> <span class="token string">&quot;__all__&quot;</span> <span class="token comment">#字段，如果是__all__,就是表示列出所有的字段</span>
        exclude <span class="token operator">=</span> <span class="token boolean">None</span> <span class="token comment">#排除的字段</span>
        labels <span class="token operator">=</span> <span class="token boolean">None</span> <span class="token comment">#提示信息</span>
        help_texts <span class="token operator">=</span> <span class="token boolean">None</span> <span class="token comment">#帮助提示信息</span>
        widgets <span class="token operator">=</span> <span class="token boolean">None</span> <span class="token comment">#自定义插件</span>
        error_messages <span class="token operator">=</span> <span class="token boolean">None</span> <span class="token comment">#自定义错误信息</span>
        <span class="token comment">#error_messages用法：</span>
        error_messages <span class="token operator">=</span> <span class="token punctuation">{</span>
        	<span class="token string">'name'</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">'required'</span><span class="token punctuation">:</span><span class="token string">&quot;用户名不能为空&quot;</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        	<span class="token string">'age'</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">'required'</span><span class="token punctuation">:</span><span class="token string">&quot;年龄不能为空&quot;</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token comment">#widgets用法,比如把输入用户名的input框给为Textarea</span>
        <span class="token comment">#首先得导入模块</span>
        <span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> widgets <span class="token keyword">as</span> wid <span class="token comment">#因为重名，所以起个别名</span>
        widgets <span class="token operator">=</span> <span class="token punctuation">{</span>
       	 	<span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span>wid<span class="token punctuation">.</span>Textarea
        <span class="token punctuation">}</span>
        <span class="token comment">#labels，自定义在前端显示的名字</span>
        labels<span class="token operator">=</span> <span class="token punctuation">{</span>
        	<span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;用户名&quot;</span>
        <span class="token punctuation">}</span>
<span class="token keyword">def</span> <span class="token function">student</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
        student_list <span class="token operator">=</span> StudentList<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'student.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'student_list'</span><span class="token punctuation">:</span>student_list<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        student_list <span class="token operator">=</span> StudentList<span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span>
        <span class="token keyword">if</span> student_list<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            student_list<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'student.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'student_list'</span><span class="token punctuation">:</span>student_list<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">student_edit</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>pk<span class="token punctuation">)</span><span class="token punctuation">:</span>
    obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span>pk<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> obj<span class="token punctuation">:</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">:</span>
        student_list <span class="token operator">=</span> StudentList<span class="token punctuation">(</span>instance<span class="token operator">=</span>obj<span class="token punctuation">)</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'student_edit.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'student_list'</span><span class="token punctuation">:</span>student_list<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        student_list <span class="token operator">=</span> StudentList<span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">,</span>instance<span class="token operator">=</span>obj<span class="token punctuation">)</span>
        <span class="token keyword">if</span> student_list<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            student_list<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'student_edit.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'student_list'</span><span class="token punctuation">:</span>student_list<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul></li></ul> <p><strong>登陆实列</strong>：我将ModelForm封装成一个forms.py文件内容如下</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django <span class="token keyword">import</span> forms
<span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ValidationError
<span class="token keyword">from</span> Ai_crm <span class="token keyword">import</span> models
<span class="token keyword">import</span> hashlib


<span class="token keyword">class</span> <span class="token class-name">RegForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>ModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># form写的太多了，使用modelform</span>
    department <span class="token operator">=</span> forms<span class="token punctuation">.</span>ModelChoiceField<span class="token punctuation">(</span>queryset<span class="token operator">=</span>models<span class="token punctuation">.</span>Department<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> initial<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
                                        widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>Select<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    password <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>min_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>PasswordInput<span class="token punctuation">(</span>
        attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'placeholder'</span><span class="token punctuation">:</span> <span class="token string">'密码'</span><span class="token punctuation">,</span> <span class="token string">'autocomplete'</span><span class="token punctuation">:</span> <span class="token string">'off'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 自己重写password</span>
    re_password <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>min_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>PasswordInput<span class="token punctuation">(</span>
        attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'placeholder'</span><span class="token punctuation">:</span> <span class="token string">'确认密码'</span><span class="token punctuation">,</span> <span class="token string">'autocomplete'</span><span class="token punctuation">:</span> <span class="token string">'off'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 自己新增字段</span>
    mobile <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>
        min_length<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">,</span>
        widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>TextInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'placeholder'</span><span class="token punctuation">:</span> <span class="token string">'手机号'</span><span class="token punctuation">,</span> <span class="token string">'autocomplete'</span><span class="token punctuation">:</span> <span class="token string">'off'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        error_messages<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">&quot;min_length&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;用户名最短11位&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
    
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> models<span class="token punctuation">.</span>UserProfile  <span class="token comment"># 引入用户表</span>
        fields <span class="token operator">=</span> <span class="token string">'__all__'</span>
        exclude <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'is_active'</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>  <span class="token comment"># 排除此字段</span>
        widgets <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'username'</span><span class="token punctuation">:</span> forms<span class="token punctuation">.</span>EmailInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'placeholder'</span><span class="token punctuation">:</span> <span class="token string">'用户名'</span><span class="token punctuation">,</span> <span class="token string">'autocomplete'</span><span class="token punctuation">:</span> <span class="token string">'off'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'mobile'</span><span class="token punctuation">:</span> forms<span class="token punctuation">.</span>TextInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'placeholder'</span><span class="token punctuation">:</span> <span class="token string">'手机号'</span><span class="token punctuation">,</span> <span class="token string">'autocomplete'</span><span class="token punctuation">:</span> <span class="token string">'off'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'name'</span><span class="token punctuation">:</span> forms<span class="token punctuation">.</span>TextInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'placeholder'</span><span class="token punctuation">:</span> <span class="token string">'姓名'</span><span class="token punctuation">,</span> <span class="token string">'autocomplete'</span><span class="token punctuation">:</span> <span class="token string">'off'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment"># 'department':forms.Select(attrs={'class':'form-control'}), # 这种方式有----，所以我重写此字段</span>
        <span class="token punctuation">}</span>
        error_messages <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment"># 设置每个字段的报错，这里的报错只针对widgets，或则说是许哟啊自动生成的字段的一些简单报错处理，要想自定义需重写字段如上的手机号</span>
            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token string">'必填'</span><span class="token punctuation">,</span>
                <span class="token string">'invalid'</span><span class="token punctuation">:</span> <span class="token string">'邮箱格式不正确'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    
    <span class="token comment"># 使用全局钩子来校验密码，局部钩子不能确保谁前谁后</span>
    <span class="token keyword">def</span> <span class="token function">clean</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_validate_unique <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token comment"># 防止字段重复，Form中自带，ModelForm中必须自己添加</span>
        password <span class="token operator">=</span> self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>
        re_password <span class="token operator">=</span> self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'re_password'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> password <span class="token operator">==</span> re_password<span class="token punctuation">:</span>
            md5 <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">)</span>
            md5<span class="token punctuation">.</span>update<span class="token punctuation">(</span>password<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span> <span class="token operator">=</span> md5<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>cleaned_data
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>add_error<span class="token punctuation">(</span><span class="token string">'re_password'</span><span class="token punctuation">,</span> <span class="token string">'两次密码不一致'</span><span class="token punctuation">)</span>
            <span class="token keyword">raise</span> ValidationError<span class="token punctuation">(</span><span class="token string">'两次密码不一致！'</span><span class="token punctuation">)</span>  <span class="token comment"># 不抛错，就无法触发异常</span>

 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
 <span class="token comment"># views.py问题</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span>redirect<span class="token punctuation">,</span>reverse
<span class="token keyword">from</span>  Ai_crm <span class="token keyword">import</span> models
<span class="token keyword">import</span> hashlib
<span class="token keyword">from</span> Ai_crm<span class="token punctuation">.</span>forms <span class="token keyword">import</span> RegForm
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> F

<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span><span class="token string">'POST'</span><span class="token punctuation">:</span>
        username <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>
        password <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>
        md5 <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">)</span>
        md5<span class="token punctuation">.</span>update<span class="token punctuation">(</span>password<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        obj <span class="token operator">=</span> models<span class="token punctuation">.</span>UserProfile<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">,</span> password<span class="token operator">=</span>md5<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> is_active<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> obj<span class="token punctuation">:</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'login.html'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">reg</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    form_obj <span class="token operator">=</span> RegForm<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">:</span>
        form_obj <span class="token operator">=</span> RegForm<span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span>
        <span class="token keyword">if</span> form_obj<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># models.UserProfile.objects.create(**form_obj.cleaned_data)  # 方式一</span>
            obj <span class="token operator">=</span> form_obj<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
            models<span class="token punctuation">.</span>Department<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>userprofile<span class="token operator">=</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>count<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 计数</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span>            
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'reg.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'form_obj'</span><span class="token punctuation">:</span>form_obj<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">customer</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    customer_list <span class="token operator">=</span> models<span class="token punctuation">.</span>Customer<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>customer_list<span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'customer_list.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'list'</span><span class="token punctuation">:</span>customer_list<span class="token punctuation">}</span><span class="token punctuation">)</span>    
</code></pre></div><h4 id="后期整理为父类继承版本"><a href="#后期整理为父类继承版本" class="header-anchor">#</a> 后期整理为父类继承版本：</h4> <ul><li><p>在应用的form.py文件中新建一个父类用于给生成的字段添加样式</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BSModelForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>ModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        
        <span class="token keyword">for</span> field <span class="token keyword">in</span> self<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> <span class="token punctuation">(</span>MultiSelectFormField<span class="token punctuation">,</span> forms<span class="token punctuation">.</span>BooleanField<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 排除几种特殊情况</span>
                <span class="token keyword">continue</span>
            field<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'form-control'</span>

<span class="token keyword">class</span> <span class="token class-name">ConsultRecordForm</span><span class="token punctuation">(</span>BSModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 使用继承，少写代码</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> models<span class="token punctuation">.</span>ConsultRecord
        fields <span class="token operator">=</span> <span class="token string">'__all__'</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> customer_id<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>  <span class="token comment"># 不要传入父类</span>
        <span class="token keyword">if</span> customer_id <span class="token keyword">and</span> customer_id <span class="token operator">!=</span> <span class="token string">'0'</span><span class="token punctuation">:</span>  <span class="token comment"># 跳过我们自制的0</span>
            self<span class="token punctuation">.</span>fields<span class="token punctuation">[</span><span class="token string">'customer'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>choices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'----------'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>pk<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span>               models<span class="token punctuation">.</span>Customer<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span>customer_id<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>fields<span class="token punctuation">[</span><span class="token string">'customer'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>choices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'----------'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>pk<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span>
			request<span class="token punctuation">.</span>user_obj<span class="token punctuation">.</span>customers<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>fields<span class="token punctuation">[</span><span class="token string">'consultant'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>choices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>user_obj<span class="token punctuation">.</span>pk<span class="token punctuation">,</span> request<span class="token punctuation">.</span>user_obj<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>

<span class="token keyword">class</span> <span class="token class-name">ClassListForm</span><span class="token punctuation">(</span>BSModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> models<span class="token punctuation">.</span>ClassList
        fields <span class="token operator">=</span> <span class="token string">'__all__'</span>

</code></pre></div></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/python/django/缓存和信号.html" class="prev">
        缓存和信号
      </a></span> <span class="next"><a href="/python/django/csrf和Ajax.html">
        csrf和Ajax
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.51f2f156.js" defer></script><script src="/assets/js/2.8911ec45.js" defer></script><script src="/assets/js/53.65343ccc.js" defer></script>
  </body>
</html>
