<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>信号 | 独角兕大王</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.ccac5a78.css" as="style"><link rel="preload" href="/assets/js/app.51f2f156.js" as="script"><link rel="preload" href="/assets/js/2.8911ec45.js" as="script"><link rel="preload" href="/assets/js/72.2f8e3aa0.js" as="script"><link rel="prefetch" href="/assets/js/10.6948c28b.js"><link rel="prefetch" href="/assets/js/100.276864ee.js"><link rel="prefetch" href="/assets/js/101.447ab1c7.js"><link rel="prefetch" href="/assets/js/102.f5b3c71d.js"><link rel="prefetch" href="/assets/js/103.16474d4b.js"><link rel="prefetch" href="/assets/js/104.ed58aef3.js"><link rel="prefetch" href="/assets/js/105.045203cd.js"><link rel="prefetch" href="/assets/js/106.be359e0b.js"><link rel="prefetch" href="/assets/js/107.7331bbca.js"><link rel="prefetch" href="/assets/js/108.76e1c800.js"><link rel="prefetch" href="/assets/js/109.e82166f3.js"><link rel="prefetch" href="/assets/js/11.d4ec37c8.js"><link rel="prefetch" href="/assets/js/110.4144755a.js"><link rel="prefetch" href="/assets/js/111.5864ab53.js"><link rel="prefetch" href="/assets/js/112.ca2aee84.js"><link rel="prefetch" href="/assets/js/113.641e7765.js"><link rel="prefetch" href="/assets/js/114.d69f8545.js"><link rel="prefetch" href="/assets/js/115.1b6a9f89.js"><link rel="prefetch" href="/assets/js/116.dde2c44e.js"><link rel="prefetch" href="/assets/js/117.4e79498c.js"><link rel="prefetch" href="/assets/js/12.7aac9c8d.js"><link rel="prefetch" href="/assets/js/13.abf127cd.js"><link rel="prefetch" href="/assets/js/14.aa4413a7.js"><link rel="prefetch" href="/assets/js/15.11a64e5b.js"><link rel="prefetch" href="/assets/js/16.f2d9a882.js"><link rel="prefetch" href="/assets/js/17.11c5bb7f.js"><link rel="prefetch" href="/assets/js/18.a522877b.js"><link rel="prefetch" href="/assets/js/19.6f31a972.js"><link rel="prefetch" href="/assets/js/20.b546c54e.js"><link rel="prefetch" href="/assets/js/21.6d055b7f.js"><link rel="prefetch" href="/assets/js/22.c48feceb.js"><link rel="prefetch" href="/assets/js/23.69941f78.js"><link rel="prefetch" href="/assets/js/24.6126dfc2.js"><link rel="prefetch" href="/assets/js/25.3475449c.js"><link rel="prefetch" href="/assets/js/26.96bb4643.js"><link rel="prefetch" href="/assets/js/27.da610e5d.js"><link rel="prefetch" href="/assets/js/28.b24ec15c.js"><link rel="prefetch" href="/assets/js/29.ec8af553.js"><link rel="prefetch" href="/assets/js/3.bec5f768.js"><link rel="prefetch" href="/assets/js/30.2e780db1.js"><link rel="prefetch" href="/assets/js/31.464c36ed.js"><link rel="prefetch" href="/assets/js/32.ad7d37c2.js"><link rel="prefetch" href="/assets/js/33.722f1ec5.js"><link rel="prefetch" href="/assets/js/34.8448d0fd.js"><link rel="prefetch" href="/assets/js/35.e5168ac9.js"><link rel="prefetch" href="/assets/js/36.edc404f1.js"><link rel="prefetch" href="/assets/js/37.5807602e.js"><link rel="prefetch" href="/assets/js/38.a519c89a.js"><link rel="prefetch" href="/assets/js/39.89af1b9a.js"><link rel="prefetch" href="/assets/js/4.5ed19beb.js"><link rel="prefetch" href="/assets/js/40.6c653db9.js"><link rel="prefetch" href="/assets/js/41.bc3b8b69.js"><link rel="prefetch" href="/assets/js/42.a0a02d9b.js"><link rel="prefetch" href="/assets/js/43.62f344e3.js"><link rel="prefetch" href="/assets/js/44.a7fd9d68.js"><link rel="prefetch" href="/assets/js/45.729c1c39.js"><link rel="prefetch" href="/assets/js/46.5b924aea.js"><link rel="prefetch" href="/assets/js/47.f3990404.js"><link rel="prefetch" href="/assets/js/48.f591f360.js"><link rel="prefetch" href="/assets/js/49.f7f213ad.js"><link rel="prefetch" href="/assets/js/5.2c5d28b5.js"><link rel="prefetch" href="/assets/js/50.b9ca2762.js"><link rel="prefetch" href="/assets/js/51.93672ee6.js"><link rel="prefetch" href="/assets/js/52.fb21314a.js"><link rel="prefetch" href="/assets/js/53.65343ccc.js"><link rel="prefetch" href="/assets/js/54.8081227d.js"><link rel="prefetch" href="/assets/js/55.e207659e.js"><link rel="prefetch" href="/assets/js/56.bde381df.js"><link rel="prefetch" href="/assets/js/57.f8eceb45.js"><link rel="prefetch" href="/assets/js/58.bef70bfd.js"><link rel="prefetch" href="/assets/js/59.7ab7562d.js"><link rel="prefetch" href="/assets/js/6.fc65a1ac.js"><link rel="prefetch" href="/assets/js/60.f40ac3ca.js"><link rel="prefetch" href="/assets/js/61.d2b463ab.js"><link rel="prefetch" href="/assets/js/62.cfdf1bcf.js"><link rel="prefetch" href="/assets/js/63.1e45ce59.js"><link rel="prefetch" href="/assets/js/64.a98fe86e.js"><link rel="prefetch" href="/assets/js/65.0234d7c5.js"><link rel="prefetch" href="/assets/js/66.724906f0.js"><link rel="prefetch" href="/assets/js/67.7806fda6.js"><link rel="prefetch" href="/assets/js/68.9f227dae.js"><link rel="prefetch" href="/assets/js/69.fdbc56ac.js"><link rel="prefetch" href="/assets/js/7.284de54e.js"><link rel="prefetch" href="/assets/js/70.04a9cc03.js"><link rel="prefetch" href="/assets/js/71.a6fa1dd9.js"><link rel="prefetch" href="/assets/js/73.9bbb0cb6.js"><link rel="prefetch" href="/assets/js/74.9f122255.js"><link rel="prefetch" href="/assets/js/75.75e1fbd8.js"><link rel="prefetch" href="/assets/js/76.60ff3c3e.js"><link rel="prefetch" href="/assets/js/77.39a253ae.js"><link rel="prefetch" href="/assets/js/78.0e49712f.js"><link rel="prefetch" href="/assets/js/79.5f9c24a0.js"><link rel="prefetch" href="/assets/js/8.5c21a4cc.js"><link rel="prefetch" href="/assets/js/80.f826f188.js"><link rel="prefetch" href="/assets/js/81.b8995ea7.js"><link rel="prefetch" href="/assets/js/82.e9bf63e0.js"><link rel="prefetch" href="/assets/js/83.e3a00749.js"><link rel="prefetch" href="/assets/js/84.b940927c.js"><link rel="prefetch" href="/assets/js/85.ad46a9b2.js"><link rel="prefetch" href="/assets/js/86.190e0071.js"><link rel="prefetch" href="/assets/js/87.5f9eb9ef.js"><link rel="prefetch" href="/assets/js/88.cfaf7469.js"><link rel="prefetch" href="/assets/js/89.e64cc32c.js"><link rel="prefetch" href="/assets/js/9.0723805d.js"><link rel="prefetch" href="/assets/js/90.805edabe.js"><link rel="prefetch" href="/assets/js/91.6a1ab3f7.js"><link rel="prefetch" href="/assets/js/92.04ecd01e.js"><link rel="prefetch" href="/assets/js/93.e615470a.js"><link rel="prefetch" href="/assets/js/94.0ad7c41c.js"><link rel="prefetch" href="/assets/js/95.0e5ce618.js"><link rel="prefetch" href="/assets/js/96.b59cf9f4.js"><link rel="prefetch" href="/assets/js/97.2a327746.js"><link rel="prefetch" href="/assets/js/98.9c01ec88.js"><link rel="prefetch" href="/assets/js/99.952046bd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ccac5a78.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://github.com/fluidicon.png" alt="独角兕大王" class="logo"> <span class="site-name can-hide">独角兕大王</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/python/" class="nav-link router-link-active">
  Python
</a></div><div class="nav-item"><a href="/rust/" class="nav-link">
  Rust
</a></div><div class="nav-item"><a href="/go/" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/lua/" class="nav-link">
  Lua
</a></div><div class="nav-item"><a href="/C/" class="nav-link">
  C++
</a></div><div class="nav-item"><a href="https://github.com/wuyuz" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.cnblogs.com/double-W/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  cnblogs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/python/" class="nav-link router-link-active">
  Python
</a></div><div class="nav-item"><a href="/rust/" class="nav-link">
  Rust
</a></div><div class="nav-item"><a href="/go/" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/lua/" class="nav-link">
  Lua
</a></div><div class="nav-item"><a href="/C/" class="nav-link">
  C++
</a></div><div class="nav-item"><a href="https://github.com/wuyuz" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.cnblogs.com/double-W/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  cnblogs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python常用模块</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Django框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Flask 框架</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/python/flask/Werkzeug讲解.html" class="sidebar-link">Werkzeug 讲解</a></li><li><a href="/python/flask/路由和配置.html" class="sidebar-link">路由和配置</a></li><li><a href="/python/flask/模板、请求与响应.html" class="sidebar-link">模板、请求与响应</a></li><li><a href="/python/flask/蓝图、请求扩展和中间件.html" class="sidebar-link">蓝图、请求扩展和中间件</a></li><li><a href="/python/flask/数据库连接池.html" class="sidebar-link">数据库连接池</a></li><li><a href="/python/flask/SQLAlchmey.html" class="sidebar-link">SQLAlchmey</a></li><li><a href="/python/flask/WTForms.html" class="sidebar-link">WTForms</a></li><li><a href="/python/flask/信号.html" class="active sidebar-link">信号</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/flask/信号.html#信号" class="sidebar-link">信号</a></li><li class="sidebar-sub-header"><a href="/python/flask/信号.html#内置信号" class="sidebar-link">内置信号</a></li><li class="sidebar-sub-header"><a href="/python/flask/信号.html#自定义flask信号" class="sidebar-link">自定义Flask信号</a></li></ul></li><li><a href="/python/flask/应用上下文.html" class="sidebar-link">应用上下文</a></li><li><a href="/python/flask/内置session理解.html" class="sidebar-link">内置session理解</a></li><li><a href="/python/flask/经典的编程思想.html" class="sidebar-link">经典的编程思想</a></li><li><a href="/python/flask/请求上下文源码分析.html" class="sidebar-link">请求上下文源码分析</a></li><li><a href="/python/flask/上下文管理准备工作.html" class="sidebar-link">上下文管理准备工作</a></li><li><a href="/python/flask/上下文管理源码分析.html" class="sidebar-link">上下文管理源码分析</a></li><li><a href="/python/flask/Flask回顾.html" class="sidebar-link">Flask开发规范和RESTful</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python爬虫</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python设计模式</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="信号"><a href="#信号" class="header-anchor">#</a> 信号</h2> <p>Flask框架中的信号基于blinker，其主要就是让开发者可是在flask请求过程中定制一些用户行为。比如：在存储数据库之前，对每个请求的数据进行写入一条数据</p> <h5 id="准备工作"><a href="#准备工作" class="header-anchor">#</a> 准备工作</h5> <ul><li><p>安装bliker第三方模块</p> <div class="language- extra-class"><pre class="language-text"><code>pip3 install blinker
</code></pre></div></li> <li><p>原因</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span>signals  <span class="token comment">#导入signals</span>
  <span class="token comment">#点击signals源码中，需要导入blinker模块</span>
  <span class="token comment">#signals.py中</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">from</span> blinker <span class="token keyword">import</span> Namespace
    signals_available <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token keyword">except</span> ImportError<span class="token punctuation">:</span>
    signals_available <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

template_rendered <span class="token operator">=</span> _signals<span class="token punctuation">.</span>signal<span class="token punctuation">(</span><span class="token string">&quot;template-rendered&quot;</span><span class="token punctuation">)</span>
before_render_template <span class="token operator">=</span> _signals<span class="token punctuation">.</span>signal<span class="token punctuation">(</span><span class="token string">&quot;before-render-template&quot;</span><span class="token punctuation">)</span>
request_started <span class="token operator">=</span> _signals<span class="token punctuation">.</span>signal<span class="token punctuation">(</span><span class="token string">&quot;request-started&quot;</span><span class="token punctuation">)</span>
request_finished <span class="token operator">=</span> _signals<span class="token punctuation">.</span>signal<span class="token punctuation">(</span><span class="token string">&quot;request-finished&quot;</span><span class="token punctuation">)</span>
request_tearing_down <span class="token operator">=</span> _signals<span class="token punctuation">.</span>signal<span class="token punctuation">(</span><span class="token string">&quot;request-tearing-down&quot;</span><span class="token punctuation">)</span>
got_request_exception <span class="token operator">=</span> _signals<span class="token punctuation">.</span>signal<span class="token punctuation">(</span><span class="token string">&quot;got-request-exception&quot;</span><span class="token punctuation">)</span>
appcontext_tearing_down <span class="token operator">=</span> _signals<span class="token punctuation">.</span>signal<span class="token punctuation">(</span><span class="token string">&quot;appcontext-tearing-down&quot;</span><span class="token punctuation">)</span>
appcontext_pushed <span class="token operator">=</span> _signals<span class="token punctuation">.</span>signal<span class="token punctuation">(</span><span class="token string">&quot;appcontext-pushed&quot;</span><span class="token punctuation">)</span>
appcontext_popped <span class="token operator">=</span> _signals<span class="token punctuation">.</span>signal<span class="token punctuation">(</span><span class="token string">&quot;appcontext-popped&quot;</span><span class="token punctuation">)</span>
message_flashed <span class="token operator">=</span> _signals<span class="token punctuation">.</span>signal<span class="token punctuation">(</span><span class="token string">&quot;message-flashed&quot;</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="内置信号"><a href="#内置信号" class="header-anchor">#</a> 内置信号</h2> <div class="language-python extra-class"><pre class="language-python"><code>request_started <span class="token operator">=</span> _signals<span class="token punctuation">.</span>signal<span class="token punctuation">(</span><span class="token string">'request-started'</span><span class="token punctuation">)</span>                <span class="token comment"># 请求到来前执行</span>
request_finished <span class="token operator">=</span> _signals<span class="token punctuation">.</span>signal<span class="token punctuation">(</span><span class="token string">'request-finished'</span><span class="token punctuation">)</span>              <span class="token comment"># 请求结束后执行</span>
 
before_render_template <span class="token operator">=</span> _signals<span class="token punctuation">.</span>signal<span class="token punctuation">(</span><span class="token string">'before-render-template'</span><span class="token punctuation">)</span>  <span class="token comment"># 模板渲染前执行</span>
template_rendered <span class="token operator">=</span> _signals<span class="token punctuation">.</span>signal<span class="token punctuation">(</span><span class="token string">'template-rendered'</span><span class="token punctuation">)</span>            <span class="token comment"># 模板渲染后执行</span>
 
got_request_exception <span class="token operator">=</span> _signals<span class="token punctuation">.</span>signal<span class="token punctuation">(</span><span class="token string">'got-request-exception'</span><span class="token punctuation">)</span>    <span class="token comment"># 请求执行出现异常时执行</span>
 
request_tearing_down <span class="token operator">=</span> _signals<span class="token punctuation">.</span>signal<span class="token punctuation">(</span><span class="token string">'request-tearing-down'</span><span class="token punctuation">)</span>      <span class="token comment"># 请求执行完毕后自动执行（无论成功与否）</span>
appcontext_tearing_down <span class="token operator">=</span> _signals<span class="token punctuation">.</span>signal<span class="token punctuation">(</span><span class="token string">'appcontext-tearing-down'</span><span class="token punctuation">)</span><span class="token comment"># 应用上下文执行完毕后自动执行（无论成功与否）</span>
 
appcontext_pushed <span class="token operator">=</span> _signals<span class="token punctuation">.</span>signal<span class="token punctuation">(</span><span class="token string">'appcontext-pushed'</span><span class="token punctuation">)</span>            <span class="token comment"># 应用上下文push时执行</span>
appcontext_popped <span class="token operator">=</span> _signals<span class="token punctuation">.</span>signal<span class="token punctuation">(</span><span class="token string">'appcontext-popped'</span><span class="token punctuation">)</span>            <span class="token comment"># 应用上下文pop时执行</span>
message_flashed <span class="token operator">=</span> _signals<span class="token punctuation">.</span>signal<span class="token punctuation">(</span><span class="token string">'message-flashed'</span><span class="token punctuation">)</span>                <span class="token comment"># 调用flask在其中添加数据时，自动触发</span>
</code></pre></div><h5 id="信号使用简单演示"><a href="#信号使用简单演示" class="header-anchor">#</a> 信号使用简单演示</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span>signals

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span><span class="token string">'app01'</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span>debug <span class="token operator">=</span> <span class="token boolean">True</span>

<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'触发信号'</span><span class="token punctuation">,</span> args<span class="token punctuation">,</span> kwargs<span class="token punctuation">)</span>

signals<span class="token punctuation">.</span>request_started<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>func<span class="token punctuation">)</span>  <span class="token comment"># 使用connect将函数注册到信号中，也就是说请求进来就执行，send()是执行信号中的函数</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'视图'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'index'</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
 <span class="token comment"># 运行结果</span>
 触发信号 <span class="token punctuation">(</span><span class="token operator">&lt;</span>Flask <span class="token string">'app01'</span><span class="token operator">&gt;</span><span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
 视图   
</code></pre></div><ul><li><p>小提示</p> <div class="language- extra-class"><pre class="language-text"><code>1、.connect(func)  #是注册函数进信号
2、.send()  #是执行信号中的函数
</code></pre></div></li></ul> <h4 id="信号在哪触发-怎么触发-源码分析"><a href="#信号在哪触发-怎么触发-源码分析" class="header-anchor">#</a> 信号在哪触发？怎么触发？源码分析</h4> <ul><li><p>依旧查看<code>app.__call__</code>中的wsgi_app函数</p> <div class="language-python extra-class"><pre class="language-python"><code> <span class="token keyword">def</span> <span class="token function">wsgi_app</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> environ<span class="token punctuation">,</span> start_response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        ctx <span class="token operator">=</span> self<span class="token punctuation">.</span>request_context<span class="token punctuation">(</span>environ<span class="token punctuation">)</span> <span class="token comment">#将请求相关数据封装到RequestContext的对象ctx中，包括ctx.app、ctx.request、ctx.session</span>
        error <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                ctx<span class="token punctuation">.</span>push<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#将ctx、app_ctx通过LocalStack添加到local中，上下文管理</span>
               
                response <span class="token operator">=</span> self<span class="token punctuation">.</span>full_dispatch_request<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#寻找试图函数执行，将返回值给用户</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                error <span class="token operator">=</span> e
                response <span class="token operator">=</span> self<span class="token punctuation">.</span>handle_exception<span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token comment">#将出错的响应给用户</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>  <span class="token comment"># noqa: B001</span>
                error <span class="token operator">=</span> sys<span class="token punctuation">.</span>exc_info<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
                <span class="token keyword">raise</span>
             <span class="token comment">#对返回值进行处理</span>
            <span class="token keyword">return</span> response<span class="token punctuation">(</span>environ<span class="token punctuation">,</span> start_response<span class="token punctuation">)</span>
        <span class="token keyword">finally</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>should_ignore_error<span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">:</span>
                error <span class="token operator">=</span> <span class="token boolean">None</span>
            ctx<span class="token punctuation">.</span>auto_pop<span class="token punctuation">(</span>error<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>之前我们对ctx、ctx.push进行了详细的分析，接着我们将继续往下进行分析，对<code>full_dispatch_request()</code>进行分析，点击查看源码</p> <div class="language-python extra-class"><pre class="language-python"><code>    <span class="token keyword">def</span> <span class="token function">full_dispatch_request</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>try_trigger_before_first_request_functions<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#用于处理before_first_request函数</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># 执行before_first_request</span>
            request_started<span class="token punctuation">.</span>send<span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token comment">#触发request_started信号里面的注册的函数（connect）</span>
            
            <span class="token comment">#预处理请求，调用before_request函数，包括蓝图的before_request函数</span>
            rv <span class="token operator">=</span> self<span class="token punctuation">.</span>preprocess_request<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> rv <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span> <span class="token comment">#如果为空才执行视图函数的分发</span>
                rv <span class="token operator">=</span> self<span class="token punctuation">.</span>dispatch_request<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">#执行试图函数，以及模板渲染</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            rv <span class="token operator">=</span> self<span class="token punctuation">.</span>handle_user_exception<span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>finalize_request<span class="token punctuation">(</span>rv<span class="token punctuation">)</span>  <span class="token comment">#最后返回返回值</span>
</code></pre></div></li> <li><p>点击 <code>try_trigger_before_first_request_functions()</code> 函数</p> <div class="language-python extra-class"><pre class="language-python"><code>    <span class="token keyword">def</span> <span class="token function">try_trigger_before_first_request_functions</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_got_first_request<span class="token punctuation">:</span>  <span class="token comment">#默认为Flase，第二次进来就为True了，因为已经改了</span>
            <span class="token keyword">return</span>
        <span class="token keyword">with</span> self<span class="token punctuation">.</span>_before_request_lock<span class="token punctuation">:</span> <span class="token comment">#添加了一个锁，是列表安全</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>_got_first_request<span class="token punctuation">:</span>
                <span class="token keyword">return</span> 
            <span class="token keyword">for</span> func <span class="token keyword">in</span> self<span class="token punctuation">.</span>before_first_request_funcs<span class="token punctuation">:</span> <span class="token comment">#循环添加的列表，并执行</span>
                func<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>_got_first_request <span class="token operator">=</span> <span class="token boolean">True</span> <span class="token comment">#关门，第二次进行了就直接return</span>
</code></pre></div></li> <li><p>点击查看 <code>self.preprocess_request()</code> 函数的源码</p> <div class="language-python extra-class"><pre class="language-python"><code>    <span class="token keyword">def</span> <span class="token function">preprocess_request</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        bp <span class="token operator">=</span> _request_ctx_stack<span class="token punctuation">.</span>top<span class="token punctuation">.</span>request<span class="token punctuation">.</span>blueprint

        funcs <span class="token operator">=</span> self<span class="token punctuation">.</span>url_value_preprocessors<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#处理url相关的</span>
        <span class="token keyword">if</span> bp <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> bp <span class="token keyword">in</span> self<span class="token punctuation">.</span>url_value_preprocessors<span class="token punctuation">:</span>
            funcs <span class="token operator">=</span> chain<span class="token punctuation">(</span>funcs<span class="token punctuation">,</span> self<span class="token punctuation">.</span>url_value_preprocessors<span class="token punctuation">[</span>bp<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> func <span class="token keyword">in</span> funcs<span class="token punctuation">:</span>
            func<span class="token punctuation">(</span>request<span class="token punctuation">.</span>endpoint<span class="token punctuation">,</span> request<span class="token punctuation">.</span>view_args<span class="token punctuation">)</span>
		
        <span class="token comment"># self.before_request_funcs = {} 是全局的一个字典</span>
        funcs <span class="token operator">=</span> self<span class="token punctuation">.</span>before_request_funcs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#向全局before_request_func字典获取函数</span>
        <span class="token keyword">if</span> bp <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> bp <span class="token keyword">in</span> self<span class="token punctuation">.</span>before_request_funcs<span class="token punctuation">:</span><span class="token comment"># 注意：默认app存入before_request_funcs字典的的key是None，而蓝图存入的带有子的蓝图名字</span>
            funcs <span class="token operator">=</span> chain<span class="token punctuation">(</span>funcs<span class="token punctuation">,</span> self<span class="token punctuation">.</span>before_request_funcs<span class="token punctuation">[</span>bp<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#如果app和蓝图都有before_request函数，就是用chain链式函数，将函数进行排序，输出</span>
        <span class="token keyword">for</span> func <span class="token keyword">in</span> funcs<span class="token punctuation">:</span> <span class="token comment">#循环每个before_request函数</span>
            rv <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#如果函数有返回值，就返回返回值</span>
            <span class="token keyword">if</span> rv <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> rv
</code></pre></div></li> <li><p><code>dispatch_request()</code> 函数源码，该函数是之执行试图函数</p> <div class="language-python extra-class"><pre class="language-python"><code>    <span class="token keyword">def</span> <span class="token function">dispatch_request</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        req <span class="token operator">=</span> _request_ctx_stack<span class="token punctuation">.</span>top<span class="token punctuation">.</span>request <span class="token comment">#获得ctx中的request属性</span>
        <span class="token keyword">if</span> req<span class="token punctuation">.</span>routing_exception <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>raise_routing_exception<span class="token punctuation">(</span>req<span class="token punctuation">)</span>
        rule <span class="token operator">=</span> req<span class="token punctuation">.</span>url_rule
        <span class="token comment"># if we provide automatic options for this URL and the</span>
        <span class="token comment"># request came with the OPTIONS method, reply automatically</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
            <span class="token builtin">getattr</span><span class="token punctuation">(</span>rule<span class="token punctuation">,</span> <span class="token string">&quot;provide_automatic_options&quot;</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
            <span class="token keyword">and</span> req<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&quot;OPTIONS&quot;</span>
        <span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>make_default_options_response<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># otherwise dispatch to the handler for that endpoint，通过别名找到视图函数并执行</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>view_functions<span class="token punctuation">[</span>rule<span class="token punctuation">.</span>endpoint<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">**</span>req<span class="token punctuation">.</span>view_args<span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>如果我们使用了render_template() 函数</strong>，查看源码</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">render_template</span><span class="token punctuation">(</span>template_name_or_list<span class="token punctuation">,</span> <span class="token operator">**</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#模板的参数，模板渲染</span>
    ctx <span class="token operator">=</span> _app_ctx_stack<span class="token punctuation">.</span>top  <span class="token comment"># 获取到app_ctx中的的AppContext对象</span>
    ctx<span class="token punctuation">.</span>app<span class="token punctuation">.</span>update_template_context<span class="token punctuation">(</span>context<span class="token punctuation">)</span>  <span class="token comment">#将传入的参数给模板中的响应的自定义函数</span>
    <span class="token keyword">return</span> _render<span class="token punctuation">(</span>  <span class="token comment">#调用_render函数</span>
        ctx<span class="token punctuation">.</span>app<span class="token punctuation">.</span>jinja_env<span class="token punctuation">.</span>get_or_select_template<span class="token punctuation">(</span>template_name_or_list<span class="token punctuation">)</span><span class="token punctuation">,</span>
        context<span class="token punctuation">,</span>
        ctx<span class="token punctuation">.</span>app<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>

<span class="token number">2</span>、点击update_template_context<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>为模板中的使用的一些自定义函数，传递参数

<span class="token number">2</span>、查看_render函数源码：
<span class="token keyword">def</span> <span class="token function">_render</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> context<span class="token punctuation">,</span> app<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#如果我们写的时候，谢了before_render_template.connect() 函数，就会执行下面一句</span>
    before_render_template<span class="token punctuation">.</span>send<span class="token punctuation">(</span>app<span class="token punctuation">,</span> template<span class="token operator">=</span>template<span class="token punctuation">,</span> context<span class="token operator">=</span>context<span class="token punctuation">)</span> 
    rv <span class="token operator">=</span> template<span class="token punctuation">.</span>render<span class="token punctuation">(</span>context<span class="token punctuation">)</span>  <span class="token comment">#将参数传入，进行模板渲染</span>
    template_rendered<span class="token punctuation">.</span>send<span class="token punctuation">(</span>app<span class="token punctuation">,</span> template<span class="token operator">=</span>template<span class="token punctuation">,</span> context<span class="token operator">=</span>context<span class="token punctuation">)</span> <span class="token comment">#模板渲染后执行，需要我们自己定义的template_rendered.connect()函数</span>
    <span class="token keyword">return</span> rv
</code></pre></div></li> <li><p><code>response(environ, start_response)</code> 函数源码分析，该函数实则是执行了self.finalize_request(rv) （表示正常处理结果，不会被异常接获）、handle_exception() 函数捕获一异常返回的<code>finalize_request(server_error, from_error_handler=True)</code>函数，打开finalize_request()函数源码</p> <div class="language-python extra-class"><pre class="language-python"><code>    <span class="token keyword">def</span> <span class="token function">finalize_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> rv<span class="token punctuation">,</span> from_error_handler<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        response <span class="token operator">=</span> self<span class="token punctuation">.</span>make_response<span class="token punctuation">(</span>rv<span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>     
            response <span class="token operator">=</span> self<span class="token punctuation">.</span>process_response<span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token comment">#处理after_request函数，session_save函数</span>
            request_finished<span class="token punctuation">.</span>send<span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token operator">=</span>response<span class="token punctuation">)</span> <span class="token comment">#执行请求结束执行的函数，需要我们自己使用connect注册</span>
        <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> from_error_handler<span class="token punctuation">:</span>
                <span class="token keyword">raise</span>
            self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>exception<span class="token punctuation">(</span>
                <span class="token string">&quot;Request finalizing failed with an error while handling an error&quot;</span>
            <span class="token punctuation">)</span>
        <span class="token keyword">return</span> response
</code></pre></div></li></ul> <h4 id="before-request-和-before-first-request-请求扩展源码分析"><a href="#before-request-和-before-first-request-请求扩展源码分析" class="header-anchor">#</a> before_request  和 before_first_request 请求扩展源码分析</h4> <ul><li><p>简单实例</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span>signals

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span><span class="token string">'app01'</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span>debug <span class="token operator">=</span> <span class="token boolean">True</span>

<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'触发信号'</span><span class="token punctuation">,</span> args<span class="token punctuation">,</span> kwargs<span class="token punctuation">)</span>

signals<span class="token punctuation">.</span>request_started<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>func<span class="token punctuation">)</span>  <span class="token comment"># 使用connect将函数注册到信号中，也就是说请求进来就执行</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>before_first_request</span>
<span class="token keyword">def</span> <span class="token function">before_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>before_first_request</span>  <span class="token comment"># 向全局before_first_request_funcs列表添加两个函数</span>
<span class="token keyword">def</span> <span class="token function">before_request2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>before_request</span>  <span class="token comment"># 向全局before_first_request_funcs列表添加两个函数</span>
<span class="token keyword">def</span> <span class="token function">before_request3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'视图'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'index'</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>__call__
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h5 id="源码分析"><a href="#源码分析" class="header-anchor">#</a> 源码分析</h5> <ul><li><p>点击before_reqeust装饰器函数，查看源码</p> <div class="language-python extra-class"><pre class="language-python"><code> <span class="token decorator annotation punctuation">@setupmethod</span>
 <span class="token keyword">def</span> <span class="token function">before_first_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">:</span>
     self<span class="token punctuation">.</span>before_first_request_funcs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>f<span class="token punctuation">)</span>  <span class="token comment">#将装饰的函数添加到全局的一个列表中</span>
     <span class="token keyword">return</span> f <span class="token comment">#最后将函数返回，没有inner函数</span>
</code></pre></div></li> <li><p>点击before_request装饰器函数，查看源码</p> <div class="language-python extra-class"><pre class="language-python"><code> <span class="token decorator annotation punctuation">@setupmethod</span>
 <span class="token keyword">def</span> <span class="token function">before_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">:</span>
     self<span class="token punctuation">.</span>before_request_funcs<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token comment">#向全局的self.before_request_funcs字典中添加，添加空列表</span>
     <span class="token comment">#得到的值字典：{None: ['1']}</span>
     <span class="token keyword">return</span> f
</code></pre></div></li></ul> <h4 id="梳理flask信号流程"><a href="#梳理flask信号流程" class="header-anchor">#</a> 梳理Flask信号流程</h4> <ul><li><h5 id="总结以上信号流程"><a href="#总结以上信号流程" class="header-anchor">#</a> 总结以上信号流程</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token number">1</span>、请求进来执行：before_first_request
<span class="token number">2</span>、触发 reqeust_started 信号
<span class="token number">3</span>、before_request函数
<span class="token number">4</span>、如果视图函数中有模板渲染：
	渲染前的信号：before_render_template<span class="token punctuation">.</span>send
				rv <span class="token operator">=</span> template<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#模板渲染</span>
	渲染后的信号：template_rendered<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">5</span>、after_requset 函数
<span class="token number">6</span>、session<span class="token punctuation">.</span>save_session<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">7</span>、触发request<span class="token punctuation">.</span>finished信号

<span class="token number">8</span>、如果触发异常
	<span class="token number">9</span>、触发错误处理的信号：执行handle_exception<span class="token punctuation">(</span><span class="token punctuation">)</span>函数中的got_request_exception<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token punctuation">)</span>函数
<span class="token number">10</span>、在执行auto_pop<span class="token punctuation">(</span><span class="token punctuation">)</span>函数中的do_teardown_request<span class="token punctuation">(</span><span class="token punctuation">)</span>函数中： 执行request_teardown<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="自定义flask信号"><a href="#自定义flask信号" class="header-anchor">#</a> 自定义Flask信号</h2> <div class="language-python extra-class"><pre class="language-python"><code> <span class="token comment">#!/usr/bin/env python</span>
 <span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> current_app<span class="token punctuation">,</span> flash<span class="token punctuation">,</span> render_template
<span class="token keyword">from</span> flask<span class="token punctuation">.</span>signals <span class="token keyword">import</span> _signals
 
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>import_name<span class="token operator">=</span>__name__<span class="token punctuation">)</span>
 
 
<span class="token comment"># 自定义信号</span>
xxxxx <span class="token operator">=</span> _signals<span class="token punctuation">.</span>signal<span class="token punctuation">(</span><span class="token string">'xxxxx'</span><span class="token punctuation">)</span>
 
<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span>
 
<span class="token comment"># 自定义信号中注册函数</span>
xxxxx<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>func<span class="token punctuation">)</span>
 
 
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">&quot;/x&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 触发信号</span>
    xxxxx<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'123123'</span><span class="token punctuation">,</span> k1<span class="token operator">=</span><span class="token string">'v1'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'Index'</span>
 
 
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/python/flask/WTForms.html" class="prev">
        WTForms
      </a></span> <span class="next"><a href="/python/flask/应用上下文.html">
        应用上下文
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.51f2f156.js" defer></script><script src="/assets/js/2.8911ec45.js" defer></script><script src="/assets/js/72.2f8e3aa0.js" defer></script>
  </body>
</html>
