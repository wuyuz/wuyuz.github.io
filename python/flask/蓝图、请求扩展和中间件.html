<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>蓝图、请求扩展和中间件 | 独角兕大王</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.ccac5a78.css" as="style"><link rel="preload" href="/assets/js/app.51f2f156.js" as="script"><link rel="preload" href="/assets/js/2.8911ec45.js" as="script"><link rel="preload" href="/assets/js/78.0e49712f.js" as="script"><link rel="prefetch" href="/assets/js/10.6948c28b.js"><link rel="prefetch" href="/assets/js/100.276864ee.js"><link rel="prefetch" href="/assets/js/101.447ab1c7.js"><link rel="prefetch" href="/assets/js/102.f5b3c71d.js"><link rel="prefetch" href="/assets/js/103.16474d4b.js"><link rel="prefetch" href="/assets/js/104.ed58aef3.js"><link rel="prefetch" href="/assets/js/105.045203cd.js"><link rel="prefetch" href="/assets/js/106.be359e0b.js"><link rel="prefetch" href="/assets/js/107.7331bbca.js"><link rel="prefetch" href="/assets/js/108.76e1c800.js"><link rel="prefetch" href="/assets/js/109.e82166f3.js"><link rel="prefetch" href="/assets/js/11.d4ec37c8.js"><link rel="prefetch" href="/assets/js/110.4144755a.js"><link rel="prefetch" href="/assets/js/111.5864ab53.js"><link rel="prefetch" href="/assets/js/112.ca2aee84.js"><link rel="prefetch" href="/assets/js/113.641e7765.js"><link rel="prefetch" href="/assets/js/114.d69f8545.js"><link rel="prefetch" href="/assets/js/115.1b6a9f89.js"><link rel="prefetch" href="/assets/js/116.dde2c44e.js"><link rel="prefetch" href="/assets/js/117.4e79498c.js"><link rel="prefetch" href="/assets/js/12.7aac9c8d.js"><link rel="prefetch" href="/assets/js/13.abf127cd.js"><link rel="prefetch" href="/assets/js/14.aa4413a7.js"><link rel="prefetch" href="/assets/js/15.11a64e5b.js"><link rel="prefetch" href="/assets/js/16.f2d9a882.js"><link rel="prefetch" href="/assets/js/17.11c5bb7f.js"><link rel="prefetch" href="/assets/js/18.a522877b.js"><link rel="prefetch" href="/assets/js/19.6f31a972.js"><link rel="prefetch" href="/assets/js/20.b546c54e.js"><link rel="prefetch" href="/assets/js/21.6d055b7f.js"><link rel="prefetch" href="/assets/js/22.c48feceb.js"><link rel="prefetch" href="/assets/js/23.69941f78.js"><link rel="prefetch" href="/assets/js/24.6126dfc2.js"><link rel="prefetch" href="/assets/js/25.3475449c.js"><link rel="prefetch" href="/assets/js/26.96bb4643.js"><link rel="prefetch" href="/assets/js/27.da610e5d.js"><link rel="prefetch" href="/assets/js/28.b24ec15c.js"><link rel="prefetch" href="/assets/js/29.ec8af553.js"><link rel="prefetch" href="/assets/js/3.bec5f768.js"><link rel="prefetch" href="/assets/js/30.2e780db1.js"><link rel="prefetch" href="/assets/js/31.464c36ed.js"><link rel="prefetch" href="/assets/js/32.ad7d37c2.js"><link rel="prefetch" href="/assets/js/33.722f1ec5.js"><link rel="prefetch" href="/assets/js/34.8448d0fd.js"><link rel="prefetch" href="/assets/js/35.e5168ac9.js"><link rel="prefetch" href="/assets/js/36.edc404f1.js"><link rel="prefetch" href="/assets/js/37.5807602e.js"><link rel="prefetch" href="/assets/js/38.a519c89a.js"><link rel="prefetch" href="/assets/js/39.89af1b9a.js"><link rel="prefetch" href="/assets/js/4.5ed19beb.js"><link rel="prefetch" href="/assets/js/40.6c653db9.js"><link rel="prefetch" href="/assets/js/41.bc3b8b69.js"><link rel="prefetch" href="/assets/js/42.a0a02d9b.js"><link rel="prefetch" href="/assets/js/43.62f344e3.js"><link rel="prefetch" href="/assets/js/44.a7fd9d68.js"><link rel="prefetch" href="/assets/js/45.729c1c39.js"><link rel="prefetch" href="/assets/js/46.5b924aea.js"><link rel="prefetch" href="/assets/js/47.f3990404.js"><link rel="prefetch" href="/assets/js/48.f591f360.js"><link rel="prefetch" href="/assets/js/49.f7f213ad.js"><link rel="prefetch" href="/assets/js/5.2c5d28b5.js"><link rel="prefetch" href="/assets/js/50.b9ca2762.js"><link rel="prefetch" href="/assets/js/51.93672ee6.js"><link rel="prefetch" href="/assets/js/52.fb21314a.js"><link rel="prefetch" href="/assets/js/53.65343ccc.js"><link rel="prefetch" href="/assets/js/54.8081227d.js"><link rel="prefetch" href="/assets/js/55.e207659e.js"><link rel="prefetch" href="/assets/js/56.bde381df.js"><link rel="prefetch" href="/assets/js/57.f8eceb45.js"><link rel="prefetch" href="/assets/js/58.bef70bfd.js"><link rel="prefetch" href="/assets/js/59.7ab7562d.js"><link rel="prefetch" href="/assets/js/6.fc65a1ac.js"><link rel="prefetch" href="/assets/js/60.f40ac3ca.js"><link rel="prefetch" href="/assets/js/61.d2b463ab.js"><link rel="prefetch" href="/assets/js/62.cfdf1bcf.js"><link rel="prefetch" href="/assets/js/63.1e45ce59.js"><link rel="prefetch" href="/assets/js/64.a98fe86e.js"><link rel="prefetch" href="/assets/js/65.0234d7c5.js"><link rel="prefetch" href="/assets/js/66.724906f0.js"><link rel="prefetch" href="/assets/js/67.7806fda6.js"><link rel="prefetch" href="/assets/js/68.9f227dae.js"><link rel="prefetch" href="/assets/js/69.fdbc56ac.js"><link rel="prefetch" href="/assets/js/7.284de54e.js"><link rel="prefetch" href="/assets/js/70.04a9cc03.js"><link rel="prefetch" href="/assets/js/71.a6fa1dd9.js"><link rel="prefetch" href="/assets/js/72.2f8e3aa0.js"><link rel="prefetch" href="/assets/js/73.9bbb0cb6.js"><link rel="prefetch" href="/assets/js/74.9f122255.js"><link rel="prefetch" href="/assets/js/75.75e1fbd8.js"><link rel="prefetch" href="/assets/js/76.60ff3c3e.js"><link rel="prefetch" href="/assets/js/77.39a253ae.js"><link rel="prefetch" href="/assets/js/79.5f9c24a0.js"><link rel="prefetch" href="/assets/js/8.5c21a4cc.js"><link rel="prefetch" href="/assets/js/80.f826f188.js"><link rel="prefetch" href="/assets/js/81.b8995ea7.js"><link rel="prefetch" href="/assets/js/82.e9bf63e0.js"><link rel="prefetch" href="/assets/js/83.e3a00749.js"><link rel="prefetch" href="/assets/js/84.b940927c.js"><link rel="prefetch" href="/assets/js/85.ad46a9b2.js"><link rel="prefetch" href="/assets/js/86.190e0071.js"><link rel="prefetch" href="/assets/js/87.5f9eb9ef.js"><link rel="prefetch" href="/assets/js/88.cfaf7469.js"><link rel="prefetch" href="/assets/js/89.e64cc32c.js"><link rel="prefetch" href="/assets/js/9.0723805d.js"><link rel="prefetch" href="/assets/js/90.805edabe.js"><link rel="prefetch" href="/assets/js/91.6a1ab3f7.js"><link rel="prefetch" href="/assets/js/92.04ecd01e.js"><link rel="prefetch" href="/assets/js/93.e615470a.js"><link rel="prefetch" href="/assets/js/94.0ad7c41c.js"><link rel="prefetch" href="/assets/js/95.0e5ce618.js"><link rel="prefetch" href="/assets/js/96.b59cf9f4.js"><link rel="prefetch" href="/assets/js/97.2a327746.js"><link rel="prefetch" href="/assets/js/98.9c01ec88.js"><link rel="prefetch" href="/assets/js/99.952046bd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ccac5a78.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://github.com/fluidicon.png" alt="独角兕大王" class="logo"> <span class="site-name can-hide">独角兕大王</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/python/" class="nav-link router-link-active">
  Python
</a></div><div class="nav-item"><a href="/rust/" class="nav-link">
  Rust
</a></div><div class="nav-item"><a href="/go/" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/lua/" class="nav-link">
  Lua
</a></div><div class="nav-item"><a href="/C/" class="nav-link">
  C++
</a></div><div class="nav-item"><a href="https://github.com/wuyuz" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.cnblogs.com/double-W/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  cnblogs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/python/" class="nav-link router-link-active">
  Python
</a></div><div class="nav-item"><a href="/rust/" class="nav-link">
  Rust
</a></div><div class="nav-item"><a href="/go/" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/lua/" class="nav-link">
  Lua
</a></div><div class="nav-item"><a href="/C/" class="nav-link">
  C++
</a></div><div class="nav-item"><a href="https://github.com/wuyuz" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.cnblogs.com/double-W/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  cnblogs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python常用模块</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Django框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Flask 框架</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/python/flask/Werkzeug讲解.html" class="sidebar-link">Werkzeug 讲解</a></li><li><a href="/python/flask/路由和配置.html" class="sidebar-link">路由和配置</a></li><li><a href="/python/flask/模板、请求与响应.html" class="sidebar-link">模板、请求与响应</a></li><li><a href="/python/flask/蓝图、请求扩展和中间件.html" class="active sidebar-link">蓝图、请求扩展和中间件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/flask/蓝图、请求扩展和中间件.html#蓝图、请求扩展和中间件" class="sidebar-link">蓝图、请求扩展和中间件</a></li><li class="sidebar-sub-header"><a href="/python/flask/蓝图、请求扩展和中间件.html#请求扩展" class="sidebar-link">请求扩展</a></li><li class="sidebar-sub-header"><a href="/python/flask/蓝图、请求扩展和中间件.html#中间件" class="sidebar-link">中间件</a></li><li class="sidebar-sub-header"><a href="/python/flask/蓝图、请求扩展和中间件.html#蓝图" class="sidebar-link">蓝图</a></li></ul></li><li><a href="/python/flask/数据库连接池.html" class="sidebar-link">数据库连接池</a></li><li><a href="/python/flask/SQLAlchmey.html" class="sidebar-link">SQLAlchmey</a></li><li><a href="/python/flask/WTForms.html" class="sidebar-link">WTForms</a></li><li><a href="/python/flask/信号.html" class="sidebar-link">信号</a></li><li><a href="/python/flask/应用上下文.html" class="sidebar-link">应用上下文</a></li><li><a href="/python/flask/内置session理解.html" class="sidebar-link">内置session理解</a></li><li><a href="/python/flask/经典的编程思想.html" class="sidebar-link">经典的编程思想</a></li><li><a href="/python/flask/请求上下文源码分析.html" class="sidebar-link">请求上下文源码分析</a></li><li><a href="/python/flask/上下文管理准备工作.html" class="sidebar-link">上下文管理准备工作</a></li><li><a href="/python/flask/上下文管理源码分析.html" class="sidebar-link">上下文管理源码分析</a></li><li><a href="/python/flask/Flask回顾.html" class="sidebar-link">Flask开发规范和RESTful</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python爬虫</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python设计模式</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="蓝图、请求扩展和中间件"><a href="#蓝图、请求扩展和中间件" class="header-anchor">#</a> 蓝图、请求扩展和中间件</h2> <p>message是一个基于Session实现的用于保存数据的集合，其特点是：使用一次就删除。</p> <ul><li><h5 id="简单演示"><a href="#简单演示" class="header-anchor">#</a> 简单演示</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span>flash<span class="token punctuation">,</span>get_flashed_messages

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> <span class="token string">&quot;DFSFerw&quot;</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/get'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> get_flashed_messages<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#从那个地方拿值，取完一个值后，所有的都要清空</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>   <span class="token comment"># 第一次['666', '777', '666']  第二次 []</span>
    <span class="token keyword">return</span> <span class="token string">'Hello,world'</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/set'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    flash<span class="token punctuation">(</span><span class="token string">'666'</span><span class="token punctuation">)</span>   <span class="token comment"># 向某个地方设置了一个值，其实时结合session中设置了一个值</span>
    <span class="token keyword">return</span> <span class="token string">'设置成功'</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/set2'</span><span class="token punctuation">,</span>endpoint<span class="token operator">=</span><span class="token string">'n2'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    flash<span class="token punctuation">(</span><span class="token string">'777'</span><span class="token punctuation">)</span>   <span class="token comment"># 访问一次给那个地方设置一个值</span>
    <span class="token keyword">return</span> <span class="token string">'设置成功'</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><strong>应用场景</strong>：比如视图函数重定向到另一个函数，记录前一个视图函数的一些参数</li></ul></li> <li><p><strong>flash的附加功能</strong>：单独的使用一次的功能并不能满足我们的要求，也就是说，如果我们可以对添加进的数据进行分类，就更好了</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/get'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> get_flashed_messages<span class="token punctuation">(</span>category_filter<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'xxx'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 获取分类的数据</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>   <span class="token comment"># 第一次['777']  第二次 []</span>
    <span class="token keyword">return</span> <span class="token string">'Hello,world'</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/set'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    flash<span class="token punctuation">(</span><span class="token string">'666'</span><span class="token punctuation">)</span>  
    <span class="token keyword">return</span> <span class="token string">'设置成功'</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/set2'</span><span class="token punctuation">,</span>endpoint<span class="token operator">=</span><span class="token string">'n2'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    flash<span class="token punctuation">(</span><span class="token string">'777'</span><span class="token punctuation">,</span>category<span class="token operator">=</span><span class="token string">'xxx'</span><span class="token punctuation">)</span>   <span class="token comment">#设置分类</span>
    <span class="token keyword">return</span> <span class="token string">'设置成功'</span>
</code></pre></div><p><strong>注意：</strong> 由于flash是基于session做的，所以消息的特性也是符合session的，也就是说，如果你设置了两个值进去，突然服务端挂了，重新链接时，仍旧能取出数据</p></li></ul> <h2 id="请求扩展"><a href="#请求扩展" class="header-anchor">#</a> 请求扩展</h2> <ul><li><p>**简单实例：**主要是针对before_request、after_requset函数进行学习</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span>request
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>before_request</span>
<span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 请求进来的时候执行，如果有return，直接返回结果给浏览器，不往后走,</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'请求之前'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">None</span>   <span class="token comment">#返回None才能往后走</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>after_request</span>
<span class="token keyword">def</span> <span class="token function">process_response</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'走了'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> response

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/index2'</span><span class="token punctuation">,</span>endpoint<span class="token operator">=</span><span class="token string">'n2'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'index视图函数'</span>
    
<span class="token keyword">if</span> __name__  <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
 <span class="token comment">#访问index2结果：</span>
请求之前
index
走了
</code></pre></div></li> <li><h5 id="多个before-request、after-requset执行时"><a href="#多个before-request、after-requset执行时" class="header-anchor">#</a> 多个before_request、after_requset执行时</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>before_request</span>
<span class="token keyword">def</span> <span class="token function">process_request1</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 请求进来的时候执行，如果有return，直接返回结果给浏览器，不往后走,</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">' process_request1 请求之前'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">None</span>   <span class="token comment">#返回None才能往后走</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>before_request</span>
<span class="token keyword">def</span> <span class="token function">process_request2</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 请求进来的时候执行，如果有return，直接返回结果给浏览器，不往后走,</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">' process_request2 请求之前'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">None</span>   <span class="token comment">#返回None才能往后走</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>after_request</span>
<span class="token keyword">def</span> <span class="token function">process_response1</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'process_response1( 走了'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> response

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>after_request</span>
<span class="token keyword">def</span> <span class="token function">process_response2</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'process_response2 走了'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> response

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/index2'</span><span class="token punctuation">,</span>endpoint<span class="token operator">=</span><span class="token string">'n2'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'index视图函数'</span>

 <span class="token comment">#访问index2结果：</span>
process_request1 请求之前
process_request2 请求之前
index
process_response2 走了
process_response1 走了
</code></pre></div></li> <li><p>**定制报错信息：**当发生报错信息的时候，比如常见的404、500等，我们就可以使用自己得定制的界面</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>errorhandler</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>  <span class="token comment">#这里是定制的404错误，完全可以定制其他的错误码</span>
<span class="token keyword">def</span> <span class="token function">error_404</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'404错误'</span>   <span class="token comment">#访问不存在的网址时会报此错误</span>
</code></pre></div></li> <li><p>**before_first_request:**只有第一次请求过来的时候才执行这函数</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>before_first_request</span>
<span class="token keyword">def</span> <span class="token function">process_request1</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">' 第一次'</span><span class="token punctuation">)</span>  <span class="token comment">#第二次刷新就不走了</span>
    <span class="token keyword">return</span> <span class="token boolean">None</span>
</code></pre></div></li></ul> <h2 id="中间件"><a href="#中间件" class="header-anchor">#</a> 中间件</h2> <p>Flask的中间件主要是针对整个项目的入口，我们可以通过类的重新封装来扩展功能。</p> <h5 id="梳理flask项目启动流程"><a href="#梳理flask项目启动流程" class="header-anchor">#</a> 梳理Flask项目启动流程：</h5> <ul><li><p>项目启动执行app.run() 函数，点击run函数，在其中执行了</p> <div class="language-python extra-class"><pre class="language-python"><code>run_simple<span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> self<span class="token punctuation">,</span> <span class="token operator">**</span>options<span class="token punctuation">)</span>  <span class="token comment"># 这里出自动触发self()，也就是触发了app的__call__方法</span>
</code></pre></div></li> <li><p>查看<code>__call__</code>方法</p> <div class="language-python extra-class"><pre class="language-python"><code> <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> environ<span class="token punctuation">,</span> start_response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;The WSGI server calls the Flask application object as the
        WSGI application. This calls :meth:`wsgi_app` which can be
        wrapped to applying middleware.&quot;&quot;&quot;</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>wsgi_app<span class="token punctuation">(</span>environ<span class="token punctuation">,</span> start_response<span class="token punctuation">)</span> <span class="token comment">#environ是包含了所有请求的数据，start_response是一个发送HTTP响应的函数。</span>
</code></pre></div></li> <li><p>根据以上我们可以扩展中间件</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> flash<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> request
 
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> <span class="token string">'some_secret'</span>
 
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>
 
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/set'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    v <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>
    flash<span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'ok'</span>
 
<span class="token keyword">class</span> <span class="token class-name">MiddleWare</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>wsgi_app<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>wsgi_app <span class="token operator">=</span> wsgi_app
 
    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
 		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'中间件执行之前'</span><span class="token punctuation">)</span>
        ret <span class="token operator">=</span> self<span class="token punctuation">.</span>wsgi_app<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'中间件执行之后'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> ret
 
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>wsgi_app <span class="token operator">=</span> MiddleWare<span class="token punctuation">(</span>app<span class="token punctuation">.</span>wsgi_app<span class="token punctuation">)</span> <span class="token comment">#自定义自己的wsgi_app方法</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>port<span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="蓝图"><a href="#蓝图" class="header-anchor">#</a> 蓝图</h2> <p>当我们的逻辑代码开始增多后改怎么办？一个py文件显然不能承载太多，所以我们可以分写在view函数中</p> <ul><li><p>相应的代码：</p> <div class="language-python extra-class"><pre class="language-python"><code> <span class="token comment">#account.py文件</span>
<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> app
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'login'</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'logout'</span>
    
 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
 <span class="token comment">#order.py文件</span>
<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> app
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/order'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'order'</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> app
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'user'</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
 <span class="token comment">#init.py文件</span>
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span>request
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> order  <span class="token comment">#必须导入每个文件，否则不会执行相应的py文件相当于没有加载app的附加路由</span>
<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> user
<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> account

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
 <span class="token comment"># 主文件，a2.py</span>
<span class="token keyword">from</span> views <span class="token keyword">import</span> app
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h5 id="使用蓝图帮我们生成目录结构"><a href="#使用蓝图帮我们生成目录结构" class="header-anchor">#</a> 使用蓝图帮我们生成目录结构</h5> <p>原理和上面的方式类似，但是根据全面</p> <ul><li><p>常见报错信息</p> <div class="language-python extra-class"><pre class="language-python"><code> 报错：AttributeError<span class="token punctuation">:</span> <span class="token string">'function'</span> <span class="token builtin">object</span> has no attribute <span class="token string">'name'</span>

原因是：
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Blueprint
order <span class="token operator">=</span> Blueprint<span class="token punctuation">(</span><span class="token string">'order'</span><span class="token punctuation">,</span>__name__<span class="token punctuation">)</span>  <span class="token comment"># 相当于app一样，知识没有run方法，只能注册给app</span>

<span class="token decorator annotation punctuation">@orders<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/order'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'order'</span>

 <span class="token comment">#原因是Blueprint的第一个参数和接受变量名相互重复了，修改变量名即可</span>
 <span class="token comment">#orders = Blueprint('order',__name__)     </span>
</code></pre></div></li> <li><h5 id="蓝图的目录结构"><a href="#蓝图的目录结构" class="header-anchor">#</a> 蓝图的目录结构</h5></li> <li><h5 id="蓝图文件部分"><a href="#蓝图文件部分" class="header-anchor">#</a> 蓝图文件部分</h5> <div class="language-python extra-class"><pre class="language-python"><code> <span class="token comment">#account.py文件</span>
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Blueprint

account <span class="token operator">=</span> Blueprint<span class="token punctuation">(</span><span class="token string">'account'</span><span class="token punctuation">,</span>__name__<span class="token punctuation">)</span>  <span class="token comment"># 相当于app一样，知识没有run方法，只能注册给app</span>

<span class="token decorator annotation punctuation">@account<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'account 中的 login'</span>

<span class="token decorator annotation punctuation">@account<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'logout'</span>
    
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
 <span class="token comment">#order.py文件</span>
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Blueprint

orders <span class="token operator">=</span> Blueprint<span class="token punctuation">(</span><span class="token string">'order'</span><span class="token punctuation">,</span>__name__<span class="token punctuation">,</span>url_prefix <span class="token operator">=</span> <span class="token string">'/order'</span><span class="token punctuation">)</span>  <span class="token comment"># 相当于app一样，知识没有run方法，只能注册给app,和app的区别可以添加前缀</span>

<span class="token decorator annotation punctuation">@orders<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">#/order/login可以访问，因为前缀，否则根据注册顺序先account的login执行</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'order 中的 login'</span>

<span class="token decorator annotation punctuation">@orders<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/order'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'order'</span>
    
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
 <span class="token comment">#user.py文件</span>
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Blueprint

users <span class="token operator">=</span> Blueprint<span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">,</span> __name__<span class="token punctuation">)</span>  <span class="token comment"># 相当于app一样，知识没有run方法，只能注册给app</span>

<span class="token decorator annotation punctuation">@users<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span>endpoint<span class="token operator">=</span><span class="token string">'users'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'user'</span>
</code></pre></div></li> <li><p>在包中的蓝图使用<code>__init__.py</code>进行整合</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span>request

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">,</span>template_folder<span class="token operator">=</span><span class="token string">'templates'</span>
            <span class="token punctuation">,</span>static_folder<span class="token operator">=</span><span class="token string">'statics'</span><span class="token punctuation">,</span>static_url_path<span class="token operator">=</span><span class="token string">'/static'</span><span class="token punctuation">)</span> <span class="token comment">#实例一个能run的app</span>

<span class="token keyword">from</span> views<span class="token punctuation">.</span>account <span class="token keyword">import</span>  account <span class="token comment">#导入所有的模块否则还是无法识别</span>
<span class="token keyword">from</span> views<span class="token punctuation">.</span>user <span class="token keyword">import</span>  users
<span class="token keyword">from</span> views<span class="token punctuation">.</span>order <span class="token keyword">import</span>  orders

app<span class="token punctuation">.</span>register_blueprint<span class="token punctuation">(</span>account<span class="token punctuation">)</span>  <span class="token comment">#将三个蓝图注册到app中，app.run也就相当于所有蓝图run</span>
app<span class="token punctuation">.</span>register_blueprint<span class="token punctuation">(</span>users<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>register_blueprint<span class="token punctuation">(</span>orders<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>最后在a2.py文件中run</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> views <span class="token keyword">import</span> app

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>  
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#整个项目启动</span>
</code></pre></div></li></ul> <h5 id="同级目录下的蓝图引用"><a href="#同级目录下的蓝图引用" class="header-anchor">#</a> 同级目录下的蓝图引用</h5> <ul><li><h5 id="目录结构"><a href="#目录结构" class="header-anchor">#</a> 目录结构：</h5></li> <li><h5 id="代码实现"><a href="#代码实现" class="header-anchor">#</a> 代码实现</h5> <div class="language-python extra-class"><pre class="language-python"><code> <span class="token comment">#a4.py文件</span>
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Blueprint
bp <span class="token operator">=</span> Blueprint<span class="token punctuation">(</span><span class="token string">'app01'</span><span class="token punctuation">,</span>__name__<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@bp<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/users'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'I am app01'</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
 <span class="token comment">#a5.py文件</span>
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask
<span class="token keyword">from</span> a4 <span class="token keyword">import</span> bp
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>register_blueprint<span class="token punctuation">(</span>bp<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'login'</span>

<span class="token decorator annotation punctuation">@bp<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/users'</span><span class="token punctuation">)</span>  <span class="token comment"># 默认不执行此视图函数，因为蓝图中已有，可以给蓝图添加url_prefix方法限制，将注册哪一行写下面会报错，因为蓝图始终要注册，相当于要覆盖user</span>
<span class="token keyword">def</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'I app'</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h5 id="实例化蓝图的参数说明"><a href="#实例化蓝图的参数说明" class="header-anchor">#</a> 实例化蓝图的参数说明</h5> <ul><li><p>每个蓝图都可以有自己的模板路径、静态文件、以及url_prefix等等</p> <div class="language-python extra-class"><pre class="language-python"><code> <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>
        self<span class="token punctuation">,</span>
        name<span class="token punctuation">,</span>
        import_name<span class="token punctuation">,</span>
        static_folder<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
        static_url_path<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
        template_folder<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>  <span class="token comment">#蓝图的自己的模板，注意：默认是在同级目录下的模板</span>
        url_prefix<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>   <span class="token comment"># 自己的url前缀，用于区分不同蓝图的同名函数</span>
        subdomain<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
        url_defaults<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
        root_path<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
        cli_group<span class="token operator">=</span>_sentinel<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">pass</span>
    
 <span class="token comment">#blog = Blueprint('blog',__name__, template_folder='bb'),会默认去同级目录下找bb模板文件夹</span>
</code></pre></div></li></ul> <h5 id="蓝图的请求扩展"><a href="#蓝图的请求扩展" class="header-anchor">#</a> 蓝图的请求扩展</h5> <ul><li><p>每个蓝图都可以有自己的before_request。请求到来现在app的before_request进行判断，如果是蓝图的路由，就将请求分发下去</p> <div class="language-python extra-class"><pre class="language-python"><code> <span class="token comment">#a4.py文件</span>
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Blueprint
bp <span class="token operator">=</span> Blueprint<span class="token punctuation">(</span><span class="token string">'app01'</span><span class="token punctuation">,</span>__name__<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@bp<span class="token punctuation">.</span>before_request</span>
<span class="token keyword">def</span> <span class="token function">before_req</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'bp 位置'</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@bp<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/users'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'I am app01'</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
 <span class="token comment">#a5.py文件</span>
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask
<span class="token keyword">from</span> a4 <span class="token keyword">import</span> bp
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>register_blueprint<span class="token punctuation">(</span>bp<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>before_request</span>
<span class="token keyword">def</span> <span class="token function">before_req</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'app 位置'</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'login'</span>

<span class="token decorator annotation punctuation">@bp<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/users'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'I app'</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
 <span class="token comment">#访问/users路径结果：</span>
app 位置
bp 位置
</code></pre></div></li></ul> <h5 id="总结蓝图"><a href="#总结蓝图" class="header-anchor">#</a> 总结蓝图</h5> <div class="language- extra-class"><pre class="language-text"><code>蓝图用来给Flask构造目录
    1、可以批量分类url
    2、分发模板路径/静态文件路径等
    3、请求扩展（适用于白名单）
</code></pre></div><h5 id="蓝图构建大型项目"><a href="#蓝图构建大型项目" class="header-anchor">#</a> 蓝图构建大型项目</h5> <ul><li><p><strong>目录结构：</strong></p></li> <li><p><strong>要点讲解：</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>创建了两层init函数，最外层用于整合蓝图到app中，内层init用于创建蓝图，以便views中使用

 <span class="token comment"># 外层init</span>
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask
<span class="token keyword">from</span> <span class="token punctuation">.</span>admin <span class="token keyword">import</span> admin
<span class="token keyword">from</span> <span class="token punctuation">.</span>web <span class="token keyword">import</span> web

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>debug <span class="token operator">=</span> <span class="token boolean">True</span>

app<span class="token punctuation">.</span>register_blueprint<span class="token punctuation">(</span>admin<span class="token punctuation">,</span> url_prefix<span class="token operator">=</span><span class="token string">'/admin'</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span>register_blueprint<span class="token punctuation">(</span>web<span class="token punctuation">)</span>

 <span class="token comment"># 内层init</span>
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Blueprint
admin <span class="token operator">=</span> Blueprint<span class="token punctuation">(</span>
    <span class="token string">'admin'</span><span class="token punctuation">,</span>
    __name__<span class="token punctuation">,</span>
    template_folder<span class="token operator">=</span><span class="token string">'templates'</span><span class="token punctuation">,</span>
    static_folder<span class="token operator">=</span><span class="token string">'static'</span>
<span class="token punctuation">)</span>
<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> views
</code></pre></div></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/python/flask/模板、请求与响应.html" class="prev">
        模板、请求与响应
      </a></span> <span class="next"><a href="/python/flask/数据库连接池.html">
        数据库连接池
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.51f2f156.js" defer></script><script src="/assets/js/2.8911ec45.js" defer></script><script src="/assets/js/78.0e49712f.js" defer></script>
  </body>
</html>
